<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>『魏超』的 blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.weichao.io/"/>
  <updated>2020-04-09T10:17:59.346Z</updated>
  <id>http://www.weichao.io/</id>
  
  <author>
    <name>魏超</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>插件化</title>
    <link href="http://www.weichao.io/2020/04/09/%E6%8F%92%E4%BB%B6%E5%8C%96/"/>
    <id>http://www.weichao.io/2020/04/09/插件化/</id>
    <published>2020-04-09T10:00:52.000Z</published>
    <updated>2020-04-09T10:17:59.346Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ClassLoader-加载-dex-文件"><a href="#ClassLoader-加载-dex-文件" class="headerlink" title="ClassLoader 加载 dex 文件"></a><strong>ClassLoader 加载 dex 文件</strong></h1><h2 id="继承关系"><a href="#继承关系" class="headerlink" title="继承关系"></a><strong>继承关系</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%8F%92%E4%BB%B6%E5%8C%96202004091.png" alt=""></p><blockquote><p>BootClassLoader：<br>加载 Android Framework 层的 class 文件。</p><p>PathClassLoader：<br>加载 dex 文件，包括 jar、zip、apk 中的 dex 文件。</p><p>DexClassLoader：<br>加载 dex 文件，包括 jar、zip、apk 中的 dex 文件。</p></blockquote><h2 id="ClassLoader-加载-Class-的流程"><a href="#ClassLoader-加载-Class-的流程" class="headerlink" title="ClassLoader 加载 Class 的流程"></a><strong>ClassLoader 加载 Class 的流程</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%8F%92%E4%BB%B6%E5%8C%96202004092.png" alt=""></p><blockquote><p>双亲委托机制：<br>首先检测这个类是否已经被加载了，如果已经加载了，直接获取并返回。如果没有被加载，当 parent 不为 null 时，调用 parent 的 loadClass() 进行加载；当 parent 为 null 时，调用 findClass() 方法，依次递归，如果找到了或者加载了就返回，如果既没找到也加载不了，才自己去加载。</p></blockquote><p>BootClassLoader#findClass() 是直接调用了 Class.classForName() 方法；<br>DexClassLoader#findClass() 是加载传入的 APK 文件中的所有 dexFile 到 dexElements 数组，然后再调用 Element#findClass() 查找 dexFile 中是否包含指定的 class。</p><hr><h1 id="执行插件中的方法"><a href="#执行插件中的方法" class="headerlink" title="执行插件中的方法"></a><strong>执行插件中的方法</strong></h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a><strong>原理</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%8F%92%E4%BB%B6%E5%8C%96202004093.png" alt=""></p><p>1、创建插件的 DexClassLoader 类加载器，然后通过反射获取插件的 dexElements 值；<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">DexClassLoader</div><div class="line">----dexElements[]</div></pre></td></tr></table></figure></p><p>2、获取宿主的 PathClassLoader 类加载器，然后通过反射获取宿主的 dexElements 值；<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">BaseDexClassLoader</div><div class="line">----pathList</div><div class="line">--------dexElements[]</div></pre></td></tr></table></figure></p><p>3、合并宿主的 dexElements 与插件的 dexElements，生成新的 Element[]；<br>4、最后通过反射将新的 Element[] 赋值给宿主的 dexElements。</p><h2 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a><strong>核心代码</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">loadPluginDex</span><span class="params">(String apkPath)</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="comment">// 1.获取 pathList 的字段</span></div><div class="line">        Class baseDexClassLoader = Class.forName(<span class="string">"dalvik.system.BaseDexClassLoader"</span>);</div><div class="line">        Field pathListField = baseDexClassLoader.getDeclaredField(<span class="string">"pathList"</span>);</div><div class="line">        pathListField.setAccessible(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">        <span class="comment">// 2.获取 DexClassLoader 类中的属性 pathList 的值</span></div><div class="line">        DexClassLoader dexClassLoader = <span class="keyword">new</span> DexClassLoader(apkPath, getCacheDir().getAbsolutePath(), <span class="keyword">null</span>, getClassLoader());</div><div class="line">        Object pluginPathList = pathListField.get(dexClassLoader);</div><div class="line"></div><div class="line">        <span class="comment">// 3.获取 pathList 中的属性 dexElements[] 的值--- 插件的 dexElements[]</span></div><div class="line">        Class pluginPathListClass = pluginPathList.getClass();</div><div class="line">        Field pluginDexElementsField = pluginPathListClass.getDeclaredField(<span class="string">"dexElements"</span>);</div><div class="line">        pluginDexElementsField.setAccessible(<span class="keyword">true</span>);</div><div class="line">        Object[] pluginDexElements = (Object[]) pluginDexElementsField.get(pluginPathList);</div><div class="line"></div><div class="line">        <span class="comment">// 4.获取 PathClassLoader 类中的属性 pathList 的值</span></div><div class="line">        PathClassLoader pathClassLoader = (PathClassLoader) getClassLoader();</div><div class="line">        Object hostPathList = pathListField.get(pathClassLoader);</div><div class="line"></div><div class="line">        <span class="comment">// 5.获取 pathList 中的属性 dexElements[] 的值--- 宿主的 dexElements[]</span></div><div class="line">        Class hostPathListClass = hostPathList.getClass();</div><div class="line">        Field hostDexElementsField = hostPathListClass.getDeclaredField(<span class="string">"dexElements"</span>);</div><div class="line">        hostDexElementsField.setAccessible(<span class="keyword">true</span>);</div><div class="line">        Object[] hostDexElements = (Object[]) hostDexElementsField.get(hostPathList);</div><div class="line"></div><div class="line">        <span class="comment">// 6.创建一个新的空数组，第一个参数是数组的类型，第二个参数是数组的长度</span></div><div class="line">        Object[] dexElements = (Object[]) Array.newInstance(hostDexElements.getClass().getComponentType(), pluginDexElements.length + hostDexElements.length);</div><div class="line"></div><div class="line">        <span class="comment">// 7.将插件和宿主的 dexElements[] 的值放入新的数组中</span></div><div class="line">        System.arraycopy(pluginDexElements, <span class="number">0</span>, dexElements, <span class="number">0</span>, pluginDexElements.length);</div><div class="line">        System.arraycopy(hostDexElements, <span class="number">0</span>, dexElements, pluginDexElements.length, hostDexElements.length);</div><div class="line"></div><div class="line">        hostDexElementsField.set(hostPathList, dexElements);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> String <span class="title">loadPluginMethod</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        Class&lt;?&gt; threadClazz = Class.forName(<span class="string">"io.weichao.plugin.util.PluginUtil"</span>);</div><div class="line">        Method method = threadClazz.getMethod(<span class="string">"getMessage"</span>);</div><div class="line">        <span class="keyword">return</span> (String) method.invoke(<span class="keyword">null</span>);</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><hr><h1 id="启动插件中的-Activity"><a href="#启动插件中的-Activity" class="headerlink" title="启动插件中的 Activity"></a><strong>启动插件中的 Activity</strong></h1><h2 id="关键难点——无法通过-AMS-检测"><a href="#关键难点——无法通过-AMS-检测" class="headerlink" title="关键难点——无法通过 AMS 检测"></a><strong>关键难点——无法通过 AMS 检测</strong></h2><p>插件的 Activity 没有在宿主的清单文件中注册。</p><h3 id="启动-Activity-流程"><a href="#启动-Activity-流程" class="headerlink" title="启动 Activity 流程"></a><strong>启动 Activity 流程</strong></h3><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%8F%92%E4%BB%B6%E5%8C%96202004094.png" alt=""></p><h2 id="绕过-AMS-检测——hook"><a href="#绕过-AMS-检测——hook" class="headerlink" title="绕过 AMS 检测——hook"></a><strong>绕过 AMS 检测——hook</strong></h2><blockquote><p>hook：<br>劫持，改变代码的正常执行流程。</p></blockquote><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%8F%92%E4%BB%B6%E5%8C%96202004095.png" alt=""></p><p>1、在宿主中创建一个 ProxyActivity 继承自 Activity，并且在 manifest 中注册；<br>2、当启动插件的 Activity 时，在 AMS 检测前，找到一个 hook 点，然后通过 hook 将启动插件 Activity 的 Intent 替换成启动 ProxyActivity 的 Intent；<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// API 26、28</span></div><div class="line">Activity#startActivity()</div><div class="line">----startActivityForResult()</div><div class="line">Instrumentation#execStartActivity()</div><div class="line">----ActivityManager.getService().startActivity(..., intent, ...) <span class="comment">// ActivityManager.getService() 是 AMS 检测前的最后的 hook 机会，ActivityManager.getService() 的返回值是 IActivityManager，所以需要对 IActivityManager 进行动态代理，hook IActivityManager#startActivity()</span></div><div class="line"></div><div class="line"><span class="comment">// 1. IActivityManager 可使用 IActivityManagerSingleton 获取</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IActivityManager <span class="title">getService</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> IActivityManagerSingleton.get();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 2. IActivityManagerSingleton 在 ActivityManager 中是 static，反射时容易获取</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton&lt;IActivityManager&gt; IActivityManagerSingleton = <span class="keyword">new</span> Singleton&lt;IActivityManager&gt;() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> IActivityManager <span class="title">create</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">final</span> IBinder b = ServiceManager.getService(Context.ACTIVITY_SERVICE);</div><div class="line">        <span class="keyword">final</span> IActivityManager am = IActivityManager.Stub.asInterface(b);</div><div class="line">        <span class="keyword">return</span> am;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 3. IActivityManager 在 Singleton 中以变量 mInstance 存在</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> T mInstance;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> T <span class="title">create</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (mInstance == <span class="keyword">null</span>) &#123;</div><div class="line">                mInstance = create();</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> mInstance;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 总结：反射获取 ActivityManager 中的 IActivityManagerSingleton，再获取 IActivityManagerSingleton 中的 mInstance，这个 mInstance 本质是 IActivityManager，对其进行动态代理</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// API 23、24、25</span></div><div class="line">Activity#startActivity()</div><div class="line">----startActivityForResult()</div><div class="line">Instrumentation#execStartActivity()</div><div class="line">----ActivityManagerNative.getDefault().startActivity(..., intent, ...) <span class="comment">// API 23 不同点，ActivityManagerNative.getDefault() 返回值是 IActivityManager，所以还是动态代理 IActivityManager，但是获取 IActivityManager 的方法不一样</span></div><div class="line"></div><div class="line"><span class="comment">// 1. IActivityManager 可使用 gDefault 获取：</span></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> IActivityManager <span class="title">getDefault</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> gDefault.get();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 2. gDefault 在 ActivityManagerNative 中是 static，反射时容易获取</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton&lt;IActivityManager&gt; gDefault = <span class="keyword">new</span> Singleton&lt;IActivityManager&gt;() &#123;</div><div class="line">    <span class="function"><span class="keyword">protected</span> IActivityManager <span class="title">create</span><span class="params">()</span> </span>&#123;</div><div class="line">        IBinder b = ServiceManager.getService(<span class="string">"activity"</span>);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">false</span>) &#123;</div><div class="line">            Log.v(<span class="string">"ActivityManager"</span>, <span class="string">"default service binder = "</span> + b);</div><div class="line">        &#125;</div><div class="line">        IActivityManager am = asInterface(b);</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">false</span>) &#123;</div><div class="line">            Log.v(<span class="string">"ActivityManager"</span>, <span class="string">"default service = "</span> + am);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> am;</div><div class="line">    &#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 3. IActivityManager 在 Singleton 中以变量 mInstance 存在，和前面一样</span></div><div class="line"></div><div class="line"><span class="comment">// 总结：反射获取 ActivityManagerNative 中的 gDefault，再获取 gDefault 中的 mInstance，这个 mInstance 本质是 IActivityManager，对其进行动态代理</span></div></pre></td></tr></table></figure></p><p>3、在 AMS 检测完后，找到一个 hook 点，然后通过 hook 将启动 ProxyActivity 的 Intent 替换成启动插件 Activity 的 Intent；<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// API 26 及以前</span></div><div class="line">ActivityStackSupervisor#realStartActivityLocked()</div><div class="line">ActivityThread#scheduleLaunchActivity(intent, ...)</div><div class="line">----sendMessage(H.LAUNCH_ACTIVITY, r) <span class="comment">// r 含 Intent</span></div><div class="line">Handler#dispatchMessage(msg) // msg.obj = r</div><div class="line">----callback(msg)</div><div class="line">Callback</div><div class="line">----mCallback <span class="comment">// 劫持 mCallback，修改 Intent</span></div><div class="line"></div><div class="line"><span class="comment">// 1. Handler 在 ActivityThread 中以 mH 存在，所以需要先拿到 ActivityThread</span></div><div class="line"><span class="keyword">final</span> H mH = <span class="keyword">new</span> H();</div><div class="line"></div><div class="line"><span class="comment">// 2. ActivityThread 中存在 sCurrentActivityThread，且是 static，反射时容易获取</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> ActivityThread sCurrentActivityThread;</div><div class="line"></div><div class="line"><span class="comment">// 3. 拿到 mH 以后，给 mH 设置新的 Callback，重写其 handleMessage()，将 msg.obj 中的 Intent 改为插件的 Intent</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// API 28</span></div><div class="line">ActivityStackSupervisor#realStartActivityLocked()</div><div class="line">clientTransaction.addCallback(LaunchActivityItem.obtain(<span class="keyword">new</span> Intent(r.intent), ...) <span class="comment">// API 28 不同点</span></div><div class="line">ClientTransaction</div><div class="line">----List&lt;ClientTransactionItem&gt; <span class="comment">// 包含 Intent</span></div><div class="line">mService.getLifecycleManager().scheduleTransaction(clientTransaction)</div><div class="line">ActivityThread#scheduleLaunchActivity(clientTransaction)</div><div class="line">----sendMessage(ActivityThread.H.EXECUTE_TRANSACTION, clientTransaction) <span class="comment">// API 28 不同点</span></div><div class="line">Handler#dispatchMessage(msg) // msg.obj = clientTransaction</div><div class="line">----callback(msg)</div><div class="line">Callback</div><div class="line">----mCallback <span class="comment">// 劫持 mCallback，修改 Intent</span></div><div class="line"></div><div class="line"><span class="comment">// 1. 和上面一样，Handler 在 ActivityThread 中以 mH 存在，所以需要先拿到 ActivityThread</span></div><div class="line"></div><div class="line"><span class="comment">// 2. 和上面一样，ActivityThread 中存在 sCurrentActivityThread，且是 static，反射时容易获取</span></div><div class="line"></div><div class="line"><span class="comment">// 3. 拿到 mH 以后，给 mH 设置新的 Callback，重写其 handleMessage()，这里 msg.what 变了，同时 msg.obj 变了，不是 r 了，而是 clientTransaction，通过反射获取 clientTransaction 中的 mActivityCallbacks，修改 Intent</span></div></pre></td></tr></table></figure></p><p>4、启动插件的 Activity。</p><h2 id="核心代码-1"><a href="#核心代码-1" class="headerlink" title="核心代码"></a><strong>核心代码</strong></h2><h3 id="将启动插件-Activity-的-Intent-替换成启动-ProxyActivity-的-Intent"><a href="#将启动插件-Activity-的-Intent-替换成启动-ProxyActivity-的-Intent" class="headerlink" title="将启动插件 Activity 的 Intent 替换成启动 ProxyActivity 的 Intent"></a><strong>将启动插件 Activity 的 Intent 替换成启动 ProxyActivity 的 Intent</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    <span class="comment">// 获取 Singleton&lt;T&gt; 类的对象</span></div><div class="line">    Object singleton = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</div><div class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">"android.app.ActivityManager"</span>);</div><div class="line">        Field singletonField = clazz.getDeclaredField(<span class="string">"IActivityManagerSingleton"</span>);</div><div class="line">        singletonField.setAccessible(<span class="keyword">true</span>);</div><div class="line">        singleton = singletonField.get(<span class="keyword">null</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">"android.app.ActivityManagerNative"</span>);</div><div class="line">        Field singletonField = clazz.getDeclaredField(<span class="string">"gDefault"</span>);</div><div class="line">        singletonField.setAccessible(<span class="keyword">true</span>);</div><div class="line">        singleton = singletonField.get(<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 获取 mInstance 对象</span></div><div class="line">    Class&lt;?&gt; singletonClass = Class.forName(<span class="string">"android.util.Singleton"</span>);</div><div class="line">    Field mInstanceField = singletonClass.getDeclaredField(<span class="string">"mInstance"</span>);</div><div class="line">    mInstanceField.setAccessible(<span class="keyword">true</span>);</div><div class="line">    <span class="keyword">final</span> Object mInstance = mInstanceField.get(singleton);</div><div class="line"></div><div class="line">    <span class="comment">// 创建 IActivityManager 的代理对象</span></div><div class="line">    Class&lt;?&gt; iActivityManagerClass = Class.forName(<span class="string">"android.app.IActivityManager"</span>);</div><div class="line">    Object proxyInstance = Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(),</div><div class="line">            <span class="keyword">new</span> Class[]&#123;iActivityManagerClass&#125;, <span class="keyword">new</span> InvocationHandler() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">                    <span class="comment">/**</span></div><div class="line"><span class="comment">                     * int result = ActivityManager.getService()</span></div><div class="line"><span class="comment">                     *                 .startActivity(whoThread, who.getBasePackageName(), intent,</span></div><div class="line"><span class="comment">                     *                         intent.resolveTypeIfNeeded(who.getContentResolver()),</span></div><div class="line"><span class="comment">                     *                         token, target != null ? target.mEmbeddedID : null,</span></div><div class="line"><span class="comment">                     *                         requestCode, 0, null, options);</span></div><div class="line"><span class="comment">                     */</span></div><div class="line">                    <span class="comment">// 当执行的方法是 startActivity 时作处理</span></div><div class="line">                    <span class="keyword">if</span> (<span class="string">"startActivity"</span>.equals(method.getName())) &#123;</div><div class="line">                        <span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line"></div><div class="line">                        <span class="comment">// 获取插件的 intent</span></div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</div><div class="line">                            <span class="keyword">if</span> (args[i] <span class="keyword">instanceof</span> Intent) &#123;</div><div class="line">                                index = i;</div><div class="line">                                <span class="keyword">break</span>;</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                        Intent intent = (Intent) args[index];</div><div class="line"></div><div class="line">                        <span class="comment">// 创建代理的 intent</span></div><div class="line">                        Intent proxyIntent = <span class="keyword">new</span> Intent();</div><div class="line">                        proxyIntent.setClassName(<span class="string">"io.weichao.plugin_demo"</span>, ProxyActivity.class.getName());</div><div class="line">                        <span class="comment">// 保存插件的 intent 到代理的 intent 中</span></div><div class="line">                        proxyIntent.putExtra(TARGET_INTENT, intent);</div><div class="line"></div><div class="line">                        <span class="comment">// 将插件的 intent 替换为代理的 intent</span></div><div class="line">                        args[index] = proxyIntent;</div><div class="line">                    &#125;</div><div class="line"></div><div class="line">                    <span class="comment">// IActivityManager 对象 --- 通过反射</span></div><div class="line">                    <span class="keyword">return</span> method.invoke(mInstance, args);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">    <span class="comment">// 使用代理对象替换原有的 mInstance 对象</span></div><div class="line">    mInstanceField.set(singleton, proxyInstance);</div><div class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">    Log.e(<span class="string">"aaaaa"</span>, <span class="string">"aaaaa"</span> + e.getMessage());</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="将启动-ProxyActivity-的-Intent-替换成启动插件-Activity-的-Intent"><a href="#将启动-ProxyActivity-的-Intent-替换成启动插件-Activity-的-Intent" class="headerlink" title="将启动 ProxyActivity 的 Intent 替换成启动插件 Activity 的 Intent"></a><strong>将启动 ProxyActivity 的 Intent 替换成启动插件 Activity 的 Intent</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    <span class="comment">// 获取 ActivityThread 对象</span></div><div class="line">    Class&lt;?&gt; clazz = Class.forName(<span class="string">"android.app.ActivityThread"</span>);</div><div class="line">    Field sCurrentActivityThreadField = clazz.getDeclaredField(<span class="string">"sCurrentActivityThread"</span>);</div><div class="line">    sCurrentActivityThreadField.setAccessible(<span class="keyword">true</span>);</div><div class="line">    Object activityThread = sCurrentActivityThreadField.get(<span class="keyword">null</span>);</div><div class="line"></div><div class="line">    <span class="comment">// 获取 Handler 对象</span></div><div class="line">    Field mHField = clazz.getDeclaredField(<span class="string">"mH"</span>);</div><div class="line">    mHField.setAccessible(<span class="keyword">true</span>);</div><div class="line">    Object mH = mHField.get(activityThread);</div><div class="line"></div><div class="line">    <span class="comment">// 创建一个 Callback 替换系统的 Callback 对象</span></div><div class="line">    Class&lt;?&gt; handlerClass = Class.forName(<span class="string">"android.os.Handler"</span>);</div><div class="line">    Field mCallbackField = handlerClass.getDeclaredField(<span class="string">"mCallback"</span>);</div><div class="line">    mCallbackField.setAccessible(<span class="keyword">true</span>);</div><div class="line">    mCallbackField.set(mH, <span class="keyword">new</span> Handler.Callback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">handleMessage</span><span class="params">(@NonNull Message msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">switch</span> (msg.what) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="number">100</span>:</div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                        <span class="comment">// 获取保存在代理的 intent 中的插件的 intent</span></div><div class="line">                        Field intentField = msg.obj.getClass().getDeclaredField(<span class="string">"intent"</span>);</div><div class="line">                        intentField.setAccessible(<span class="keyword">true</span>);</div><div class="line">                        Intent proxyIntent = (Intent) intentField.get(msg.obj);</div><div class="line">                        Intent intent = proxyIntent.getParcelableExtra(TARGET_INTENT);</div><div class="line">                        <span class="comment">// 判断调用的是否是插件的，如果不是插件的，intent 就会为空</span></div><div class="line">                        <span class="keyword">if</span> (intent != <span class="keyword">null</span>) &#123;</div><div class="line">                            intentField.set(msg.obj, intent);</div><div class="line">                        &#125;</div><div class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                        Log.e(<span class="string">"aaaaa"</span>, <span class="string">"aaaaa"</span> + e.getMessage());</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">case</span> <span class="number">159</span>:</div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                        Class&lt;?&gt; clazz = Class.forName(<span class="string">"android.app.servertransaction.ClientTransaction"</span>);</div><div class="line">                        Field mActivityCallbacksField = clazz.getDeclaredField(<span class="string">"mActivityCallbacks"</span>);</div><div class="line">                        mActivityCallbacksField.setAccessible(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">                        List activityCallbacks = (List) mActivityCallbacksField.get(msg.obj);</div><div class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; activityCallbacks.size(); i++) &#123;</div><div class="line">                            <span class="keyword">if</span> (activityCallbacks.get(i).getClass().getName() .equals(<span class="string">"android.app.servertransaction.LaunchActivityItem"</span>)) &#123;</div><div class="line">                                Object launchActivityItem = activityCallbacks.get(i);</div><div class="line">                                Field mIntentField = launchActivityItem.getClass().getDeclaredField(<span class="string">"mIntent"</span>);</div><div class="line">                                mIntentField.setAccessible(<span class="keyword">true</span>);</div><div class="line">                                Intent proxyIntent = (Intent) mIntentField.get(launchActivityItem);</div><div class="line">                                <span class="comment">// 判断调用的是否是插件的，如果不是插件的，intent 就会为空</span></div><div class="line">                                Intent intent = proxyIntent.getParcelableExtra(TARGET_INTENT);</div><div class="line">                                <span class="keyword">if</span> (intent != <span class="keyword">null</span>) &#123;</div><div class="line">                                    mIntentField.set(launchActivityItem, intent);</div><div class="line">                                &#125;</div><div class="line">                                <span class="keyword">break</span>;</div><div class="line">                            &#125;</div><div class="line">                        &#125;</div><div class="line">                    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                        Log.e(<span class="string">"aaaaa"</span>, <span class="string">"aaaaa"</span> + e.getMessage());</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">    Log.e(<span class="string">"aaaaa"</span>, <span class="string">"aaaaa"</span> + e.getMessage());</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="启动插件的-Activity"><a href="#启动插件的-Activity" class="headerlink" title="启动插件的 Activity"></a><strong>启动插件的 Activity</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent();</div><div class="line">intent.setComponent(<span class="keyword">new</span> ComponentName(<span class="string">"io.weichao.plugin"</span>, <span class="string">"io.weichao.plugin.activity.MainActivity"</span>));</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure><hr><h1 id="让插件中的-Activity-加载插件中的资源"><a href="#让插件中的-Activity-加载插件中的资源" class="headerlink" title="让插件中的 Activity 加载插件中的资源"></a><strong>让插件中的 Activity 加载插件中的资源</strong></h1><h2 id="前期铺垫"><a href="#前期铺垫" class="headerlink" title="前期铺垫"></a><strong>前期铺垫</strong></h2><p>1、加载 res 中的资源是通过 Resources，但是最后也是调用 AssetManager，只是会先通过 id 查找。AssetManager 可以加载未编译过的资源。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">getResources().getString(R.string.app_name);</div><div class="line"></div><div class="line"><span class="comment">// Resources</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getString</span><span class="params">(@StringRes <span class="keyword">int</span> id)</span> <span class="keyword">throws</span> NotFoundException </span>&#123;</div><div class="line">    <span class="keyword">return</span> getText(id).toString();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@NonNull</span> <span class="function"><span class="keyword">public</span> CharSequence <span class="title">getText</span><span class="params">(@StringRes <span class="keyword">int</span> id)</span> <span class="keyword">throws</span> NotFoundException </span>&#123;</div><div class="line">    CharSequence res = mResourcesImpl.getAssets().getResourceText(id);</div><div class="line">    <span class="keyword">if</span> (res != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> res;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NotFoundException(<span class="string">"String resource ID #0x"</span></div><div class="line">            + Integer.toHexString(id));</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、启动 Activity 时会调用 ActivityThread#performLaunchActivity()，此时建立了 Resources、AssetManager 和 Context 的绑定关系，并且指定了资源目录。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ActivityThread</span></div><div class="line"><span class="function"><span class="keyword">private</span> Activity <span class="title">performLaunchActivity</span><span class="params">(ActivityClientRecord r, Intent customIntent)</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    ContextImpl appContext = createBaseContextForActivity(r);</div><div class="line">    ...</div><div class="line">    activity.attach(appContext, ...);</div><div class="line">    ...</div><div class="line">    <span class="keyword">return</span> activity;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> ContextImpl <span class="title">createBaseContextForActivity</span><span class="params">(ActivityClientRecord r)</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    ContextImpl appContext = ContextImpl.createActivityContext(</div><div class="line">            <span class="keyword">this</span>, r.packageInfo, r.activityInfo, r.token, displayId, r.overrideConfig);</div><div class="line">    ...</div><div class="line">    <span class="keyword">return</span> appContext;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ContextImpl</span></div><div class="line"><span class="function"><span class="keyword">static</span> ContextImpl <span class="title">createActivityContext</span><span class="params">(ActivityThread mainThread,</span></span></div><div class="line"><span class="function"><span class="params">        LoadedApk packageInfo, ActivityInfo activityInfo, IBinder activityToken, <span class="keyword">int</span> displayId,</span></span></div><div class="line"><span class="function"><span class="params">        Configuration overrideConfiguration)</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    ContextImpl context = <span class="keyword">new</span> ContextImpl(<span class="keyword">null</span>, mainThread, packageInfo, activityInfo.splitName, activityToken, <span class="keyword">null</span>, <span class="number">0</span>, classLoader);</div><div class="line">    ...</div><div class="line">    <span class="comment">// Context 绑定 Resources</span></div><div class="line">    <span class="keyword">final</span> ResourcesManager resourcesManager = ResourcesManager.getInstance();</div><div class="line">    context.setResources(resourcesManager.createBaseActivityResources(activityToken,</div><div class="line">            packageInfo.getResDir(),</div><div class="line">            splitDirs,</div><div class="line">            packageInfo.getOverlayDirs(),</div><div class="line">            packageInfo.getApplicationInfo().sharedLibraryFiles,</div><div class="line">            displayId,</div><div class="line">            overrideConfiguration,</div><div class="line">            compatInfo,</div><div class="line">            classLoader));</div><div class="line">    ...</div><div class="line">    <span class="keyword">return</span> context;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// ResourcesManager</span></div><div class="line"><span class="keyword">public</span> <span class="meta">@Nullable</span> <span class="function">Resources <span class="title">createBaseActivityResources</span><span class="params">(@NonNull IBinder activityToken,</span></span></div><div class="line"><span class="function"><span class="params">        @Nullable String resDir,</span></span></div><div class="line"><span class="function"><span class="params">        @Nullable String[] splitResDirs,</span></span></div><div class="line"><span class="function"><span class="params">        @Nullable String[] overlayDirs,</span></span></div><div class="line"><span class="function"><span class="params">        @Nullable String[] libDirs,</span></span></div><div class="line"><span class="function"><span class="params">        <span class="keyword">int</span> displayId,</span></span></div><div class="line"><span class="function"><span class="params">        @Nullable Configuration overrideConfig,</span></span></div><div class="line"><span class="function"><span class="params">        @NonNull CompatibilityInfo compatInfo,</span></span></div><div class="line"><span class="function"><span class="params">        @Nullable ClassLoader classLoader)</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="keyword">return</span> getOrCreateResources(activityToken, key, classLoader);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="meta">@Nullable</span> <span class="function">Resources <span class="title">getOrCreateResources</span><span class="params">(@Nullable IBinder activityToken,</span></span></div><div class="line"><span class="function"><span class="params">        @NonNull ResourcesKey key, @NonNull ClassLoader classLoader)</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    ResourcesImpl resourcesImpl = createResourcesImpl(key);</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="meta">@Nullable</span> <span class="function">ResourcesImpl <span class="title">createResourcesImpl</span><span class="params">(@NonNull ResourcesKey key)</span> </span>&#123;</div><div class="line">    ...</div><div class="line">    <span class="keyword">final</span> AssetManager assets = createAssetManager(key);</div><div class="line">    ...</div><div class="line">    <span class="comment">// Resources 绑定 AssetManager</span></div><div class="line">    <span class="keyword">final</span> ResourcesImpl impl = <span class="keyword">new</span> ResourcesImpl(assets, dm, config, daj);</div><div class="line">    ...</div><div class="line">    <span class="keyword">return</span> impl;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">protected</span> <span class="meta">@Nullable</span> <span class="function">AssetManager <span class="title">createAssetManager</span><span class="params">(@NonNull <span class="keyword">final</span> ResourcesKey key)</span> </span>&#123;</div><div class="line">    AssetManager assets = <span class="keyword">new</span> AssetManager();</div><div class="line">    <span class="keyword">if</span> (key.mResDir != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="comment">// 调用 AssetManager#addAssetPath() 添加资源目录</span></div><div class="line">        <span class="keyword">if</span> (assets.addAssetPath(key.mResDir) == <span class="number">0</span>) &#123;</div><div class="line">            Log.e(TAG, <span class="string">"failed to add asset path "</span> + key.mResDir);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a><strong>原理</strong></h2><ol><li>创建 AssetManager，反射 addAssetPath 方法设置插件的资源目录；</li><li>创建 Resources，绑定该 AssetManager；</li><li>在 Application 中重写 getResources()，使用该 Resources；</li><li>在插件的 Activity 中重写 getResources()，使用 Application 中的 Resources。</li></ol><h2 id="核心代码-2"><a href="#核心代码-2" class="headerlink" title="核心代码"></a><strong>核心代码</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// LoadUtil.java</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Resources <span class="title">loadResource</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        AssetManager assetManager = AssetManager.class.newInstance();</div><div class="line">        Method addAssetPathMethod = assetManager.getClass().getDeclaredMethod(<span class="string">"addAssetPath"</span>, String.class);</div><div class="line">        addAssetPathMethod.setAccessible(<span class="keyword">true</span>);</div><div class="line">        <span class="comment">// 参数就是插件的资源路径</span></div><div class="line">        addAssetPathMethod.invoke(assetManager, apkPath);</div><div class="line">        Resources resources = context.getResources();</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Resources(assetManager, resources.getDisplayMetrics(), resources.getConfiguration());</div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> Resources resources;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        resources = LoadUtil.loadResource(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Resources <span class="title">getResources</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> resources == <span class="keyword">null</span> ? <span class="keyword">super</span>.getResources() : resources;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Resources <span class="title">getResources</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (getApplication() != <span class="keyword">null</span> &amp;&amp; getApplication().getResources() != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> getApplication().getResources();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getResources();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="当宿主的-Activity-和插件的-Activity-都继承于-AppCompatActivity-时会报错"><a href="#当宿主的-Activity-和插件的-Activity-都继承于-AppCompatActivity-时会报错" class="headerlink" title="当宿主的 Activity 和插件的 Activity 都继承于 AppCompatActivity 时会报错"></a><strong>当宿主的 Activity 和插件的 Activity 都继承于 AppCompatActivity 时会报错</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">java.lang.RuntimeException: Unable to start activity ComponentInfo&#123;io.weichao.plugin/io.weichao.plugin.activity.MainActivity&#125;: java.lang.NullPointerException: Attempt to invoke interface method &apos;void androidx.appcompat.widget.DecorContentParent.setWindowCallback(android.view.Window$Callback)&apos; on a null object reference</div><div class="line">        at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2913)</div><div class="line">        at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3048)</div><div class="line">        at android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:78)</div><div class="line">        at android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:108)</div><div class="line">        at android.app.servertransaction.TransactionExecutor.execute(TransactionExecutor.java:68)</div><div class="line">        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1808)</div><div class="line">        at android.os.Handler.dispatchMessage(Handler.java:106)</div><div class="line">        at android.os.Looper.loop(Looper.java:193)</div><div class="line">        at android.app.ActivityThread.main(ActivityThread.java:6669)</div><div class="line">        at java.lang.reflect.Method.invoke(Native Method)</div><div class="line">        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:493)</div><div class="line">        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:858)</div><div class="line">     Caused by: java.lang.NullPointerException: Attempt to invoke interface method &apos;void androidx.appcompat.widget.DecorContentParent.setWindowCallback(android.view.Window$Callback)&apos; on a null object reference</div><div class="line">        at androidx.appcompat.app.AppCompatDelegateImpl.createSubDecor(AppCompatDelegateImpl.java:753)</div><div class="line">        at androidx.appcompat.app.AppCompatDelegateImpl.ensureSubDecor(AppCompatDelegateImpl.java:659)</div><div class="line">        at androidx.appcompat.app.AppCompatDelegateImpl.setContentView(AppCompatDelegateImpl.java:552)</div><div class="line">        at androidx.appcompat.app.AppCompatActivity.setContentView(AppCompatActivity.java:161)</div><div class="line">        at io.weichao.plugin.activity.MainActivity.onCreate(MainActivity.java:15)</div><div class="line">        at android.app.Activity.performCreate(Activity.java:7136)</div><div class="line">        at android.app.Activity.performCreate(Activity.java:7127)</div><div class="line">        at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1271)</div><div class="line">        at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:2893)</div><div class="line">        at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:3048) </div><div class="line">        at android.app.servertransaction.LaunchActivityItem.execute(LaunchActivityItem.java:78) </div><div class="line">        at android.app.servertransaction.TransactionExecutor.executeCallbacks(TransactionExecutor.java:108) </div><div class="line">        at android.app.servertransaction.TransactionExecutor.execute(TransactionExecutor.java:68) </div><div class="line">        at android.app.ActivityThread$H.handleMessage(ActivityThread.java:1808) </div><div class="line">        at android.os.Handler.dispatchMessage(Handler.java:106) </div><div class="line">        at android.os.Looper.loop(Looper.java:193) </div><div class="line">        at android.app.ActivityThread.main(ActivityThread.java:6669) </div><div class="line">        at java.lang.reflect.Method.invoke(Native Method) </div><div class="line">        at com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:493) </div><div class="line">        at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:858)</div></pre></td></tr></table></figure><h3 id="报错的原因"><a href="#报错的原因" class="headerlink" title="报错的原因"></a><strong>报错的原因</strong></h3><p>当宿主和插件都使用 AppCompatActivity 时，由于编译时会将资源建立映射关系，在宿主和插件中分别建立了 1 次映射关系，且这 2 次映射关系基本上不会相同。在宿主中 key1 -&gt; value1，在插件中 key2 -&gt; value2。<br>但是 AppCompatDelegateImpl 类只会在宿主中被加载一次，也就是宿主和插件都使用 key1 查找资源。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%8F%92%E4%BB%B6%E5%8C%96202004096.png" alt=""></p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%8F%92%E4%BB%B6%E5%8C%96202004097.png" alt=""></p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%8F%92%E4%BB%B6%E5%8C%96202004098.png" alt=""></p><h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a><strong>解决办法</strong></h3><p>让插件使用自己的 Resource。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">protected</span> Context mContext;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line"></div><div class="line">        Resources resource = LoadUtil.getResource(getApplication());</div><div class="line">        mContext = <span class="keyword">new</span> ContextThemeWrapper(getBaseContext(), <span class="number">0</span>);</div><div class="line">        Class&lt;? extends Context&gt; clazz = mContext.getClass();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Field mResourcesField = clazz.getDeclaredField(<span class="string">"mResources"</span>);</div><div class="line">            mResourcesField.setAccessible(<span class="keyword">true</span>);</div><div class="line">            mResourcesField.set(mContext, resource);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        View view = LayoutInflater.from(mContext).inflate(R.layout.activity_main, <span class="keyword">null</span>);</div><div class="line">        setContentView(view);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;ClassLoader-加载-dex-文件&quot;&gt;&lt;a href=&quot;#ClassLoader-加载-dex-文件&quot; class=&quot;headerlink&quot; title=&quot;ClassLoader 加载 dex 文件&quot;&gt;&lt;/a&gt;&lt;strong&gt;ClassLoader 加载 
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>《剑指 Offer》算法题（20/68）</title>
    <link href="http://www.weichao.io/2020/03/23/%E3%80%8A%E5%89%91%E6%8C%87-Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%8820-68%EF%BC%89/"/>
    <id>http://www.weichao.io/2020/03/23/《剑指-Offer》算法题（20-68）/</id>
    <published>2020-03-23T09:40:49.000Z</published>
    <updated>2020-03-23T09:48:56.782Z</updated>
    
    <content type="html"><![CDATA[<h1 id="旋转数组的最小数字"><a href="#旋转数组的最小数字" class="headerlink" title="旋转数组的最小数字"></a><strong>旋转数组的最小数字</strong></h1><blockquote><p>把一个数组最开始的若干个元素搬到数组的末尾，我们称之为数组的旋转。输入一个递增排序的数组的一个旋转，输出旋转数组的最小元素。例如数组 {3, 4, 5, 1, 2} 为 {1, 2, 3, 4, 5} 的一个旋转，该数组的最小值为 1。</p></blockquote><p>思路：<br>输入数组可以看成是两个递增数组的连接，其中第 2 个数组中的每一个值都不大于第 1 个数组中的任意一个值，且最小值是第 2 个数组的第 1 个值。<br>对于递增数组查询最小值，可以使用二分法查找。二分法涉及 3 个值，分别记为 a、b、c，分情况讨论——<br>（0）a &gt; b &gt; c，不存在；<br>（1）a &lt; b &lt; c，此时 a、b、c 都在后面数组，最小值是 a；<br>（2）a &lt; b = c，此时 a、b、c 都在后面数组，最小值是 a；<br>（3）a = b &lt; c，此时 a、b、c 都在后面数组，最小值是 a；<br>（4）a &lt; b，b &gt; c，此时 a、b 在前面数组，c 在后面数组，最小值在 b、c 之间，如果 b 是 c 的前一个元素，则最小值是 c；<br>（5）a = b，b &gt; c，此时 a、b 在前面数组，c 在后面数组，最小值在 b、c 之间，如果 b 是 c 的前一个元素，则最小值是 c；<br>（6）a &gt; b，b &lt; c，此时 a 在前面数组，b、c 在后面数组，最小值在 a、b 之间，如果 a 是 b 的前一个元素，则最小值是 b；<br>（7）a &gt; b，b = c，此时 a 在前面数组，b、c 在后面数组，最小值在 a、b 之间，如果 a 是 b 的前一个元素，则最小值是 b；<br>（8）a = b = c，如果 a、b、c 是连续的 3 个数，则最小值是 a；否则无法确定最小值所在区间，只能既查找 a、b 区间，也查找 b、c 区间，一旦在其中某个区间发现更小的值，就能够缩小查找范围。<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%882068%EF%BC%891.png" alt=""></p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> start = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> end = arr.length - <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (end &gt; start) &#123;</div><div class="line">        <span class="keyword">int</span> middle = ((end - start) &gt;&gt; <span class="number">1</span>) + start;</div><div class="line"></div><div class="line">        <span class="comment">// 合并（1）（2）（3）</span></div><div class="line">        <span class="keyword">if</span> ((arr[start] &lt; arr[middle] &amp;&amp; arr[middle] &lt;= arr[end])</div><div class="line">                || (arr[start] == arr[middle] &amp;&amp; arr[middle] &lt; arr[end])) &#123;</div><div class="line">            <span class="keyword">return</span> arr[start];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// 合并（4）（5）</span></div><div class="line">        <span class="keyword">if</span> (arr[start] &lt;= arr[middle] &amp;&amp; arr[middle] &gt; arr[end]) &#123;</div><div class="line">            <span class="keyword">if</span> (end - middle == <span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">return</span> arr[end];</div><div class="line">            &#125;</div><div class="line">            start = middle + <span class="number">1</span>;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// 合并（6）（7）</span></div><div class="line">        <span class="keyword">if</span> ((arr[start] &gt; arr[middle] &amp;&amp; arr[middle] &lt;= arr[end])) &#123;</div><div class="line">            <span class="keyword">if</span> (middle - start == <span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">return</span> arr[middle];</div><div class="line">            &#125;</div><div class="line">            end = middle;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// （8）</span></div><div class="line">        <span class="keyword">if</span> (arr[middle] == arr[end] || arr[middle] == arr[start]) &#123;</div><div class="line">            <span class="keyword">if</span> (middle - start == <span class="number">1</span> &amp;&amp; end - middle == <span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">return</span> arr[start];</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">int</span>[] range = findRange(arr, start, end);</div><div class="line">            <span class="keyword">if</span> (range[<span class="number">0</span>] == range[<span class="number">1</span>]) &#123;</div><div class="line">                <span class="keyword">return</span> arr[range[<span class="number">0</span>]];</div><div class="line">            &#125;</div><div class="line">            start = range[<span class="number">0</span>];</div><div class="line">            end = range[<span class="number">1</span>];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] findRange(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> start, <span class="keyword">int</span> end) &#123;</div><div class="line">    <span class="keyword">int</span>[] popArr = &#123;start, end&#125;;</div><div class="line"></div><div class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">        <span class="keyword">int</span>[] pushArr = <span class="keyword">new</span> <span class="keyword">int</span>[(popArr.length &lt;&lt; <span class="number">1</span>) - <span class="number">1</span>];</div><div class="line">        pushArr[<span class="number">0</span>] = popArr[<span class="number">0</span>];</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, size = popArr.length; i &lt; size - <span class="number">1</span>; i++) &#123;</div><div class="line">            Result result = getResult(arr, popArr[i], popArr[i + <span class="number">1</span>]);</div><div class="line">            <span class="keyword">if</span> (result.isFound()) &#123;</div><div class="line">                <span class="keyword">return</span> result.getRange();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// 已经逐个查找了，还是没找到，说明数组从 start 到 end 的值都一样</span></div><div class="line">                <span class="keyword">if</span> (popArr.length &gt; end - start) &#123;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;start, start&#125;;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">int</span> middle = result.getMiddle();</div><div class="line">                pushArr[++j] = middle;</div><div class="line">                pushArr[++j] = popArr[i + <span class="number">1</span>];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        popArr = pushArr;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> Result <span class="title">getResult</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> middle = ((end - start) &gt;&gt; <span class="number">1</span>) + start;</div><div class="line">    <span class="keyword">if</span> (arr[middle] &lt; arr[start]) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(<span class="keyword">new</span> <span class="keyword">int</span>[]&#123;start, end&#125;);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Result(middle);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Result</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> found;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[] range;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> middle;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Result</span><span class="params">(<span class="keyword">int</span>[] range)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.found = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">this</span>.range = range;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Result</span><span class="params">(<span class="keyword">int</span> middle)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.found = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">this</span>.middle = middle;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFound</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> found;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[] getRange() &#123;</div><div class="line">        <span class="keyword">return</span> range;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getMiddle</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> middle;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span> + <span class="keyword">new</span> Random().nextInt(<span class="number">50</span>)];</div><div class="line"><span class="keyword">int</span> divideIndex = <span class="keyword">new</span> Random().nextInt(arr.length);</div><div class="line"><span class="keyword">int</span> dividerTemp = arr.length &gt;&gt; <span class="number">2</span>;</div><div class="line"><span class="keyword">int</span> temp = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; divideIndex; i++) &#123; <span class="comment">// 初始化第 1 个数组</span></div><div class="line">    temp += <span class="keyword">new</span> Random().nextInt(<span class="number">2</span>);</div><div class="line">    <span class="keyword">if</span> (temp &lt; dividerTemp) &#123;</div><div class="line">        temp = dividerTemp;</div><div class="line">    &#125;</div><div class="line">    arr[i] = temp;</div><div class="line">&#125;</div><div class="line">temp = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = divideIndex, size = arr.length; i &lt; size; i++) &#123; <span class="comment">// 初始化第 2 个数组</span></div><div class="line">    temp += <span class="keyword">new</span> Random().nextInt(<span class="number">2</span>);</div><div class="line">    <span class="keyword">if</span> (temp &gt; dividerTemp) &#123;</div><div class="line">        temp = dividerTemp;</div><div class="line">    &#125;</div><div class="line">    arr[i] = temp;</div><div class="line">&#125;</div><div class="line">System.out.println(<span class="string">"arr:"</span> + Arrays.toString(arr));</div><div class="line"></div><div class="line"><span class="keyword">int</span> min = find(arr);</div><div class="line">System.out.println(<span class="string">"min:"</span> + min);</div></pre></td></tr></table></figure><p>时间复杂度：<br>空间复杂度：</p><hr><h1 id="矩阵中的路径"><a href="#矩阵中的路径" class="headerlink" title="矩阵中的路径"></a><strong>矩阵中的路径</strong></h1><blockquote><p>请设计一个函数，用来判断在一个矩阵中是否存在一条包含某字符串所有字符的路径。路径可以从矩阵中的任意一格开始，每一步可以在矩阵中向左、右、上、下移动一格。如果一条路径经过了矩阵的某一格，那么该路径不能再次进入该格子。</p></blockquote><p>思路：<br>回溯法。<br>遍历矩阵，如果矩阵中的某个值和字符串中的第一个值相同，则进入下一级，判断该值在周围四个方向的值和字符串中的下一个值是否相等，如果相等，则继续进入下一级，直到字符串中的值全部找完；否则，回到上一级。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">contains</span><span class="params">(<span class="keyword">char</span>[] arr, <span class="keyword">int</span> rows, <span class="keyword">int</span> cols, <span class="keyword">char</span>[] targetArr)</span> </span>&#123;</div><div class="line">    <span class="keyword">boolean</span>[] flagArr = <span class="keyword">new</span> <span class="keyword">boolean</span>[arr.length];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; cols; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (find(arr, flagArr, rows, i, cols, j, targetArr, <span class="number">0</span>)) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">find</span><span class="params">(<span class="keyword">char</span>[] arr, <span class="keyword">boolean</span>[] flagArr, <span class="keyword">int</span> rows, <span class="keyword">int</span> rowIndex, <span class="keyword">int</span> cols, <span class="keyword">int</span> colIndex, <span class="keyword">char</span>[] targetArr, <span class="keyword">int</span> targetIndex)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (rowIndex &lt; <span class="number">0</span> || rowIndex &gt; rows - <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (colIndex &lt; <span class="number">0</span> || colIndex &gt; cols - <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> index = rowIndex * cols + colIndex;</div><div class="line">    <span class="keyword">if</span> (flagArr[index] || arr[index] != targetArr[targetIndex]) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (targetIndex == targetArr.length - <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    flagArr[index] = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">if</span> (find(arr, flagArr, rows, rowIndex, cols, colIndex + <span class="number">1</span>, targetArr, targetIndex + <span class="number">1</span>)</div><div class="line">            || find(arr, flagArr, rows, rowIndex, cols, colIndex - <span class="number">1</span>, targetArr, targetIndex + <span class="number">1</span>)</div><div class="line">            || find(arr, flagArr, rows, rowIndex + <span class="number">1</span>, cols, colIndex, targetArr, targetIndex + <span class="number">1</span>)</div><div class="line">            || find(arr, flagArr, rows, rowIndex - <span class="number">1</span>, cols, colIndex, targetArr, targetIndex + <span class="number">1</span>)) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    flagArr[index] = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">char</span>[] arr = &#123;<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'t'</span>, <span class="string">'g'</span>, <span class="string">'c'</span>, <span class="string">'f'</span>, <span class="string">'c'</span>, <span class="string">'s'</span>, <span class="string">'j'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'h'</span>&#125;;</div><div class="line"><span class="keyword">boolean</span> b = contains(arr, <span class="number">3</span>, <span class="number">4</span>, <span class="keyword">new</span> <span class="keyword">char</span>[]&#123;<span class="string">'b'</span>, <span class="string">'f'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>&#125;);</div><div class="line">System.out.println(<span class="string">"contains:"</span> + b);</div></pre></td></tr></table></figure><p>时间复杂度：O(n)。<br>空间复杂度：O(n)。</p><h2 id="扩展：打印两个字符间的一条最短路径"><a href="#扩展：打印两个字符间的一条最短路径" class="headerlink" title="扩展：打印两个字符间的一条最短路径"></a><strong>扩展：打印两个字符间的一条最短路径</strong></h2><p>思路：<br>记录水平和竖直方向相对于起点位置的位移。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">findPath</span><span class="params">(<span class="keyword">char</span>[] arr, <span class="keyword">int</span> rows, <span class="keyword">int</span> cols, <span class="keyword">char</span> start, <span class="keyword">char</span> end)</span> </span>&#123;</div><div class="line">    <span class="keyword">boolean</span>[] flagArr = <span class="keyword">new</span> <span class="keyword">boolean</span>[arr.length];</div><div class="line">    Integer[] stepArr = &#123;<span class="number">0</span>, <span class="number">0</span>&#125;;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; cols; j++) &#123;</div><div class="line">            <span class="keyword">if</span> (arr[i * cols + j] != start) &#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (findPath(arr, flagArr, rows, i, <span class="number">0</span>, cols, j, <span class="number">0</span>, end, stepArr)) &#123;</div><div class="line">                StringBuilder builder = <span class="keyword">new</span> StringBuilder(<span class="number">1</span> + Math.abs(stepArr[<span class="number">0</span>]) + Math.abs(stepArr[<span class="number">1</span>]));</div><div class="line">                builder.append(start);</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (stepArr[<span class="number">0</span>] &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>, size = stepArr[<span class="number">0</span>]; k &lt;= size; k++) &#123;</div><div class="line">                        builder.append(arr[(i + k) * cols + j]);</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = -<span class="number">1</span>, size = stepArr[<span class="number">0</span>]; k &gt;= size; k--) &#123;</div><div class="line">                        builder.append(arr[(i + k) * cols + j]);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (stepArr[<span class="number">1</span>] &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>, size = stepArr[<span class="number">1</span>]; k &lt;= size; k++) &#123;</div><div class="line">                        builder.append(arr[(i + stepArr[<span class="number">0</span>]) * cols + j + k]);</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = -<span class="number">1</span>, size = stepArr[<span class="number">1</span>]; k &gt;= size; k--) &#123;</div><div class="line">                        builder.append(arr[(i + stepArr[<span class="number">0</span>]) * cols + j + k]);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">return</span> builder.toString();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">findPath</span><span class="params">(<span class="keyword">char</span>[] arr, <span class="keyword">boolean</span>[] flagArr, <span class="keyword">int</span> rows, <span class="keyword">int</span> rowIndex, <span class="keyword">int</span> rowOffset, <span class="keyword">int</span> cols, <span class="keyword">int</span> colIndex, <span class="keyword">int</span> colOffset, <span class="keyword">char</span> end, Integer[] stepArr)</span> </span>&#123;</div><div class="line">    rowIndex += rowOffset;</div><div class="line">    colIndex += colOffset;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (rowIndex &lt; <span class="number">0</span> || rowIndex &gt; rows - <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (colIndex &lt; <span class="number">0</span> || colIndex &gt; cols - <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> index = rowIndex * cols + colIndex;</div><div class="line">    <span class="keyword">if</span> (flagArr[index]) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (arr[index] == end) &#123;</div><div class="line">        stepArr[<span class="number">0</span>] += rowOffset;</div><div class="line">        stepArr[<span class="number">1</span>] += colOffset;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    flagArr[index] = <span class="keyword">true</span>;</div><div class="line">    stepArr[<span class="number">0</span>] += rowOffset;</div><div class="line">    stepArr[<span class="number">1</span>] += colOffset;</div><div class="line">    <span class="keyword">if</span> (findPath(arr, flagArr, rows, rowIndex, <span class="number">0</span>, cols, colIndex, <span class="number">1</span>, end, stepArr)</div><div class="line">            || findPath(arr, flagArr, rows, rowIndex, <span class="number">1</span>, cols, colIndex, <span class="number">0</span>, end, stepArr)</div><div class="line">            || findPath(arr, flagArr, rows, rowIndex, <span class="number">0</span>, cols, colIndex, -<span class="number">1</span>, end, stepArr)</div><div class="line">            || findPath(arr, flagArr, rows, rowIndex, -<span class="number">1</span>, cols, colIndex, <span class="number">0</span>, end, stepArr)) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    flagArr[index] = <span class="keyword">false</span>;</div><div class="line">    stepArr[<span class="number">0</span>] -= rowOffset;</div><div class="line">    stepArr[<span class="number">1</span>] -= colOffset;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> size = <span class="number">25</span>;</div><div class="line">LinkedHashSet&lt;Character&gt; set = <span class="keyword">new</span> LinkedHashSet&lt;&gt;((<span class="keyword">int</span>) (size * <span class="number">1.34</span>));</div><div class="line"><span class="keyword">while</span> (set.size() &lt; size) &#123;</div><div class="line">    set.add((<span class="keyword">char</span>) (<span class="string">'A'</span> + <span class="keyword">new</span> Random().nextInt(size)));</div><div class="line">&#125;</div><div class="line"></div><div class="line">Iterator&lt;Character&gt; iterator = set.iterator();</div><div class="line"><span class="keyword">char</span>[] arr = <span class="keyword">new</span> <span class="keyword">char</span>[size];</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</div><div class="line">    arr[i] = iterator.next();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</div><div class="line">        builder.append(arr[i * <span class="number">5</span> + j])</div><div class="line">                .append(<span class="string">" "</span>);</div><div class="line">    &#125;</div><div class="line">    System.out.println(builder.toString());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">char</span> start = arr[<span class="keyword">new</span> Random().nextInt(size)];</div><div class="line"><span class="keyword">char</span> end = arr[<span class="keyword">new</span> Random().nextInt(size)];</div><div class="line">String path = findPath(arr, <span class="number">5</span>, <span class="number">5</span>, start, end);</div><div class="line">System.out.println(start + <span class="string">"-&gt;"</span> + end + <span class="string">":"</span> + path);</div></pre></td></tr></table></figure><hr><h1 id="机器人的运动范围"><a href="#机器人的运动范围" class="headerlink" title="机器人的运动范围"></a><strong>机器人的运动范围</strong></h1><blockquote><p>地上有一个 m 行 n 列的方格。一个机器人从坐标 (0, 0) 的格子开始移动，它每次可以向左、右、上、下移动一格，但不能进入行坐标和列坐标的数位之和大于 k 的格子。例如，当 k 为 18 时，机器人能够进入方格 (35, 37)，因为 3 + 5 + 3 + 7 = 18。但它不能进入方格 (35, 38)，因为 3 + 5 + 3 + 8 = 19。请问该机器人能够达到多少个格子？</p></blockquote><p>思路：<br>回溯法。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">count</span><span class="params">(<span class="keyword">int</span> rows, <span class="keyword">int</span> cols, <span class="keyword">int</span> threshold)</span> </span>&#123;</div><div class="line">    <span class="keyword">boolean</span>[][] flagArr = <span class="keyword">new</span> <span class="keyword">boolean</span>[rows][cols];</div><div class="line">    <span class="keyword">return</span> count(flagArr, rows, <span class="number">0</span>, cols, <span class="number">0</span>, threshold);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">count</span><span class="params">(<span class="keyword">boolean</span>[][] flagArr, <span class="keyword">int</span> rows, <span class="keyword">int</span> rowIndex, <span class="keyword">int</span> cols, <span class="keyword">int</span> colIndex, <span class="keyword">int</span> threshold)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (rowIndex &lt; <span class="number">0</span> || rowIndex &gt; rows - <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (colIndex &lt; <span class="number">0</span> || colIndex &gt; cols - <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (flagArr[rowIndex][colIndex]) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (!canEnter(rowIndex, colIndex, threshold)) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    flagArr[rowIndex][colIndex] = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span> + count(flagArr, rows, rowIndex, cols, colIndex + <span class="number">1</span>, threshold)</div><div class="line">            + count(flagArr, rows, rowIndex + <span class="number">1</span>, cols, colIndex, threshold)</div><div class="line">            + count(flagArr, rows, rowIndex, cols, colIndex - <span class="number">1</span>, threshold)</div><div class="line">            + count(flagArr, rows, rowIndex - <span class="number">1</span>, cols, colIndex, threshold);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">canEnter</span><span class="params">(<span class="keyword">int</span> row, <span class="keyword">int</span> col, <span class="keyword">int</span> threshold)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (row &gt; <span class="number">0</span>) &#123;</div><div class="line">        sum += row % <span class="number">10</span>;</div><div class="line">        row /= <span class="number">10</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">while</span> (col &gt; <span class="number">0</span>) &#123;</div><div class="line">        sum += col % <span class="number">10</span>;</div><div class="line">        col /= <span class="number">10</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> !(sum &gt; threshold);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> m = <span class="number">10</span> + <span class="keyword">new</span> Random().nextInt(<span class="number">10</span>);</div><div class="line"><span class="keyword">int</span> n = <span class="number">10</span> + <span class="keyword">new</span> Random().nextInt(<span class="number">10</span>);</div><div class="line"><span class="keyword">int</span> k = <span class="keyword">new</span> Random().nextInt(m + n);</div><div class="line"><span class="keyword">int</span> count = count(m, n, k);</div><div class="line">System.out.println(<span class="string">"m="</span> + m + <span class="string">"; n="</span> + n + <span class="string">"; k="</span> + k + <span class="string">"; count="</span> + count);</div></pre></td></tr></table></figure><p>时间复杂度：<br>空间复杂度：</p><hr><h1 id="剪绳子"><a href="#剪绳子" class="headerlink" title="剪绳子"></a><strong>剪绳子</strong></h1><blockquote><p>给你一根长度为 n 的绳子，请把绳子剪成 m 段（m、n 都是整数，n &gt; 1 并且 m &gt; 1），每段绳子的长度记为 k[0]，k[1]，…，k[m]。请问 k[0] x k[1] x … x k[m] 可能的最大乘积是多少？例如，当绳子的长度是 8 时，我们把它剪成长度分别为 2、3、3 的三段，此时得到的最大乘积是 18。</p></blockquote><p>思路：<br>（1）动态规划法。<br>任何一根长度为 n 的绳子都可以分为两根长度之和为 n 的绳子，如果其中一根绳子长度为 x，则另一根绳子长度为 n - x。这样，问题就转变为了求两个绳子的问题了，这两根绳子可以再继续一分为二，直至绳子长度为 1，因为 1 分成两个小于 1 的数后，再相乘时值更小。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> n)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"arg must over 1"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 长度 2、3 的绳子不能单独存在，必须至少分出一个 1，然后再计算乘积</span></div><div class="line">    <span class="keyword">if</span> (n == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (n == <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">long</span>[] maxArr = <span class="keyword">new</span> <span class="keyword">long</span>[n + <span class="number">1</span>];</div><div class="line">    <span class="comment">// 长度 1、2、3 的绳子作为两段绳子中的一段存在</span></div><div class="line">    maxArr[<span class="number">1</span>] = <span class="number">1</span>;</div><div class="line">    maxArr[<span class="number">2</span>] = <span class="number">2</span>;</div><div class="line">    maxArr[<span class="number">3</span>] = <span class="number">3</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">4</span>; i &lt;= n; i++) &#123;</div><div class="line">        <span class="keyword">long</span> max = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>, length = i &gt;&gt; <span class="number">1</span>; j &lt;= length; j++) &#123;</div><div class="line">            <span class="keyword">long</span> temp = maxArr[j] * maxArr[i - j];</div><div class="line">            <span class="keyword">if</span> (temp &lt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"too big!!!"</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (temp &gt; max) &#123;</div><div class="line">                max = temp;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        maxArr[i] = max;</div><div class="line">    &#125;</div><div class="line">    System.out.println(Arrays.toString(maxArr));</div><div class="line">    <span class="keyword">return</span> maxArr[n];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> n = <span class="keyword">new</span> Random().nextInt(<span class="number">100</span>);</div><div class="line">System.out.println(<span class="string">"n="</span> + n + <span class="string">"; max:"</span> + max(n));</div></pre></td></tr></table></figure><p>时间复杂度：O(n^2)。<br>空间复杂度：O(n)。</p><h2 id="扩展：打印剪绳子的具体方案"><a href="#扩展：打印剪绳子的具体方案" class="headerlink" title="扩展：打印剪绳子的具体方案"></a><strong>扩展：打印剪绳子的具体方案</strong></h2><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> n)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"arg must over 1"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 长度 2、3 的绳子不能单独存在，必须至少分出一个 1，然后再计算乘积</span></div><div class="line">    <span class="keyword">if</span> (n == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (n == <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Node[] maxArr = <span class="keyword">new</span> Node[n + <span class="number">1</span>];</div><div class="line">    <span class="comment">// 长度 1、2、3 的绳子作为两段绳子中的一段存在</span></div><div class="line">    maxArr[<span class="number">1</span>] = <span class="keyword">new</span> Node(<span class="number">1</span>, <span class="number">1</span>, <span class="string">"1"</span>);</div><div class="line">    maxArr[<span class="number">2</span>] = <span class="keyword">new</span> Node(<span class="number">2</span>, <span class="number">2</span>, <span class="string">"2"</span>);</div><div class="line">    maxArr[<span class="number">3</span>] = <span class="keyword">new</span> Node(<span class="number">3</span>, <span class="number">3</span>, <span class="string">"3"</span>);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">4</span>; i &lt;= n; i++) &#123;</div><div class="line">        <span class="keyword">long</span> max = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>, length = i &gt;&gt; <span class="number">1</span>; j &lt;= length; j++) &#123;</div><div class="line">            <span class="keyword">long</span> temp = maxArr[j].getValue() * maxArr[i - j].getValue();</div><div class="line">            <span class="keyword">if</span> (temp &lt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"too big!!!"</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (temp &gt; max) &#123;</div><div class="line">                max = temp;</div><div class="line">                maxArr[i] = <span class="keyword">new</span> Node(i, max, maxArr[j].getNote() + <span class="string">" * "</span> + maxArr[i - j].getNote());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    System.out.println(Arrays.toString(maxArr));</div><div class="line">    <span class="keyword">return</span> maxArr[n].getValue();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">long</span> value;</div><div class="line">    <span class="keyword">private</span> String note;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">long</span> value, String note)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.n = n;</div><div class="line">        <span class="keyword">this</span>.value = value;</div><div class="line">        <span class="keyword">this</span>.note = note;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNote</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> note;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"["</span> + n + <span class="string">"]="</span> + value + <span class="string">": "</span> + note + <span class="string">"\n"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> n = <span class="keyword">new</span> Random().nextInt(<span class="number">100</span>);</div><div class="line">System.out.println(<span class="string">"n="</span> + n + <span class="string">"; max:"</span> + max(n));</div></pre></td></tr></table></figure><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%882068%EF%BC%892.png" alt=""></p><p>（2）贪婪算法。<br>根据剪绳子的具体方案可以发现，长度为 n 的绳子，剪成的 m 段绳子，基本是由长度为 2、3 的绳子组成的，比较<code>3 * (n - 3)</code>和<code>2 * (n - 2)</code>，当<code>n &gt;= 5</code>时，<code>3 * (n - 3) &gt;= 2 * (n - 2)</code>，所以当长度大于或等于 5 时，应优先剪 3；否则，剪 2。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> n)</span> <span class="keyword">throws</span> IllegalArgumentException </span>&#123;</div><div class="line">    <span class="keyword">if</span> (n &lt;= <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"arg must over 1"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 长度 2、3 的绳子不能单独存在，必须至少分出一个 1，然后再计算乘积</span></div><div class="line">    <span class="keyword">if</span> (n == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (n == <span class="number">3</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> count = (n &gt;&gt; <span class="number">1</span>) - (n &gt;&gt; <span class="number">2</span>);</div><div class="line">    <span class="keyword">int</span> r = n % <span class="number">3</span>;</div><div class="line">    <span class="keyword">if</span> (r == <span class="number">2</span>) &#123; <span class="comment">// 处理 5</span></div><div class="line">        <span class="keyword">long</span> sum = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</div><div class="line">            sum += (sum &lt;&lt; <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sum &lt;&lt; <span class="number">1</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (r == <span class="number">1</span>) &#123; <span class="comment">// 处理 4</span></div><div class="line">        <span class="keyword">long</span> sum = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count - <span class="number">1</span>; i++) &#123;</div><div class="line">            sum += (sum &lt;&lt; <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sum &lt;&lt; <span class="number">2</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 处理 0</span></div><div class="line">        <span class="keyword">long</span> sum = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</div><div class="line">            sum += (sum &lt;&lt; <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> sum;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> n = <span class="keyword">new</span> Random().nextInt(<span class="number">100</span>);</div><div class="line">System.out.println(<span class="string">"n="</span> + n + <span class="string">"; max:"</span> + max(n));</div></pre></td></tr></table></figure><p>时间复杂度：O(1)。<br>空间复杂度：O(1)。</p><hr><h1 id="二进制中-1-的个数"><a href="#二进制中-1-的个数" class="headerlink" title="二进制中 1 的个数"></a><strong>二进制中 1 的个数</strong></h1><blockquote><p>请实现一个函数，输入一个整数，输出该数二进制表示中 1 的个数。例如，把 9 表示成二进制是 1001，有 2 位是 1。因此，如果输入 9，则该函数输出 2。</p></blockquote><p>思路：<br>n &amp; (n - 1)。<br>（1）当 n 的最右位是 1，n - 1 只是将最右位的 1 变为 0；<br>（2）当 n 的最右位是 0，n - 1 会先前找 1，找到后将该位置的 1 变为 0，该位置后面全部变为 1，然后变为了（1）；<br>所以当 n != 0 时，n &amp; (n - 1) 的操作会将最右边的 1 变为 0。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">count</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (n != <span class="number">0</span>) &#123;</div><div class="line">        count++;</div><div class="line">        n = n &amp; (n - <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> count;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> n = <span class="keyword">new</span> Random().nextInt();</div><div class="line">System.out.println(n + <span class="string">"="</span> + Integer.toBinaryString(n) + <span class="string">"b:"</span> + count(n));</div></pre></td></tr></table></figure><p>时间复杂度：O(n)。<br>空间复杂度：O(1)。</p><h2 id="相关题目：用一条语句判断一个整数是不是-2-的整数次方"><a href="#相关题目：用一条语句判断一个整数是不是-2-的整数次方" class="headerlink" title="相关题目：用一条语句判断一个整数是不是 2 的整数次方"></a><strong>相关题目：用一条语句判断一个整数是不是 2 的整数次方</strong></h2><p>思路：<br>一个整数如果是 2 的整数次方，那么它的二进制表示中有且只有一位是 1，而其他所有位都是 0。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isPow2</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> (n &amp; (n - <span class="number">1</span>)) == <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><h2 id="相关题目：计算两个数的二进制的不同位的个数"><a href="#相关题目：计算两个数的二进制的不同位的个数" class="headerlink" title="相关题目：计算两个数的二进制的不同位的个数"></a><strong>相关题目：计算两个数的二进制的不同位的个数</strong></h2><blockquote><p>输入两个整数 m 和 n，计算需要改变 m 的二进制表示中的多少位才能得到 n。比如 10 的二进制表示为 1010，13 的二进制表示为 1101，需要改变 1010 中的 3 位才能得到 1101。</p></blockquote><p>思路：<br>求两个数的异或，统计异或结果中 1 的位数。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">count</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> i = m ^ n;</div><div class="line">    System.out.println(m + <span class="string">"^"</span> + n + <span class="string">"="</span> + Integer.toBinaryString(i) + <span class="string">"b"</span>);</div><div class="line">    <span class="keyword">return</span> count(i);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">count</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span> (n != <span class="number">0</span>) &#123;</div><div class="line">        count++;</div><div class="line">        n = n &amp; (n - <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> count;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> m = <span class="keyword">new</span> Random().nextInt();</div><div class="line"><span class="keyword">int</span> n = <span class="keyword">new</span> Random().nextInt();</div><div class="line">System.out.println(m + <span class="string">"="</span> + Integer.toBinaryString(m) + <span class="string">"b"</span>);</div><div class="line">System.out.println(n + <span class="string">"="</span> + Integer.toBinaryString(n) + <span class="string">"b"</span>);</div><div class="line">System.out.println(<span class="string">"count:"</span> + count(m, n));</div></pre></td></tr></table></figure><hr><h1 id="数值的整数次方"><a href="#数值的整数次方" class="headerlink" title="数值的整数次方"></a><strong>数值的整数次方</strong></h1><blockquote><p>实现函数 double Power(double base, int exponent)，求 base 的 exponent 次方。不得使用库函数，同时不需要考虑大数问题。已知公式：<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%882068%EF%BC%893.png" alt=""></p></blockquote><p>思路：<br>（1）当 base == 0 时，函数返回 0；<br>（2）当 exponent == 0 时，函数返回 1；<br>（3）当 exponent &lt; 0 时，base = 1 / base，exponent = -exponent；<br>（4）利用提供的公式计算。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">Power</span><span class="params">(<span class="keyword">double</span> base, <span class="keyword">int</span> exponent)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (base == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (exponent == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (exponent &lt; <span class="number">0</span>) &#123;</div><div class="line">        base = <span class="number">1</span> / base;</div><div class="line">        exponent = -exponent;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> cal(base, exponent);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">cal</span><span class="params">(<span class="keyword">double</span> base, <span class="keyword">int</span> exponent)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (exponent == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">double</span> result;</div><div class="line">    <span class="keyword">if</span> ((exponent &amp; <span class="number">1</span>) == <span class="number">0</span>) &#123;<span class="comment">// n 为偶数</span></div><div class="line">        exponent = exponent &gt;&gt; <span class="number">1</span>;</div><div class="line">        result = cal(base, exponent);</div><div class="line">        result *= result;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;<span class="comment">// n 为奇数</span></div><div class="line">        exponent = (exponent - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>;</div><div class="line">        result = cal(base, exponent);</div><div class="line">        result *= result;</div><div class="line">        result *= base;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> base = <span class="keyword">new</span> Random().nextInt();</div><div class="line"><span class="keyword">if</span> (base &gt; <span class="number">8</span>) &#123;</div><div class="line">    base &amp;= <span class="number">7</span>;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (base &lt; -<span class="number">8</span>) &#123;</div><div class="line">    base &amp;= <span class="number">7</span>;</div><div class="line">    base = -base;</div><div class="line">&#125;</div><div class="line"><span class="keyword">int</span> exponent = <span class="keyword">new</span> Random().nextInt();</div><div class="line"><span class="keyword">if</span> (exponent &gt; <span class="number">8</span>) &#123;</div><div class="line">    exponent &amp;= <span class="number">7</span>;</div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (exponent &lt; -<span class="number">8</span>) &#123;</div><div class="line">    exponent &amp;= <span class="number">7</span>;</div><div class="line">    exponent = -exponent;</div><div class="line">&#125;</div><div class="line">System.out.println(<span class="string">"base="</span> + base);</div><div class="line">System.out.println(<span class="string">"exponent="</span> + exponent);</div><div class="line">System.out.println(<span class="string">"Power:"</span> + Power(base, exponent));</div></pre></td></tr></table></figure><p>时间复杂度：O(logn)。<br>空间复杂度：O(logn)。</p><hr><h1 id="打印从-1-到最大的-n-位数"><a href="#打印从-1-到最大的-n-位数" class="headerlink" title="打印从 1 到最大的 n 位数"></a><strong>打印从 1 到最大的 n 位数</strong></h1><blockquote><p>输入数字 n，按顺序打印出从 1 到最大的 n 位十进制数。比如输入 3，则打印出 1、2、3 一直到最大的 3 位数 999。</p></blockquote><p>思路：<br>考虑大数问题，不能直接打印。<br>（1）输入数字 &lt;= 0 时，不打印；<br>（2）输入数字 &gt; 0 时，递归调用位数少 1 位的方法，直到调用到位数为 1 的方法后开始打印。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(<span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">    print(<span class="string">""</span>, count);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String pre, <span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (count &lt; <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (count != <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (pre.length() &gt; <span class="number">0</span>) &#123; <span class="comment">// 针对于 3 位数及以上</span></div><div class="line">            print(pre + <span class="string">"0"</span>, count - <span class="number">1</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// 针对于 2 位数</span></div><div class="line">            print(pre, count - <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">9</span>; i++) &#123;</div><div class="line">            print(pre + i, count - <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">9</span>; i++) &#123;</div><div class="line">            System.out.println(pre + i);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> n = <span class="keyword">new</span> Random().nextInt();</div><div class="line">System.out.println(<span class="string">"print("</span> + n + <span class="string">"):\n"</span>);</div><div class="line">print(n);</div></pre></td></tr></table></figure><p>时间复杂度：<br>空间复杂度：O(n)。</p><h2 id="扩展：实现任意两个整数的加（减）法"><a href="#扩展：实现任意两个整数的加（减）法" class="headerlink" title="扩展：实现任意两个整数的加（减）法"></a><strong>扩展：实现任意两个整数的加（减）法</strong></h2><p>思路：<br>（1）两个正整数相加时，结果的位数最多比这两个数中最大值的位数多 1 位。按照小学加法，以递归方式依次从最低位开始加，是否有进位也需要带到下一次计算中；<br>（2）两个正整数相减时，需要先确定两个数中哪个更大，确保让大数减小数。结果的位数最多为这两个数中最大值的位数，计算以递归方式依次从最低位开始减，低位向高位借 1 时直接在高位减 1；<br>（2）当两个值中有负整数时，通过截取字符串变为正整数，同时转变为等价的运算。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sub</span><span class="params">(String value1, String value2)</span> </span>&#123;</div><div class="line">    <span class="keyword">boolean</span> value1IsNeg = <span class="string">'-'</span> == value1.charAt(<span class="number">0</span>);</div><div class="line">    <span class="keyword">boolean</span> value2IsNeg = <span class="string">'-'</span> == value2.charAt(<span class="number">0</span>);</div><div class="line">    <span class="keyword">if</span> (value1IsNeg &amp;&amp; value2IsNeg) &#123;</div><div class="line">        <span class="keyword">return</span> sub(value2.substring(<span class="number">1</span>), value1.substring(<span class="number">1</span>));</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!value1IsNeg &amp;&amp; value2IsNeg) &#123;</div><div class="line">        <span class="keyword">return</span> add(value1, value2.substring(<span class="number">1</span>));</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value1IsNeg) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"-"</span> + add(value1.substring(<span class="number">1</span>), value2);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">boolean</span> value1IsLarger = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">if</span> (value2.length() &gt; value1.length()) &#123;</div><div class="line">        value1IsLarger = <span class="keyword">false</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value2.length() == value1.length()) &#123;</div><div class="line">        <span class="keyword">if</span> (Integer.parseInt(String.valueOf(value2.charAt(<span class="number">0</span>))) &gt; Integer.parseInt(String.valueOf(value1.charAt(<span class="number">0</span>)))) &#123;</div><div class="line">            value1IsLarger = <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Integer[] arr1 = convertArray2(value1);</div><div class="line">    Integer[] arr2 = convertArray2(value2);</div><div class="line">    Integer[] arr = <span class="keyword">new</span> Integer[Math.max(arr1.length, arr2.length)];</div><div class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder(arr.length);</div><div class="line">    <span class="keyword">if</span> (value1IsLarger) &#123;</div><div class="line">        sub(arr1, arr2, arr, <span class="number">0</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        sub(arr2, arr1, arr, <span class="number">0</span>);</div><div class="line">        builder.append(<span class="string">"-"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</div><div class="line">        Integer integer = arr[i];</div><div class="line">        <span class="keyword">if</span> (i == <span class="number">0</span> &amp;&amp; integer == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        builder.append(integer);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> builder.toString();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sub</span><span class="params">(Integer[] arr1, Integer[] arr2, Integer[] arr, <span class="keyword">int</span> lastIndex)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (lastIndex == arr.length) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> arr1Index = arr1.length - <span class="number">1</span> - lastIndex;</div><div class="line">    <span class="keyword">int</span> arr2Index = arr2.length - <span class="number">1</span> - lastIndex;</div><div class="line">    <span class="comment">// arr1 和 arr2 位数相同，且都算到了最高位的前一位</span></div><div class="line">    <span class="keyword">if</span> (arr1Index &lt; <span class="number">0</span> &amp;&amp; arr2Index &lt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// arr2 算到了最高位的前一位，后续计算只和 arr1 有关，执行快速计算</span></div><div class="line">    <span class="keyword">if</span> (arr2Index &lt; <span class="number">0</span>) &#123;</div><div class="line">        fastSub(arr1, arr, arr1Index);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// arr1 和 arr2 都没有算到最高位的前一位</span></div><div class="line">    <span class="comment">// （1）先计算当前位</span></div><div class="line">    <span class="keyword">int</span> value = arr1[arr1Index] - arr2[arr2Index];</div><div class="line">    <span class="keyword">if</span> (value &lt; <span class="number">0</span>) &#123;</div><div class="line">        borrow(arr1, arr1Index - <span class="number">1</span>);</div><div class="line">        arr[arr.length - <span class="number">1</span> - lastIndex] = value + <span class="number">10</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        arr[arr.length - <span class="number">1</span> - lastIndex] = value;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// （2）计算前一位</span></div><div class="line">    sub(arr1, arr2, arr, ++lastIndex);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fastSub</span><span class="params">(Integer[] arr1, Integer[] arr, <span class="keyword">int</span> arr1Index)</span> </span>&#123;</div><div class="line">    System.arraycopy(arr1, <span class="number">0</span>, arr, <span class="number">0</span>, arr1Index + <span class="number">1</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">borrow</span><span class="params">(Integer[] arr, <span class="keyword">int</span> lastIndex)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = lastIndex; i &gt;= <span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="keyword">if</span> (arr[i] &gt; <span class="number">0</span>) &#123;</div><div class="line">            arr[i]--;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">add</span><span class="params">(String value1, String value2)</span> </span>&#123;</div><div class="line">    <span class="keyword">boolean</span> value1IsNeg = <span class="string">'-'</span> == value1.charAt(<span class="number">0</span>);</div><div class="line">    <span class="keyword">boolean</span> value2IsNeg = <span class="string">'-'</span> == value2.charAt(<span class="number">0</span>);</div><div class="line">    <span class="keyword">if</span> (value1IsNeg &amp;&amp; value2IsNeg) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"-"</span> + add(value2.substring(<span class="number">1</span>), value1.substring(<span class="number">1</span>));</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!value1IsNeg &amp;&amp; value2IsNeg) &#123;</div><div class="line">        <span class="keyword">return</span> sub(value1, value2.substring(<span class="number">1</span>));</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (value1IsNeg) &#123;</div><div class="line">        <span class="keyword">return</span> sub(value2, value1.substring(<span class="number">1</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span>[] arr1 = convertArray(value1);</div><div class="line">    <span class="keyword">int</span>[] arr2 = convertArray(value2);</div><div class="line">    Integer[] arr = <span class="keyword">new</span> Integer[Math.max(arr1.length, arr2.length) + <span class="number">1</span>];</div><div class="line">    add(arr1, arr2, arr, <span class="number">0</span>, <span class="keyword">false</span>);</div><div class="line"></div><div class="line">    StringBuilder builder = <span class="keyword">new</span> StringBuilder(arr.length);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (arr[i] != <span class="number">0</span>) &#123;</div><div class="line">                builder.append(arr[i]);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            builder.append(arr[i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> builder.toString();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span>[] arr1, <span class="keyword">int</span>[] arr2, Integer[] arr, <span class="keyword">int</span> lastIndex, <span class="keyword">boolean</span> carry)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (lastIndex == arr.length) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> arr1Index = arr1.length - <span class="number">1</span> - lastIndex;</div><div class="line">    <span class="keyword">int</span> arr2Index = arr2.length - <span class="number">1</span> - lastIndex;</div><div class="line">    <span class="comment">// arr1 和 arr2 位数相同，且都算到了最高位的前一位</span></div><div class="line">    <span class="keyword">if</span> (arr1Index &lt; <span class="number">0</span> &amp;&amp; arr2Index &lt; <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">if</span> (carry) &#123;</div><div class="line">            arr[<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            arr[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// arr1 算到了最高位的前一位，后续计算只和 arr2 有关，执行快速计算</span></div><div class="line">    <span class="keyword">if</span> (arr1Index &lt; <span class="number">0</span>) &#123;</div><div class="line">        fastAdd(arr2, arr, arr2Index, carry);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// arr2 算到了最高位的前一位，后续计算只和 arr1 有关，执行快速计算</span></div><div class="line">    <span class="keyword">if</span> (arr2Index &lt; <span class="number">0</span>) &#123;</div><div class="line">        fastAdd(arr1, arr, arr1Index, carry);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// arr1 和 arr2 都没有算到最高位的前一位</span></div><div class="line">    <span class="comment">// （1）先计算当前位</span></div><div class="line">    <span class="keyword">int</span> value = arr1[arr1Index] + arr2[arr2Index];</div><div class="line">    <span class="keyword">if</span> (carry) &#123;</div><div class="line">        value++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (value &gt; <span class="number">9</span>) &#123;</div><div class="line">        arr[arr.length - <span class="number">1</span> - lastIndex] = value - <span class="number">10</span>;</div><div class="line">        carry = <span class="keyword">true</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        arr[arr.length - <span class="number">1</span> - lastIndex] = value;</div><div class="line">        carry = <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// （2）计算前一位</span></div><div class="line">    add(arr1, arr2, arr, ++lastIndex, carry);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fastAdd</span><span class="params">(<span class="keyword">int</span>[] arr1, Integer[] arr, <span class="keyword">int</span> arr1Index, <span class="keyword">boolean</span> carry)</span> </span>&#123;</div><div class="line">    <span class="comment">// arr 位数比 arr1 位数多 1 位，多的是最高位</span></div><div class="line">    <span class="comment">// （1）先计算当前位和前一位（或前 n 位）</span></div><div class="line">    <span class="keyword">int</span> value = arr1[arr1Index];</div><div class="line">    <span class="keyword">if</span> (carry) &#123;</div><div class="line">        value++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (value &gt; <span class="number">9</span>) &#123;</div><div class="line">        arr[arr1Index + <span class="number">1</span>] = value - <span class="number">10</span>;</div><div class="line">        <span class="comment">// 如果当前位已经是 arr1 的最高位，则直接可以确定 arr[0] 并返回</span></div><div class="line">        <span class="keyword">if</span> (arr1Index == <span class="number">0</span>) &#123;</div><div class="line">            arr[<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// 否则，计算前一位（如果前一位加 1 后正好进位，则继续计算前一位）</span></div><div class="line">            <span class="keyword">while</span> (arr1[arr1Index - <span class="number">1</span>] == <span class="number">9</span>) &#123;</div><div class="line">                arr[arr1Index] = <span class="number">0</span>;</div><div class="line">                arr1Index--;</div><div class="line">                <span class="keyword">if</span> (arr1Index == <span class="number">0</span>) &#123;</div><div class="line">                    arr[<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">// 再计算前一位 ，此时加 1 必小于 10</span></div><div class="line">            arr[arr1Index] = arr1[arr1Index - <span class="number">1</span>] + <span class="number">1</span>;</div><div class="line">            <span class="comment">// 如果当前位是 arr1 的次高位，则直接可以确定 arr[0] 并返回</span></div><div class="line">            <span class="keyword">if</span> (arr1Index == <span class="number">1</span>) &#123;</div><div class="line">                arr[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        arr[arr1Index + <span class="number">1</span>] = value;</div><div class="line">        <span class="comment">// 如果当前位已经是 arr1 的最高位，则直接可以确定 arr[0] 并返回</span></div><div class="line">        <span class="keyword">if</span> (arr1Index == <span class="number">0</span>) &#123;</div><div class="line">            arr[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// 否则，计算前一位</span></div><div class="line">            arr[arr1Index] = arr1[arr1Index - <span class="number">1</span>];</div><div class="line">            <span class="comment">// 如果当前位是 arr1 的次高位，则直接可以确定 arr[0] 并返回</span></div><div class="line">            <span class="keyword">if</span> (arr1Index == <span class="number">1</span>) &#123;</div><div class="line">                arr[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// （2）将 arr1[0]~arr1[arr1Index - 2] 复制给 arr[1]~arr1[arr1Index - 1]</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = arr1Index - <span class="number">1</span>; i &lt; size; i++) &#123;</div><div class="line">        arr[i + <span class="number">1</span>] = arr1[i];</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// （3）arr[0]</span></div><div class="line">    arr[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[] convertArray(String str) &#123;</div><div class="line">    <span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[str.length()];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = str.length(); i &lt; size; i++) &#123;</div><div class="line">        arr[i] = Integer.parseInt(String.valueOf(str.charAt(i)));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> arr;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> Integer[] convertArray2(String str) &#123;</div><div class="line">    Integer[] arr = <span class="keyword">new</span> Integer[str.length()];</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = str.length(); i &lt; size; i++) &#123;</div><div class="line">        arr[i] = Integer.parseInt(String.valueOf(str.charAt(i)));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> arr;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> mLen = <span class="keyword">new</span> Random().nextInt(<span class="number">6</span>);</div><div class="line">String m;</div><div class="line">StringBuilder builder = <span class="keyword">new</span> StringBuilder(mLen + <span class="number">1</span>);</div><div class="line">builder.append(<span class="number">1</span> + <span class="keyword">new</span> Random().nextInt(<span class="number">9</span>));</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; mLen; i++) &#123;</div><div class="line">    builder.append(<span class="keyword">new</span> Random().nextInt(<span class="number">10</span>));</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">new</span> Random().nextInt(<span class="number">2</span>) == <span class="number">0</span>) &#123;</div><div class="line">    builder.insert(<span class="number">0</span>, <span class="string">"-"</span>);</div><div class="line">&#125;</div><div class="line">m = builder.toString();</div><div class="line"></div><div class="line"><span class="keyword">int</span> nLen = <span class="keyword">new</span> Random().nextInt(<span class="number">6</span>);</div><div class="line">String n;</div><div class="line">builder = <span class="keyword">new</span> StringBuilder(nLen + <span class="number">1</span>);</div><div class="line">builder.append(<span class="number">1</span> + <span class="keyword">new</span> Random().nextInt(<span class="number">9</span>));</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; nLen; i++) &#123;</div><div class="line">    builder.append(<span class="keyword">new</span> Random().nextInt(<span class="number">10</span>));</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (<span class="keyword">new</span> Random().nextInt(<span class="number">2</span>) == <span class="number">0</span>) &#123;</div><div class="line">    builder.insert(<span class="number">0</span>, <span class="string">"-"</span>);</div><div class="line">&#125;</div><div class="line">n = builder.toString();</div><div class="line"></div><div class="line">System.out.println(<span class="string">"m="</span> + m + <span class="string">"; n="</span> + n);</div><div class="line">System.out.println(<span class="string">"add:"</span> + add(m, n));</div><div class="line">System.out.println(<span class="string">"sub:"</span> + sub(m, n));</div></pre></td></tr></table></figure><hr><h1 id="删除链表的节点"><a href="#删除链表的节点" class="headerlink" title="删除链表的节点"></a><strong>删除链表的节点</strong></h1><h2 id="题目一：在-O-1-时间内删除链表节点"><a href="#题目一：在-O-1-时间内删除链表节点" class="headerlink" title="题目一：在 O(1) 时间内删除链表节点"></a><strong>题目一：在 O(1) 时间内删除链表节点</strong></h2><blockquote><p>给定单向链表的头指针和一个节点指针，定义一个函数在 O(1) 时间内删除该节点。</p></blockquote><p>思路：<br>（1）对于头节点，直接将头节点指向下一个节点；<br>（2）对于尾节点，从头遍历找到前一个节点，将该节点的下一个节点置为 null；<br>（3）对于中间的节点，将要删除的节点的信息修改成下一个节点的信息，本质是删除了下一个节点。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Node <span class="title">remove</span><span class="params">(Node firstNode, Node deleteNode)</span> </span>&#123;</div><div class="line">    <span class="comment">// 删除头节点</span></div><div class="line">    <span class="keyword">if</span> (firstNode.equals(deleteNode)) &#123;</div><div class="line">        <span class="keyword">return</span> deleteNode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Node tempNode = firstNode;</div><div class="line">    <span class="keyword">while</span> (tempNode.hasNext()) &#123;</div><div class="line">        tempNode = tempNode.getNext();</div><div class="line">        <span class="keyword">if</span> (tempNode.equals(deleteNode)) &#123;</div><div class="line">            Node nextNode = deleteNode.getNext();</div><div class="line">            <span class="comment">// 删除的节点不是尾节点，复制后一个节点的信息给要删除的节点</span></div><div class="line">            <span class="keyword">if</span> (nextNode != <span class="keyword">null</span>) &#123;</div><div class="line">                tempNode.setValue(nextNode.getValue());</div><div class="line">                tempNode.setNext(nextNode.getNext());</div><div class="line">                <span class="keyword">return</span> deleteNode;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">// 删除的节点是尾节点，需要找到前一个节点</span></div><div class="line">            Node beforeNode;</div><div class="line">            tempNode = firstNode;</div><div class="line">            <span class="keyword">while</span> (tempNode.hasNext()) &#123;</div><div class="line">                beforeNode = tempNode;</div><div class="line">                tempNode = tempNode.getNext();</div><div class="line">                <span class="keyword">if</span> (tempNode.equals(deleteNode)) &#123;</div><div class="line">                    beforeNode.setNext(<span class="keyword">null</span>);</div><div class="line">                    <span class="keyword">return</span> deleteNode;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">createNode</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> count)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (index &lt; count) &#123;</div><div class="line">        Node node = createNode(index + <span class="number">1</span>, count);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Node(index, node);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Node(index, <span class="keyword">null</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</div><div class="line">    <span class="keyword">private</span> Node next;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> value, Node next)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.value = value;</div><div class="line">        <span class="keyword">this</span>.next = next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">getNext</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNext</span><span class="params">(Node next)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.next = next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.value = value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> next != <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> count = <span class="number">1</span> + <span class="keyword">new</span> Random().nextInt(<span class="number">10</span>);</div><div class="line">Node firstNode = createNode(<span class="number">0</span>, count - <span class="number">1</span>);</div><div class="line"></div><div class="line"><span class="keyword">int</span> delete = <span class="keyword">new</span> Random().nextInt(count);</div><div class="line">Node deleteNode = firstNode;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; delete; i++) &#123;</div><div class="line">    deleteNode = deleteNode.getNext();</div><div class="line">&#125;</div><div class="line"></div><div class="line">System.out.println(<span class="string">"deleteNode:"</span> + deleteNode.getValue());</div><div class="line">Node node = firstNode;</div><div class="line">System.out.println(<span class="string">"node:"</span> + node.getValue());</div><div class="line"><span class="keyword">while</span> (node.hasNext()) &#123;</div><div class="line">    node = node.getNext();</div><div class="line">    System.out.println(<span class="string">"node:"</span> + node.getValue());</div><div class="line">&#125;</div><div class="line">System.out.println(<span class="string">"---"</span>);</div><div class="line"></div><div class="line">Node removeNode = remove(firstNode, deleteNode);</div><div class="line"><span class="keyword">if</span> (firstNode.equals(removeNode)) &#123;</div><div class="line">    firstNode = firstNode.getNext();</div><div class="line">&#125;</div><div class="line"></div><div class="line">node = firstNode;</div><div class="line"><span class="keyword">if</span> (node != <span class="keyword">null</span>) &#123;</div><div class="line">    System.out.println(<span class="string">"node:"</span> + node.getValue());</div><div class="line">    <span class="keyword">while</span> (node.hasNext()) &#123;</div><div class="line">        node = node.getNext();</div><div class="line">        System.out.println(<span class="string">"node:"</span> + node.getValue());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>时间复杂度：O(1)。对于 n 个节点的链表，只有尾节点是 O(n)，其余节点都是 O(1)。<br>空间复杂度：O(1)。</p><h2 id="题目二：删除链表中重复的节点"><a href="#题目二：删除链表中重复的节点" class="headerlink" title="题目二：删除链表中重复的节点"></a><strong>题目二：删除链表中重复的节点</strong></h2><blockquote><p>在一个排序的链表中，如何删除重复的节点？</p></blockquote><p>思路：<br>定义 3 个指针，分别指向已确定的节点（beforeNode），当前需要判断的节点（currentNode）及其下一个节点（afterNode）。为了防止头节点就是需要删除的重复节点，在头节点前构造一个不重复的节点，最后再将头节点指向该节点的下一个节点。<br>遍历节点，当 currentNode 和 afterNode 值不相等时，将 currentNode 放到 beforeNode 后，否则，记录这个值，再往后遍历，直到找到不等于这个值的节点，如果这个节点是尾节点，则直接将这个节点放到 beforeNode 后；否则将这个节点作为 currentNode，继续判断 currentNode 和 afterNode 值是否相等。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Node firstNode)</span> </span>&#123;</div><div class="line">    Node beforeNode = firstNode;</div><div class="line">    Node currentNode = firstNode.getNext();</div><div class="line">    Node afterNode;</div><div class="line">    <span class="keyword">while</span> (currentNode != <span class="keyword">null</span> &amp;&amp; currentNode.hasNext()) &#123;</div><div class="line">        afterNode = currentNode.getNext();</div><div class="line">        <span class="keyword">if</span> (afterNode == <span class="keyword">null</span></div><div class="line">                || currentNode.getValue() != afterNode.getValue()) &#123;</div><div class="line">            beforeNode.setNext(currentNode);</div><div class="line">            beforeNode = currentNode;</div><div class="line">            currentNode = afterNode;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            beforeNode.setNext(<span class="keyword">null</span>);</div><div class="line">            <span class="keyword">int</span> value = currentNode.getValue();</div><div class="line">            <span class="keyword">while</span> (currentNode.hasNext()) &#123;</div><div class="line">                currentNode = currentNode.getNext();</div><div class="line">                <span class="keyword">if</span> (currentNode.getValue() != value) &#123;</div><div class="line">                    <span class="keyword">if</span> (!currentNode.hasNext()) &#123;</div><div class="line">                        beforeNode.setNext(currentNode);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="keyword">break</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">createNode</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">int</span> max)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (index &lt; max) &#123;</div><div class="line">        <span class="keyword">int</span> random = <span class="keyword">new</span> Random().nextInt(<span class="number">2</span>);</div><div class="line">        Node node = createNode(index + random, max);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Node(index, node);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Node(index, <span class="keyword">null</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</div><div class="line">    <span class="keyword">private</span> Node next;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> value, Node next)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.value = value;</div><div class="line">        <span class="keyword">this</span>.next = next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">getNext</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNext</span><span class="params">(Node next)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.next = next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> next != <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> max = <span class="number">1</span> + <span class="keyword">new</span> Random().nextInt(<span class="number">10</span>);</div><div class="line">Node firstNode = createNode(<span class="number">0</span>, max);</div><div class="line"></div><div class="line">Node node = firstNode;</div><div class="line">System.out.println(<span class="string">"node:"</span> + node.getValue());</div><div class="line"><span class="keyword">while</span> (node.hasNext()) &#123;</div><div class="line">    node = node.getNext();</div><div class="line">    System.out.println(<span class="string">"node:"</span> + node.getValue());</div><div class="line">&#125;</div><div class="line">System.out.println(<span class="string">"---"</span>);</div><div class="line"></div><div class="line">Node toolNode = <span class="keyword">new</span> Node(firstNode.getValue() - <span class="number">1</span>, firstNode);</div><div class="line">remove(toolNode);</div><div class="line"></div><div class="line">node = toolNode.getNext();</div><div class="line"><span class="keyword">if</span> (node != <span class="keyword">null</span>) &#123;</div><div class="line">    System.out.println(<span class="string">"node:"</span> + node.getValue());</div><div class="line">    <span class="keyword">while</span> (node.hasNext()) &#123;</div><div class="line">        node = node.getNext();</div><div class="line">        System.out.println(<span class="string">"node:"</span> + node.getValue());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>时间复杂度：<br>空间复杂度：</p><hr><h1 id="正则表达式匹配"><a href="#正则表达式匹配" class="headerlink" title="正则表达式匹配"></a><strong>正则表达式匹配</strong></h1><blockquote><p>请实现一个函数用来匹配包含’.’和’*‘的正则表达式。模式中的字符’.’表示任意一个字符，而’*‘表示它前面的字符可以出现任意次（含 0 次）。在本题中，匹配是指字符串的所有字符匹配整个模式。例如，字符串”aaa”与模式”a.a”和”ab<em>ac</em>a”匹配，但与”aa.a”和“ab*a”均不匹配。</p></blockquote><p>思路：<br>取模式串的前两个字符和字符串的一个字符——<br>（1）处理’*‘。如果模式串的第 2 个字符是’*‘，则从字符串的字符向后遍历，直到字符串的字符和模式串的第 1 个字符不相等，从这个位置开始后面的匹配；<br>（2）处理’.’。因为’.’表示任意一个字符，所以直接从下一个字符开始匹配；<br>（3）判断模式串和字符串的一个字符是否相等。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(String regex, String str)</span> </span>&#123;</div><div class="line">    <span class="keyword">char</span>[] regexArr = regex.toCharArray();</div><div class="line">    <span class="keyword">char</span>[] arr = str.toCharArray();</div><div class="line">    <span class="keyword">return</span> match(regexArr, <span class="number">0</span>, arr, <span class="number">0</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(<span class="keyword">char</span>[] regexArr, <span class="keyword">int</span> regexArrIndex, <span class="keyword">char</span>[] arr, <span class="keyword">int</span> arrIndex)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (regexArrIndex == regexArr.length &amp;&amp; arrIndex == arr.length) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (regexArrIndex == regexArr.length || arrIndex == arr.length) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">char</span> cRegex = regexArr[regexArrIndex];</div><div class="line">    <span class="keyword">char</span> aRegex = <span class="string">' '</span>;</div><div class="line">    <span class="keyword">if</span> (regexArrIndex &lt; regexArr.length - <span class="number">1</span>) &#123;</div><div class="line">        aRegex = regexArr[regexArrIndex + <span class="number">1</span>];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (aRegex == <span class="string">'*'</span>) &#123;</div><div class="line">        <span class="keyword">while</span> (arr[arrIndex] == cRegex) &#123;</div><div class="line">            arrIndex++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> match(regexArr, regexArrIndex + <span class="number">2</span>, arr, arrIndex);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> (cRegex == <span class="string">'.'</span> || arr[arrIndex] == cRegex) &#123;</div><div class="line">            <span class="keyword">return</span> match(regexArr, regexArrIndex + <span class="number">1</span>, arr, arrIndex + <span class="number">1</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">System.out.println(<span class="string">"match:"</span> + match(<span class="string">"a.a"</span>, <span class="string">"aaa"</span>));</div><div class="line">System.out.println(<span class="string">"match:"</span> + match(<span class="string">"ab*ac*a"</span>, <span class="string">"aaa"</span>));</div><div class="line">System.out.println(<span class="string">"match:"</span> + match(<span class="string">"aa.a"</span>, <span class="string">"aaa"</span>));</div><div class="line">System.out.println(<span class="string">"match:"</span> + match(<span class="string">"ab*a"</span>, <span class="string">"aaa"</span>));</div></pre></td></tr></table></figure><p>时间复杂度：O(n)。<br>空间复杂度：O(n)。</p><hr><h1 id="表示数值的字符串"><a href="#表示数值的字符串" class="headerlink" title="表示数值的字符串"></a><strong>表示数值的字符串</strong></h1><blockquote><p>请实现一个函数用来判断字符串是否表示数值（包括整数和小数）。例如，字符串”+100”、”5e2”、”-123”、”3.1416”及”-1E-16”都表示数值，但”12e”、”1a3.14”、”1.2.3”、”+-5”及”12e+5.4”都不是。</p></blockquote><p>思路：<br>‘e’、’E’后面必须有数字，数字之间不能有’.’；<br>字符可以是[0-9]、’e’、’E’；<br>‘e’或’E’之前的’.’最多只能有一个；<br>‘+’、’-‘开头时，只能有一个；<br>（例子中未完全体现限制，还需要根据常识补充）。</p><p>实现：<br>略。</p><p>时间复杂度：<br>空间复杂度：</p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;旋转数组的最小数字&quot;&gt;&lt;a href=&quot;#旋转数组的最小数字&quot; class=&quot;headerlink&quot; title=&quot;旋转数组的最小数字&quot;&gt;&lt;/a&gt;&lt;strong&gt;旋转数组的最小数字&lt;/strong&gt;&lt;/h1&gt;&lt;blockquote&gt;
&lt;p&gt;把一个数组最开始的若干个
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>《剑指 Offer》算法题（10/68）</title>
    <link href="http://www.weichao.io/2020/03/16/%E3%80%8A%E5%89%91%E6%8C%87-Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%8810-68%EF%BC%89/"/>
    <id>http://www.weichao.io/2020/03/16/《剑指-Offer》算法题（10-68）/</id>
    <published>2020-03-16T15:14:01.000Z</published>
    <updated>2020-03-16T15:26:23.924Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://blog.csdn.net/Yeoman92/article/details/77868367" title="https://blog.csdn.net/Yeoman92/article/details/77868367" target="_blank" rel="external">输入某二叉树的前序遍历和中序遍历的结果，重建此二叉树。</a></li><li><a href="https://www.jianshu.com/p/940aa4243829" title="https://www.jianshu.com/p/940aa4243829" target="_blank" rel="external">剑指offer最优解Java版-二叉树的下一个结点</a></li></ul><hr><h1 id="赋值运算符函数"><a href="#赋值运算符函数" class="headerlink" title="赋值运算符函数"></a><strong>赋值运算符函数</strong></h1><p>Java 不支持用户自定义操作符重载。</p><hr><h1 id="实现-Singleton-模式"><a href="#实现-Singleton-模式" class="headerlink" title="实现 Singleton 模式"></a><strong>实现 Singleton 模式</strong></h1><blockquote><p>设计一个类，我们只能生成该类的一个实例。</p></blockquote><h2 id="饿汉式"><a href="#饿汉式" class="headerlink" title="饿汉式"></a><strong>饿汉式</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> SingleTon mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="懒汉式-线程不安全"><a href="#懒汉式-线程不安全" class="headerlink" title="懒汉式(线程不安全)"></a><strong>懒汉式(线程不安全)</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> SingleTon mSingleTon = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>) &#123;</div><div class="line">mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="懒汉式-线程安全"><a href="#懒汉式-线程安全" class="headerlink" title="懒汉式(线程安全)"></a><strong>懒汉式(线程安全)</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> SingleTon mSingleTon = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>) &#123;</div><div class="line">mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="懒汉式-双重校验锁，线程不一定安全"><a href="#懒汉式-双重校验锁，线程不一定安全" class="headerlink" title="懒汉式(双重校验锁，线程不一定安全)"></a><strong>懒汉式(双重校验锁，线程不一定安全)</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> SingleTon mSingleTon = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>)&#123;</div><div class="line"><span class="keyword">synchronized</span>(SingleTon.class) &#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>) &#123;</div><div class="line">mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="懒汉式-双重校验锁，线程安全"><a href="#懒汉式-双重校验锁，线程安全" class="headerlink" title="懒汉式(双重校验锁，线程安全)"></a><strong>懒汉式(双重校验锁，线程安全)</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> SingleTon mSingleTon = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>)&#123;</div><div class="line"><span class="keyword">synchronized</span>(SingleTon.class) &#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>) &#123;</div><div class="line">mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a><strong>枚举</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> SingleTon &#123;</div><div class="line">SINGLE</div><div class="line">&#125;</div><div class="line"></div><div class="line">SingleTon.SINGLE</div></pre></td></tr></table></figure><h2 id="静态内部类"><a href="#静态内部类" class="headerlink" title="静态内部类"></a><strong>静态内部类</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123;</div><div class="line"><span class="keyword">static</span> SingleTon mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> InnerClass.mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><hr><h1 id="数组中重复的数字"><a href="#数组中重复的数字" class="headerlink" title="数组中重复的数字"></a><strong>数组中重复的数字</strong></h1><h2 id="找出数组中重复的数字"><a href="#找出数组中重复的数字" class="headerlink" title="找出数组中重复的数字"></a><strong>找出数组中重复的数字</strong></h2><blockquote><p>在一个长度为 n 的数组里的所有数字都在 0 到 n-1 的范围内。数组中某些数字是重复的，但不知道有几个数字重复了。也不知道每个数字重复了几次。请找出数组中任意一个重复的数字。例如，如果输入长度为 7 的数组 {2, 3, 1, 0, 2, 5, 3}，那么对应的输出是重复的数字 2 或者 3。</p></blockquote><p>思路：<br>观察值的范围，当数组中没有重复数字时，排序之后的结果应该是值和索引一一对应。以此为突破口，尝试给数组排序。<br>遍历数组，当值和索引相等时，继续处理下个索引的值；否则，比较当前值（arr[i] == m）和值作为索引的值（arr[m]），如果相等则说明找到了重复的数字，否则，交换两个值，再执行该过程。<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%881068%EF%BC%891.png" alt=""></p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = arr.length; i &lt; size; i++) &#123;</div><div class="line">        <span class="keyword">while</span> (arr[i] != i) &#123;</div><div class="line">            <span class="keyword">if</span> (arr[i] == arr[arr[i]]) &#123;</div><div class="line">                <span class="keyword">return</span> arr[i];</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">int</span> temp = arr[i];</div><div class="line">            arr[i] = arr[temp];</div><div class="line">            arr[temp] = temp;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span>[] arr = &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>&#125;;</div><div class="line"><span class="keyword">int</span> value = find(arr);</div><div class="line">System.out.println(<span class="string">"value:"</span> + value);</div></pre></td></tr></table></figure><p>时间复杂度：O(n)。代码中尽管有一个两重循环，但每个数字最多只要交换两次就能找到位置。<br>空间复杂度：O(1)。所有操作都是在输入数组上进行，不需要额外分配内存。</p><h2 id="不修改数组找出重复的数字"><a href="#不修改数组找出重复的数字" class="headerlink" title="不修改数组找出重复的数字"></a><strong>不修改数组找出重复的数字</strong></h2><blockquote><p>在一个长度为 n + 1 的数组里的所有数字都在 1 到 n 的范围内，所以数组中至少有一个数字是重复的。请找出数组中任意一个重复的数字，但不能修改输入的数组。例如，如果输入长度为 8 的数组 {2, 3, 5, 4, 3, 2, 6, 7}，那么对应的输出是重复的数字 2 或者 3。</p></blockquote><p>思路：<br>将值按照大于 m 值的和不大于 m 值的分为大、小两个区间，数组如果不重复（n 个元素对应 1~n），则大区间中必有 m 个元素，且小区间中必有 n - m 个元素，但是由于多 1 个元素，所以至少有大区间元素个数大于 m，或小区间元素个数大于 m - n。以此为突破口，统计数组在各区间元素的个数。<br>遍历数组，找到元素个数大于区间的，将该区间重新划分大、小两个区间；重复此步骤，直至区间不可再划分。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> start = <span class="number">1</span>;</div><div class="line">    <span class="keyword">int</span> end = arr.length - <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> (end &gt;= start) &#123;</div><div class="line">        <span class="keyword">int</span> middle = ((end - start) &gt;&gt; <span class="number">1</span>) + start;</div><div class="line">        <span class="keyword">int</span> count = count(arr, start, middle);</div><div class="line">        <span class="keyword">if</span> (start == middle) &#123;</div><div class="line">            <span class="keyword">if</span> (count &gt; <span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">return</span> start;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (count &gt; middle - start + <span class="number">1</span>) &#123;</div><div class="line">            end = middle;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            start = middle + <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">count</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> start, <span class="keyword">int</span> middle)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i : arr) &#123;</div><div class="line">        <span class="keyword">if</span> (i &gt;= start &amp;&amp; i &lt;= middle) &#123;</div><div class="line">            count++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> count;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span>[] arr = &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">7</span>&#125;;</div><div class="line"><span class="keyword">int</span> value = find(arr);</div><div class="line">System.out.println(<span class="string">"value:"</span> + value);</div></pre></td></tr></table></figure><p>时间复杂度：O(nlogn)。数组长度为 n，是 O(n)，二分查找是 O(logn)，所以总时间是 O(nlogn)。<br>空间复杂度：O(1)。</p><hr><h1 id="二维数组中的查找"><a href="#二维数组中的查找" class="headerlink" title="二维数组中的查找"></a><strong>二维数组中的查找</strong></h1><blockquote><p>在一个二维数组中，每一行都按照从左到右递增的顺序排序，每一列都按照从上到下递增的顺序排序。请完成一个函数，输入这样的一个二维数组和一个整数，判断数组中是否含有该整数。</p></blockquote><p>思路：<br>二维数组行、列都是有序的，所以如果列的第一个元素大于目标值时，则目标值不可能在此列；同理，行也一样。以此为突破口，先用二分法缩小目标可能存在的范围，再遍历。<br>使用二分法找到中间列，判断列的第一个元素和目标值的大小关系，如果等于，说明找到了，直接返回；如果大于，记录位置为 C1；如果小于，记录位置为 C2。重复此过程，直到 C2 &gt;= C1，则找到了列在遍历时的最大值 C2 - 1。同理，再找到行在遍历时的最大值。然后从列的最大值开始遍历，查找目标值。<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%881068%EF%BC%892.png" alt=""></p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">contain</span><span class="params">(<span class="keyword">int</span>[][] arr, <span class="keyword">int</span> target)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> maxCol = findMaxCol(arr, target);</div><div class="line">    <span class="keyword">if</span> (arr[<span class="number">0</span>][maxCol] == target) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> maxRow = findMaxRow(arr, target);</div><div class="line">    <span class="keyword">if</span> (arr[maxRow][<span class="number">0</span>] == target) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = maxCol; j &gt;= <span class="number">0</span>; j--) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = maxCol - j; i &lt;= maxRow; i++) &#123;</div><div class="line">            <span class="keyword">if</span> (arr[i][j] == target) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[i][j] &gt; target) &#123;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">findMaxCol</span><span class="params">(<span class="keyword">int</span>[][] arr, <span class="keyword">int</span> target)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> start = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> end = arr[<span class="number">0</span>].length - <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> (end &gt;= start) &#123;</div><div class="line">        <span class="keyword">int</span> middle = ((end - start) &gt;&gt; <span class="number">1</span>) + start;</div><div class="line">        <span class="keyword">if</span> (arr[<span class="number">0</span>][middle] == target) &#123;</div><div class="line">            <span class="keyword">return</span> middle;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[<span class="number">0</span>][middle] &gt; target) &#123;</div><div class="line">            end = middle - <span class="number">1</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            start = middle + <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> start - <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">findMaxRow</span><span class="params">(<span class="keyword">int</span>[][] arr, <span class="keyword">int</span> target)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> start = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> end = arr.length - <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> (end &gt;= start) &#123;</div><div class="line">        <span class="keyword">int</span> middle = ((end - start) &gt;&gt; <span class="number">1</span>) + start;</div><div class="line">        <span class="keyword">if</span> (arr[middle][<span class="number">0</span>] == target) &#123;</div><div class="line">            <span class="keyword">return</span> middle;</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (arr[middle][<span class="number">0</span>] &gt; target) &#123;</div><div class="line">            end = middle - <span class="number">1</span>;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            start = middle + <span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> start - <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span>[][] arr = &#123;&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">9</span>&#125;, &#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">12</span>&#125;, &#123;<span class="number">4</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">13</span>&#125;, &#123;<span class="number">6</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">15</span>&#125;&#125;;</div><div class="line"><span class="keyword">boolean</span> b = contain(arr, <span class="number">7</span>);</div><div class="line">System.out.println(<span class="string">"contain:"</span> + b);</div></pre></td></tr></table></figure><p>时间复杂度：<br>空间复杂度：O(1)。</p><hr><h1 id="替换空格"><a href="#替换空格" class="headerlink" title="替换空格"></a><strong>替换空格</strong></h1><blockquote><p>请实现一个函数，把字符串中的每个空格替换成”%20”。例如，输入”We are happy.”，则输出”We%20are%20happy.”。</p></blockquote><p>思路：<br>操作同一个数组时，如果从前往后替换会导致后面的数据被覆盖。因为每替换 1 个空格，数组所需的长度需要 + 2，所以可以以此为突破口，从后往前替换。<br>统计字符串中空格的个数，先计算出替换后的长度，由于 Java 数组长度不可变，所以以计算出的长度重新申请一块内存，然后再从后往前遍历，遇到空格时替换为%20，否则直接复制。<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%881068%EF%BC%893.png" alt=""></p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">convert</span><span class="params">(StringBuffer stringBuffer)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = stringBuffer.length(); i &lt; size; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (stringBuffer.charAt(i) == <span class="string">' '</span>) &#123;</div><div class="line">            count++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">int</span> oldLen = stringBuffer.length();</div><div class="line">    <span class="keyword">int</span> newLen = oldLen + (count &lt;&lt; <span class="number">1</span>);</div><div class="line">    stringBuffer.setLength(newLen);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = oldLen - <span class="number">1</span>, j = newLen - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--, j--) &#123;</div><div class="line">        <span class="keyword">char</span> c = stringBuffer.charAt(i);</div><div class="line">        <span class="keyword">if</span> (c == <span class="string">' '</span>) &#123;</div><div class="line">            stringBuffer.setCharAt(j, <span class="string">'0'</span>);</div><div class="line">            stringBuffer.setCharAt(--j, <span class="string">'2'</span>);</div><div class="line">            stringBuffer.setCharAt(--j, <span class="string">'%'</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            stringBuffer.setCharAt(j, c);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer(<span class="string">"We are happy."</span>);</div><div class="line">System.out.println(<span class="string">"stringBuffer:"</span> + stringBuffer.toString());</div><div class="line">convert(stringBuffer);</div><div class="line">System.out.println(<span class="string">"stringBuffer:"</span> + stringBuffer.toString());</div></pre></td></tr></table></figure><p>时间复杂度：O(n)。<br>空间复杂度：O(n)。</p><h2 id="相关题目：把数组-A2-中的所有数字插入数组-A1-中"><a href="#相关题目：把数组-A2-中的所有数字插入数组-A1-中" class="headerlink" title="相关题目：把数组 A2 中的所有数字插入数组 A1 中"></a><strong>相关题目：把数组 A2 中的所有数字插入数组 A1 中</strong></h2><blockquote><p>有两个排序的数组 A1 和 A2，内存在 A1 的末尾有足够多的空余空间容纳 A2。请实现一个函数，把 A2 中的所有数字插入 A1 中，并且所有的数字是排序的。</p></blockquote><p>思路：<br>合并两个数组，可以知道两个数组占用的总的空间大小。以此为突破口，合并数组 A2 到 A1。<br>计算总大小，比较数组 A1 和 A2 各自最后位置的元素的大小，将更大的元素放到末尾。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 随机初始化数组中的元素</span></div><div class="line"><span class="keyword">int</span>[] arr1src = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</div><div class="line"><span class="keyword">int</span>[] arr2 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</div><div class="line"><span class="keyword">int</span> beforeValue = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = arr1src.length; i &lt; size; i++) &#123;</div><div class="line">    <span class="keyword">int</span> random = <span class="keyword">new</span> Random().nextInt(<span class="number">10</span>);</div><div class="line">    beforeValue += random;</div><div class="line">    arr1src[i] = beforeValue;</div><div class="line">&#125;</div><div class="line">beforeValue = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = arr2.length; i &lt; size; i++) &#123;</div><div class="line">    <span class="keyword">int</span> random = <span class="keyword">new</span> Random().nextInt(<span class="number">10</span>);</div><div class="line">    beforeValue += random;</div><div class="line">    arr2[i] = beforeValue;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span>[] arr1 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">100</span>];</div><div class="line">System.arraycopy(arr1src, <span class="number">0</span>, arr1, <span class="number">0</span>, arr1src.length); <span class="comment">// 由于 Java 中数组长度不可变，此处假装数组 A1 末尾有足够多的空余空间</span></div><div class="line">System.out.println(<span class="string">"arr1:"</span> + Arrays.toString(arr1));</div><div class="line">System.out.println(<span class="string">"arr2:"</span> + Arrays.toString(arr2));</div><div class="line"></div><div class="line"><span class="keyword">int</span> i = arr1src.length - <span class="number">1</span>, j = arr2.length - <span class="number">1</span>, index = arr1src.length + arr2.length - <span class="number">1</span>;</div><div class="line"><span class="keyword">while</span> (i &gt;= <span class="number">0</span> &amp;&amp; j &gt;= <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">int</span> v1 = arr1[i];</div><div class="line">    <span class="keyword">int</span> v2 = arr2[j];</div><div class="line">    <span class="keyword">if</span> (v1 == v2) &#123;</div><div class="line">        arr1[index--] = v1;</div><div class="line">        arr1[index--] = v2;</div><div class="line">        i--;</div><div class="line">        j--;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (v1 &gt; v2) &#123;</div><div class="line">        arr1[index--] = v1;</div><div class="line">        i--;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        arr1[index--] = v2;</div><div class="line">        j--;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">if</span> (j &gt;= <span class="number">0</span>) &#123; <span class="comment">// 最小值在 A2 数组时，直接把剩余元素复制到 A1 数组开头</span></div><div class="line">    System.arraycopy(arr2, <span class="number">0</span>, arr1, <span class="number">0</span>, j + <span class="number">1</span>);</div><div class="line">&#125;</div><div class="line">System.out.println(<span class="string">"arr1:"</span> + Arrays.toString(arr1));</div></pre></td></tr></table></figure></p><p>时间复杂度：O(n)。<br>空间复杂度：O(1)。</p><hr><h1 id="从尾到头打印链表"><a href="#从尾到头打印链表" class="headerlink" title="从尾到头打印链表"></a><strong>从尾到头打印链表</strong></h1><blockquote><p>输入一个链表的头节点，从尾到头反过来打印出每个节点的值。</p></blockquote><p>思路：<br>判断单向链表中的节点，如果持有节点为空，则说明不是该节点是尾节点，可以打印了；否则可以继续判断持有的节点是否还持有节点。循环此过程。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</div><div class="line">    <span class="keyword">private</span> Node next;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> value, Node next)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.value = value;</div><div class="line">        <span class="keyword">this</span>.next = next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">getNext</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.next;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(Node node)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (node.getNext() != <span class="keyword">null</span>) &#123;</div><div class="line">        print(node.getNext());</div><div class="line">    &#125;</div><div class="line">    System.out.println(<span class="string">"value:"</span> + node.getValue());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">Node node = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">10</span>; i &gt; <span class="number">0</span>; i--) &#123;</div><div class="line">    node = <span class="keyword">new</span> Node(i, node);</div><div class="line">&#125;</div><div class="line"></div><div class="line">Node firstNode = node;</div><div class="line"></div><div class="line"><span class="keyword">while</span> (node != <span class="keyword">null</span>) &#123;</div><div class="line">    System.out.println(<span class="string">"value:"</span> + node.getValue());</div><div class="line">    node = node.getNext();</div><div class="line">&#125;</div><div class="line"></div><div class="line">print(firstNode);</div></pre></td></tr></table></figure><p>时间复杂度：O(n)。<br>空间复杂度：O(1)。</p><hr><h1 id="重建二叉树"><a href="#重建二叉树" class="headerlink" title="重建二叉树"></a><strong>重建二叉树</strong></h1><blockquote><p>输入某二叉树的前序遍历和中序遍历的结果，请重建出该二叉树。假设输入的前序遍历和中序遍历的结果中都不含重复的数字。例如输入前序遍历序列{1, 2, 4, 7, 3, 5, 6, 8}和中序遍历序列{4, 7, 2, 1, 5, 3, 8, 6}，则重建二叉树并输出它的头节点。</p></blockquote><p>思路：<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%881068%EF%BC%894.png" alt=""><br>（1）前序遍历看根节点；<br>（2）中序遍历看左子树、右子树；<br>（3）把子树值带回前序遍历，排在前面的是根节点；<br>（4）重复（2）（3）过程，直到左子树、右子树为空。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</div><div class="line">    <span class="keyword">private</span> Node left;</div><div class="line">    <span class="keyword">private</span> Node right;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.value = value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">getLeft</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> left;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeft</span><span class="params">(Node left)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.left = left;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">getRight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> right;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRight</span><span class="params">(Node right)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.right = right;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">create</span><span class="params">(<span class="keyword">int</span>[] preorderArr, <span class="keyword">int</span>[] inorderArr)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (preorderArr == <span class="keyword">null</span> || preorderArr.length == <span class="number">0</span> ||</div><div class="line">            inorderArr == <span class="keyword">null</span> || inorderArr.length == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Node node = <span class="keyword">new</span> Node(preorderArr[<span class="number">0</span>]);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = inorderArr.length; i &lt; size; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (preorderArr[<span class="number">0</span>] == inorderArr[i]) &#123; <span class="comment">// 根节点</span></div><div class="line">            node.setLeft(create(Arrays.copyOfRange(preorderArr, <span class="number">1</span>, i + <span class="number">1</span>), Arrays.copyOfRange(inorderArr, <span class="number">0</span>, i)));</div><div class="line">            node.setRight(create(Arrays.copyOfRange(preorderArr, i + <span class="number">1</span>, preorderArr.length), Arrays.copyOfRange(inorderArr, i + <span class="number">1</span>, inorderArr.length)));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> node;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span>[] preorderArr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">8</span>&#125;;</div><div class="line"><span class="keyword">int</span>[] inorderArr = &#123;<span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">6</span>&#125;;</div><div class="line"></div><div class="line">Node node = create(preorderArr, inorderArr);</div><div class="line">System.out.println(<span class="string">"node:"</span> + node.getValue());</div></pre></td></tr></table></figure><p>时间复杂度：O(nlogn)。<br>空间复杂度：O(n)。</p><h2 id="扩展：输入某二叉树的中序遍历和后序遍历的结果，重建出该二叉树"><a href="#扩展：输入某二叉树的中序遍历和后序遍历的结果，重建出该二叉树" class="headerlink" title="扩展：输入某二叉树的中序遍历和后序遍历的结果，重建出该二叉树"></a><strong>扩展：输入某二叉树的中序遍历和后序遍历的结果，重建出该二叉树</strong></h2><p>思路：<br>（1）后序遍历看根节点；<br>（2）中序遍历看左子树、右子树；<br>（3）把子树值带回后序遍历，排在前面的是根节点；<br>（4）重复（2）（3）过程，直到左子树、右子树为空。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> Node <span class="title">create</span><span class="params">(<span class="keyword">int</span>[] inorderArr, <span class="keyword">int</span>[] postorderArr)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (inorderArr == <span class="keyword">null</span> || inorderArr.length == <span class="number">0</span> ||</div><div class="line">            postorderArr == <span class="keyword">null</span> || postorderArr.length == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Node node = <span class="keyword">new</span> Node(postorderArr[postorderArr.length - <span class="number">1</span>]);</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = inorderArr.length; i &lt; size; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (postorderArr[postorderArr.length - <span class="number">1</span>] == inorderArr[i]) &#123; <span class="comment">// 根节点</span></div><div class="line">            node.setLeft(create(Arrays.copyOfRange(inorderArr, <span class="number">0</span>, i), Arrays.copyOfRange(postorderArr, <span class="number">0</span>, i)));</div><div class="line">            node.setRight(create(Arrays.copyOfRange(inorderArr, i + <span class="number">1</span>, inorderArr.length), Arrays.copyOfRange(postorderArr, i, postorderArr.length - <span class="number">1</span>)));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> node;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span>[] inorderArr = &#123;<span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">6</span>&#125;;</div><div class="line"><span class="keyword">int</span>[] postorderArr = &#123;<span class="number">7</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">1</span>&#125;;</div><div class="line"></div><div class="line">Node node = create(inorderArr, postorderArr);</div><div class="line">System.out.println(<span class="string">"node:"</span> + node.getValue());</div></pre></td></tr></table></figure><hr><h1 id="二叉树的下一个节点"><a href="#二叉树的下一个节点" class="headerlink" title="二叉树的下一个节点"></a><strong>二叉树的下一个节点</strong></h1><blockquote><p>给定一棵二叉树和其中的一个节点，如何找出中序遍历序列的下一个节点？树中的结点除了有两个分别指向左、右子节点的指针，还有一个指向父节点的指针。</p></blockquote><p>思路：<br>分情况讨论——<br>（1）给出的节点有右子树，则沿着右子树向下遍历左子节点，最左子节点是下一个节点；<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%881068%EF%BC%895.PNG" alt=""><br>（2）给出的节点没有右子树，如果它是父节点的右子节点，则沿着父节点向上遍历，直到节点是父节点的左子节点，则该节点的父节点是下一个节点；<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%881068%EF%BC%896.PNG" alt=""><br>（3）给出的节点没有右子树，如果它是父节点的左子节点，则父节点是下一个节点。（3）是（2）的特例。<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%881068%EF%BC%897.PNG" alt=""></p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">char</span> value;</div><div class="line">    <span class="keyword">private</span> Node left;</div><div class="line">    <span class="keyword">private</span> Node right;</div><div class="line">    <span class="keyword">private</span> Node parent;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">(<span class="keyword">char</span> value)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.value = value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">char</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">getLeft</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> left;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLeft</span><span class="params">(Node left)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.left = left;</div><div class="line">        left.setParent(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">getRight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> right;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRight</span><span class="params">(Node right)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.right = right;</div><div class="line">        right.setParent(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Node <span class="title">getParent</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> parent;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParent</span><span class="params">(Node parent)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.parent = parent;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">inorderNext</span><span class="params">(Node node)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (node.getRight() != <span class="keyword">null</span>) &#123;</div><div class="line">        node = node.getRight();</div><div class="line">        <span class="keyword">while</span> (node.getLeft() != <span class="keyword">null</span>) &#123;</div><div class="line">            node = node.getLeft();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> node;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">while</span> (node.getParent() != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (node.equals(node.getParent().getLeft())) &#123;</div><div class="line">                <span class="keyword">return</span> node.getParent();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                node = node.getParent();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 初始化二叉树</span></div><div class="line">ArrayList&lt;Node&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">14</span>);</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">14</span>; i++) &#123;</div><div class="line">    list.add(<span class="keyword">new</span> Node((<span class="keyword">char</span>) (<span class="string">'A'</span> + i)));</div><div class="line">&#125;</div><div class="line">list.get(<span class="number">0</span>).setLeft(list.get(<span class="number">1</span>));</div><div class="line">list.get(<span class="number">0</span>).setRight(list.get(<span class="number">2</span>));</div><div class="line">list.get(<span class="number">1</span>).setLeft(list.get(<span class="number">3</span>));</div><div class="line">list.get(<span class="number">1</span>).setRight(list.get(<span class="number">4</span>));</div><div class="line">list.get(<span class="number">2</span>).setLeft(list.get(<span class="number">5</span>));</div><div class="line">list.get(<span class="number">2</span>).setRight(list.get(<span class="number">6</span>));</div><div class="line">list.get(<span class="number">3</span>).setRight(list.get(<span class="number">7</span>));</div><div class="line">list.get(<span class="number">4</span>).setLeft(list.get(<span class="number">8</span>));</div><div class="line">list.get(<span class="number">4</span>).setRight(list.get(<span class="number">9</span>));</div><div class="line">list.get(<span class="number">5</span>).setRight(list.get(<span class="number">10</span>));</div><div class="line">list.get(<span class="number">6</span>).setLeft(list.get(<span class="number">11</span>));</div><div class="line">list.get(<span class="number">6</span>).setRight(list.get(<span class="number">12</span>));</div><div class="line">list.get(<span class="number">7</span>).setLeft(list.get(<span class="number">13</span>));</div><div class="line"></div><div class="line"><span class="keyword">for</span> (Node node : list) &#123;</div><div class="line">    System.out.println(<span class="string">"node:"</span> + node.getValue() + <span class="string">"; next node:"</span> + ((node = inorderNext(node)) == <span class="keyword">null</span> ? <span class="string">"null"</span> : node.getValue()));</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>时间复杂度：<br>空间复杂度：O(1)。</p><h2 id="扩展：前序遍历"><a href="#扩展：前序遍历" class="headerlink" title="扩展：前序遍历"></a><strong>扩展：前序遍历</strong></h2><p>思路：前序遍历的顺序是节点-&gt;左子节点-&gt;右子节点。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">preorder</span><span class="params">(ArrayList&lt;Node&gt; list, Node node)</span> </span>&#123;</div><div class="line">    list.add(node);</div><div class="line">    <span class="keyword">if</span> (node.getLeft() != <span class="keyword">null</span>) &#123;</div><div class="line">        preorder(list, node.getLeft());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (node.getRight() != <span class="keyword">null</span>) &#123;</div><div class="line">        preorder(list, node.getRight());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ArrayList&lt;Node&gt; preorderList = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">14</span>);</div><div class="line">preorder(preorderList, list.get(<span class="number">0</span>));</div><div class="line"><span class="keyword">for</span> (Node node : preorderList) &#123;</div><div class="line">    System.out.println(<span class="string">"node:"</span> + node.getValue());</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="扩展：中序遍历"><a href="#扩展：中序遍历" class="headerlink" title="扩展：中序遍历"></a><strong>扩展：中序遍历</strong></h2><p>思路：中序遍历的顺序是左子节点-&gt;节点-&gt;右子节点。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">inorder</span><span class="params">(ArrayList&lt;Node&gt; list, Node node)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (node.getLeft() != <span class="keyword">null</span>) &#123;</div><div class="line">        inorder(list, node.getLeft());</div><div class="line">    &#125;</div><div class="line">    list.add(node);</div><div class="line">    <span class="keyword">if</span> (node.getRight() != <span class="keyword">null</span>) &#123;</div><div class="line">        inorder(list, node.getRight());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ArrayList&lt;Node&gt; inorderList = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">14</span>);</div><div class="line">inorder(inorderList, list.get(<span class="number">0</span>));</div><div class="line"><span class="keyword">for</span> (Node node : inorderList) &#123;</div><div class="line">    System.out.println(<span class="string">"node:"</span> + node.getValue());</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="扩展：后序遍历"><a href="#扩展：后序遍历" class="headerlink" title="扩展：后序遍历"></a><strong>扩展：后序遍历</strong></h2><p>思路：后序遍历的顺序是左子节点-&gt;右子节点-&gt;节点。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">postorder</span><span class="params">(ArrayList&lt;Node&gt; list, Node node)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (node.getLeft() != <span class="keyword">null</span>) &#123;</div><div class="line">        postorder(list, node.getLeft());</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (node.getRight() != <span class="keyword">null</span>) &#123;</div><div class="line">        postorder(list, node.getRight());</div><div class="line">    &#125;</div><div class="line">    list.add(node);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ArrayList&lt;Node&gt; postorderList = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">14</span>);</div><div class="line">postorder(postorderList, list.get(<span class="number">0</span>));</div><div class="line"><span class="keyword">for</span> (Node node : postorderList) &#123;</div><div class="line">    System.out.println(<span class="string">"node:"</span> + node.getValue());</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="扩展：给定一棵二叉树和其中的一个节点，找出前序遍历序列的下一个节点"><a href="#扩展：给定一棵二叉树和其中的一个节点，找出前序遍历序列的下一个节点" class="headerlink" title="扩展：给定一棵二叉树和其中的一个节点，找出前序遍历序列的下一个节点"></a><strong>扩展：给定一棵二叉树和其中的一个节点，找出前序遍历序列的下一个节点</strong></h2><p>思路：<br>分情况讨论——<br>（1）给出的节点有左子节点，则下一个节点是该左子节点；<br>（2）给出的节点没有左子节点，但是有右子节点，则下一个节点是该右子节点；<br>（3）给出的节点没有子节点，如果它是父节点的右子节点，且有兄弟节点，则下一个节点是兄弟节点；如果它是父节点的右子节点，则沿着父节点向上遍历，直到节点是父节点的左子节点，并且有兄弟节点，则下一个节点是兄弟节点。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">preorderNext</span><span class="params">(Node node)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (node.getLeft() != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> node.getLeft();</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.getRight() != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> node.getRight();</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">while</span> (node.getParent() != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (node.equals(node.getParent().getLeft()) &amp;&amp; node.getParent().getRight() != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">return</span> node.getParent().getRight();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                node = node.getParent();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Node node = list.get(<span class="number">0</span>);</div><div class="line"><span class="keyword">while</span> (node != <span class="keyword">null</span>) &#123;</div><div class="line">    System.out.println(<span class="string">"node:"</span> + node.getValue() + <span class="string">"; next node:"</span> + ((node = preorderNext(node)) == <span class="keyword">null</span> ? <span class="string">"null"</span> : node.getValue()));</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="扩展：给定一棵二叉树和其中的一个节点，找出后序遍历序列的下一个节点"><a href="#扩展：给定一棵二叉树和其中的一个节点，找出后序遍历序列的下一个节点" class="headerlink" title="扩展：给定一棵二叉树和其中的一个节点，找出后序遍历序列的下一个节点"></a><strong>扩展：给定一棵二叉树和其中的一个节点，找出后序遍历序列的下一个节点</strong></h2><p>思路：<br>分情况讨论——<br>（1）给出的节点没有父节点，则下一个节点是 null；<br>（2）给出的节点有父节点，且是左节点，如果没有兄弟节点，则下一个节点是父节点；否则，找到兄弟节点的最左子节点，如果该节点没有左子节点，但是有右子节点，则继续向下遍历，最后获取的节点就是下一个节点；<br>（3）给出的节点有父节点，且是右节点，则下一个节点是父节点。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Node <span class="title">postorderNext</span><span class="params">(Node node)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (node.getParent() == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> (node.equals(node.getParent().getLeft())) &#123;</div><div class="line">            <span class="keyword">if</span> (node.getParent().getRight() == <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">return</span> node.getParent();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                node = node.getParent().getRight();</div><div class="line">                <span class="keyword">while</span> (node != <span class="keyword">null</span>) &#123;</div><div class="line">                    <span class="keyword">while</span> (node.getLeft() != <span class="keyword">null</span>) &#123;</div><div class="line">                        node = node.getLeft();</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span> (node.getRight() == <span class="keyword">null</span>) &#123;</div><div class="line">                        <span class="keyword">return</span> node;</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        node = node.getRight();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> node.getParent();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (Node node : list) &#123;</div><div class="line">    System.out.println(<span class="string">"node:"</span> + node.getValue() + <span class="string">"; next node:"</span> + ((node = postorderNext(node)) == <span class="keyword">null</span> ? <span class="string">"null"</span> : node.getValue()));</div><div class="line">&#125;</div></pre></td></tr></table></figure><hr><h1 id="用两个栈实现队列"><a href="#用两个栈实现队列" class="headerlink" title="用两个栈实现队列"></a><strong>用两个栈实现队列</strong></h1><blockquote><p>用两个栈实现一个队列，分别完成在队列尾部插入节点和在队列头部删除节点的功能。</p></blockquote><p>思路：<br>队列的特点是先进先出。栈的特点是后进先出，进栈和出栈的顺序相反，如果数据从栈 A 出栈后依次入栈 B，再从栈 B 出栈，则出栈 B 时的顺序和入栈 A 时的顺序是一致的。以此为突破口，即可实现队列。<br>初始化栈 A、B，栈 A 用于存数据，栈 B 用于取数据。当栈 B 没数据时，会先将栈 A 的数据导入到栈 B，然后再从栈 B 取数据；当栈 B 有数据时，就直接从栈 B 取数据，后续存入栈 A 的数据，等到栈 B 没数据时，在取数据前才从栈 A 导入到栈 B。<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%881068%EF%BC%898.PNG" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%881068%EF%BC%899.PNG" alt=""></p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Queue</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> Stack&lt;T&gt; stack1;</div><div class="line">    <span class="keyword">private</span> Stack&lt;T&gt; stack2;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Queue</span><span class="params">()</span> </span>&#123;</div><div class="line">        stack1 = <span class="keyword">new</span> Stack&lt;&gt;();</div><div class="line">        stack2 = <span class="keyword">new</span> Stack&lt;&gt;();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T t)</span> </span>&#123;</div><div class="line">        stack1.push(t);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (stack2.isEmpty()) &#123;</div><div class="line">            <span class="keyword">while</span> (!stack1.isEmpty()) &#123;</div><div class="line">                stack2.push(stack1.pop());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> stack2.pop();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"stack1:"</span> + stack1.toString() + <span class="string">"\nstack2:"</span> + stack2.toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Queue&lt;Integer&gt; queue = <span class="keyword">new</span> Queue&lt;&gt;();</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</div><div class="line">    <span class="keyword">int</span> random = <span class="keyword">new</span> Random().nextInt(<span class="number">128</span>);</div><div class="line">    <span class="keyword">if</span> ((random &amp; <span class="number">4</span>) == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Integer pop = queue.pop();</div><div class="line">            System.out.println(<span class="string">"pop:"</span> + pop + <span class="string">"\n"</span> + queue.toString());</div><div class="line">        &#125; <span class="keyword">catch</span> (EmptyStackException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        queue.push(random);</div><div class="line">        System.out.println(<span class="string">"push:"</span> + random + <span class="string">"\n"</span> + queue.toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>时间复杂度：<br>空间复杂度：</p><h2 id="相关题目：用两个队列实现一个栈"><a href="#相关题目：用两个队列实现一个栈" class="headerlink" title="相关题目：用两个队列实现一个栈"></a><strong>相关题目：用两个队列实现一个栈</strong></h2><p>思路：<br>初始化队列 A、B，两个队列都是用于存/取数据，但是同一时刻，只能有一个队列存数据，另一个队列中的数据为空。当取数据时，将前 n - 1 个数据导入到空队列中，返回倒数第 1 个数据，此时，原来的空队列已经有数据了，以后用于存数据，原来存数据的队列已经被清空了。两个队列交替，总是返回倒数第 1 个数据。<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E3%80%8A%E5%89%91%E6%8C%87%20Offer%E3%80%8B%E7%AE%97%E6%B3%95%E9%A2%98%EF%BC%881068%EF%BC%8910.PNG" alt=""></p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stack</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> ArrayDeque&lt;T&gt; queue1;</div><div class="line">    <span class="keyword">private</span> ArrayDeque&lt;T&gt; queue2;</div><div class="line">    <span class="keyword">private</span> ArrayDeque&lt;T&gt; pushQueue;</div><div class="line">    <span class="keyword">private</span> ArrayDeque&lt;T&gt; popQueue;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Stack</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</div><div class="line">        queue1 = <span class="keyword">new</span> ArrayDeque&lt;&gt;(capacity);</div><div class="line">        queue2 = <span class="keyword">new</span> ArrayDeque&lt;&gt;(capacity);</div><div class="line">        pushQueue = queue1;</div><div class="line">        popQueue = queue2;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(T t)</span> </span>&#123;</div><div class="line">        pushQueue.addLast(t);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">pop</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, size = pushQueue.size(); i &lt; size - <span class="number">1</span>; i++) &#123;</div><div class="line">            popQueue.add(pushQueue.removeFirst());</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (pushQueue == queue1) &#123;</div><div class="line">            pushQueue = queue2;</div><div class="line">            popQueue = queue1;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            pushQueue = queue1;</div><div class="line">            popQueue = queue2;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> popQueue.removeFirst();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"queue1:"</span> + queue1.toString() + <span class="string">"\nqueue2:"</span> + queue2.toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Stack&lt;Integer&gt; stack = <span class="keyword">new</span> Stack&lt;&gt;(<span class="number">20</span>);</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</div><div class="line">    <span class="keyword">int</span> random = <span class="keyword">new</span> Random().nextInt(<span class="number">128</span>);</div><div class="line">    <span class="keyword">if</span> ((random &amp; <span class="number">6</span>) == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Integer pop = stack.pop();</div><div class="line">            System.out.println(<span class="string">"pop:"</span> + pop + <span class="string">"\n"</span> + stack.toString());</div><div class="line">        &#125; <span class="keyword">catch</span> (NoSuchElementException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        stack.push(random);</div><div class="line">        System.out.println(<span class="string">"push:"</span> + random + <span class="string">"\n"</span> + stack.toString());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><hr><h1 id="斐波那契数列"><a href="#斐波那契数列" class="headerlink" title="斐波那契数列"></a><strong>斐波那契数列</strong></h1><blockquote><p>求斐波那契数列的第 n 项。</p></blockquote><p>思路：<br>递归由于多次重复计算，所以效率低。可以使用循环，由下向上计算。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">fibonacci</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">int</span> preTwo = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> preOne = <span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> value = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</div><div class="line">            value = preTwo + preOne;</div><div class="line">            preTwo = preOne;</div><div class="line">            preOne = value;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">0</span>; n &lt; <span class="number">10</span>; n++) &#123;</div><div class="line">    System.out.println(<span class="string">"fibonacci["</span> + n + <span class="string">"]:"</span> + fibonacci(n));</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>时间复杂度：O(n)。<br>空间复杂度：O(1)。</p><h2 id="题目二：青蛙跳台阶问题"><a href="#题目二：青蛙跳台阶问题" class="headerlink" title="题目二：青蛙跳台阶问题"></a><strong>题目二：青蛙跳台阶问题</strong></h2><blockquote><p>一只青蛙一次可以跳上 1 级台阶，也可以跳上 2 级台阶。求该青蛙跳上一个 n 级的台阶总共有多少种跳法。</p></blockquote><p>思路：<br>把 n 级台阶时的跳法看成 n 的函数，计为 f(n)，当 n &gt; 2 时，如果第一次跳 1 级，则跳法数目等于剩余 n - 1 级台阶的跳法数目，即 f(n - 1)；如果第一次跳 2 级，则跳法数目等于剩余 n - 2 级台阶的跳法数目，即 f(n - 2)；因为第一次只能跳 1 级或 2 级，所以 f(n) = f(n - 1) + f(n - 2)，就是上面的斐波那契数列了。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">jump</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">int</span> preTwo = <span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> preOne = <span class="number">2</span>;</div><div class="line">        <span class="keyword">int</span> value = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt;= n; i++) &#123;</div><div class="line">            value = preTwo + preOne;</div><div class="line">            preTwo = preOne;</div><div class="line">            preOne = value;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">1</span>; n &lt; <span class="number">10</span>; n++) &#123;</div><div class="line">    System.out.println(<span class="string">"jump["</span> + n + <span class="string">"]:"</span> + jump(n));</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="本题扩展：青蛙跳-n-级台阶时，一次最多可以跳-n-级"><a href="#本题扩展：青蛙跳-n-级台阶时，一次最多可以跳-n-级" class="headerlink" title="本题扩展：青蛙跳 n 级台阶时，一次最多可以跳 n 级"></a><strong>本题扩展：青蛙跳 n 级台阶时，一次最多可以跳 n 级</strong></h3><blockquote><p>在青蛙跳台阶的问题中，如果把条件改成：一只青蛙一次可以跳上 1 级台阶，也可以跳上 2 级台阶……它也可以跳上 n 级，此时该青蛙跳上一个 n 级的台阶总共有多少种跳法？我们用数学归纳法可以证明 f(n) = 2^(n - 1)。</p></blockquote><p>思路：<br>因为 f(n) = 2^(n - 1)，所以 f(n - 1) = 2^[(n - 1) - 1] = 2^(n - 1) * 2^(-1)，也就是说 f(n) 是 f(n - 1) 的 2 倍。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">jump</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">int</span> value = <span class="number">1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</div><div class="line">            value *= <span class="number">2</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">1</span>; n &lt; <span class="number">10</span>; n++) &#123;</div><div class="line">    System.out.println(<span class="string">"jump["</span> + n + <span class="string">"]:"</span> + jump(n));</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="相关题目：用-2-x-1-的小矩形横着或者竖着去覆盖-2-x-n-的大矩形"><a href="#相关题目：用-2-x-1-的小矩形横着或者竖着去覆盖-2-x-n-的大矩形" class="headerlink" title="相关题目：用 2 x 1 的小矩形横着或者竖着去覆盖 2 x n 的大矩形"></a><strong>相关题目：用 2 x 1 的小矩形横着或者竖着去覆盖 2 x n 的大矩形</strong></h2><blockquote><p>我们可以用 2 x 1 的小矩形横着或者竖着去覆盖更大的矩形。请问用 n 个 2 x 1 的小矩形无重叠地覆盖一个 2 x n 的大矩形，总共有多少种方法？</p></blockquote><p>思路：<br>当小矩形竖着放时，剩余面积是 2 x (n - 1)；当小矩形横着放时，小矩形下方也是惟一确定可以放一个小矩形，剩余面积是 2 x （n - 2）；所以 f(n) = f(n - 1) + f(n - 2)。</p><p>实现：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">jump</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (n == <span class="number">2</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">int</span> preTwo = <span class="number">1</span>;</div><div class="line">        <span class="keyword">int</span> preOne = <span class="number">2</span>;</div><div class="line">        <span class="keyword">int</span> value = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">3</span>; i &lt;= n; i++) &#123;</div><div class="line">            value = preTwo + preOne;</div><div class="line">            preTwo = preOne;</div><div class="line">            preOne = value;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> value;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">1</span>; n &lt; <span class="number">10</span>; n++) &#123;</div><div class="line">    System.out.println(<span class="string">"jump["</span> + n + <span class="string">"]:"</span> + jump(n));</div><div class="line">&#125;</div></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://bl
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>数据结构</title>
    <link href="http://www.weichao.io/2020/03/12/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
    <id>http://www.weichao.io/2020/03/12/数据结构/</id>
    <published>2020-03-12T07:57:42.000Z</published>
    <updated>2020-03-12T08:05:22.959Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://juejin.im/post/5b3c30bde51d451964620710#heading-4" title="https://juejin.im/post/5b3c30bde51d451964620710#heading-4" target="_blank" rel="external">数据结构与算法（java）</a></li><li><a href="https://tech.meituan.com/2016/06/24/java-hashmap.html" title="https://tech.meituan.com/2016/06/24/java-hashmap.html" target="_blank" rel="external">Java 8系列之重新认识HashMap</a></li><li><a href="https://tech.meituan.com/2016/12/02/redblack-tree.html" title="https://tech.meituan.com/2016/12/02/redblack-tree.html" target="_blank" rel="external">红黑树深入剖析及Java实现</a></li><li><a href="https://blog.csdn.net/javazejian/article/details/72828483#synchronized%E5%BA%95%E5%B1%82%E8%AF%AD%E4%B9%89%E5%8E%9F%E7%90%86" title="https://blog.csdn.net/javazejian/article/details/72828483#synchronized%E5%BA%95%E5%B1%82%E8%AF%AD%E4%B9%89%E5%8E%9F%E7%90%86" target="_blank" rel="external">深入理解Java并发之synchronized实现原理</a></li><li><a href="https://www.cnblogs.com/yangfeiORfeiyang/p/9694383.html" title="https://www.cnblogs.com/yangfeiORfeiyang/p/9694383.html" target="_blank" rel="external">ConcurrentHashMap 1.8为什么要使用CAS+Synchronized取代Segment+ReentrantLock</a></li><li><a href="https://mp.weixin.qq.com/s/AF2tMHfofG8b51yIyaIReg" title="https://mp.weixin.qq.com/s/AF2tMHfofG8b51yIyaIReg" target="_blank" rel="external">拜托，面试别再问我堆（排序）了！</a></li></ul><hr><h1 id="数据结构比较"><a href="#数据结构比较" class="headerlink" title="数据结构比较"></a><strong>数据结构比较</strong></h1><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84202003121.png" alt=""></p><hr><h1 id="数据结构选择"><a href="#数据结构选择" class="headerlink" title="数据结构选择"></a><strong>数据结构选择</strong></h1><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84202003122.png" alt=""></p><hr><h1 id="Java-中数据结构的体现"><a href="#Java-中数据结构的体现" class="headerlink" title="Java 中数据结构的体现"></a><strong>Java 中数据结构的体现</strong></h1><h2 id="数组（Array）"><a href="#数组（Array）" class="headerlink" title="数组（Array）"></a><strong>数组（Array）</strong></h2><blockquote><p>数组是一种效率最高的存储和随机访问对象引用序列的方式。数组就是一个简单的线性序列，这使得元素访问非常快速。但是这种速度所付出的代价是数组对象的大小被固定，并且在其生命周期中不可改变。</p></blockquote><h3 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a><strong>ArrayList</strong></h3><p>与数组相比：可变长度。<br>可变长度的实现原理：每当添加元素时，都会检查内部数组的大小是否够用，不够用时会扩容。<br>优化：尽量避免触发扩容。ArrayList 默认大小是 10，创建时估计好容量，使用带参数的构造方法创建。</p><p>允许元素为 null。</p><p><strong><em>扩容？</em></strong><br>扩容时会以当前容量的 1.5 倍大小重新创建数组，并将原数据复制到新数组中。</p><h3 id="Vector"><a href="#Vector" class="headerlink" title="Vector"></a><strong>Vector</strong></h3><p>与 ArrayList 相比：线程安全、扩容时是 2 倍。<br>线程安全的实现原理：方法上使用 synchronized 关键字。</p><h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a><strong>Stack</strong></h3><p>基于 Vector 实现，线程安全。</p><h3 id="ArrayDeque"><a href="#ArrayDeque" class="headerlink" title="ArrayDeque"></a><strong>ArrayDeque</strong></h3><p>双向循环队列。当作为栈使用时，性能比 Stack 好；当作为队列使用时，性能比 LinkedList 好。<br>与 Stack 相比：线程不安全。</p><p>双向循环队列实现原理：引入两个游标，head 和 tail，如果向队列里插入一个元素，就把 tail 向后移动（如果 tail 已经指向了数组的最后一位，需要将 tail 重新指向数组的头）；如果从队列中删除一个元素，就把 head 向后移动。</p><p>初始容量是 2 的幂次方，扩容时是 2 倍。</p><h3 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue"></a><strong>PriorityQueue</strong></h3><p>优先队列。<br>优先队列实现原理：逻辑结构是堆。默认是小顶堆，可以通过比较器改为大顶堆。</p><ul><li>默认容量是 11，容量小于 64 时，扩容 2 倍 + 1；否则 扩容 1.5 倍。</li><li>数组从 0 开始存数据，计算父节点索引使用<code>(k - 1) &gt;&gt;&gt; 1</code>。</li><li>不允许元素为 null。</li></ul><p><strong><em>堆的性质？</em></strong></p><ol><li>完全二叉树，与二叉树相比：叶子节点只能出现在最下层和次下层，并且最下面一层的结点都集中在该层的最左边；</li><li>堆中某个节点的值总是不大于（或不小于）其父节点的值，同一层节点的值不存在大小关系。</li></ol><h4 id="堆的插入"><a href="#堆的插入" class="headerlink" title="堆的插入"></a><strong>堆的插入</strong></h4><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84202003123.png" alt=""></p><p>1、把新元素插入到最后一个节点往后一位的位置；<br>2、将新元素和父节点比较，如果新元素不大于父节点，就把新元素放在这个位置，否则，就交换它们的位置；循环执行此步骤。</p><p><strong><em>为什么索引 0 不存元素？</em></strong><br>方便通过<code>索引/2</code>的操作获取父节点的索引。</p><h4 id="堆的删除"><a href="#堆的删除" class="headerlink" title="堆的删除"></a><strong>堆的删除</strong></h4><p>堆的删除特指删除堆顶元素。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84202003124.png" alt=""></p><p>把最后一个节点放到堆顶，然后与左、右子节点中小的节点交换位置；循环执行此步骤。</p><p><strong><em>为什么 ArrayList 没有像 LinkedList 一样直接实现栈或双端队列？</em></strong><br>因为 ArrayList 从队列头删除元素时，要把后面的元素向前拷贝，性能低。</p><h2 id="链表（Linked-List）"><a href="#链表（Linked-List）" class="headerlink" title="链表（Linked List）"></a><strong>链表（Linked List）</strong></h2><blockquote><p>链表是一种物理存储单元上非连续、非顺序的存储结构，数据元素的逻辑顺序是通过链表中的指针链接次序实现的。</p></blockquote><h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a><strong>LinkedList</strong></h3><p>与链表相比：LinkedList 是双向链表。</p><p>允许元素为 null。</p><p>LinkedList 实现了栈和双端队列。</p><h2 id="数组-链表-哈希表（Hash-Table）"><a href="#数组-链表-哈希表（Hash-Table）" class="headerlink" title="数组 + 链表 = 哈希表（Hash Table）"></a><strong>数组 + 链表 = 哈希表（Hash Table）</strong></h2><blockquote><p>数据经过哈希算法之后得到的集合。这样关键字和数据在集合中的位置存在一定的关系，可以根据这种关系快速查询。</p></blockquote><h3 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a><strong>HashMap</strong></h3><p>与哈希表相比：</p><p>在 JDK 1.7 及以前，HashMap 的数据结构是数组 + 单向链表。<br>在 JDK 1.8 之后，HashMap 的数据结构在初始化的时候是数组 + 单向链表，链表会改为红黑树优化。</p><ul><li>最大容量是 2^30。</li><li>容器没有在构造函数中初始化，而是在第一次插入时进行初始化，且会计算为 2 的幂次方，初始化时会进行第一次扩容。</li><li>默认容量大小是 16，负载因子是 0.75，所以当插入第 13 个元素时会进行第二次扩容，扩容倍数是 2 倍。</li><li>如果容量大于或等于 64 且链表大小大于或等于 8 时，链表改为红黑树，当链表大小小于或等于 6 时，红黑树改为链表。</li></ul><p>优化：尽量避免触发扩容。HashMap 默认不触发扩容大小是 16 * 0.75 = 12，创建时估计好容量，使用带参数的构造方法创建。</p><p>允许 null 键和 null 值。</p><p><strong><em>为什么不将链表全部换成红黑树？</em></strong></p><ol><li>由于数据量的不同，数组 + 链表 + 红黑树的结构不一定比数组 + 链表的结构性能高；</li><li>HashMap 扩容时会重新计算节点的索引位置，也就是会将红黑树进行拆分和重组。</li></ol><p><strong><em>改变负载因子的后果？</em></strong><br>负载因子过高会导致链表过长，查找键值对时间增加，负载因子过低会导致扩容频率增加。</p><h4 id="HashMap-工作原理"><a href="#HashMap-工作原理" class="headerlink" title="HashMap 工作原理"></a><strong>HashMap 工作原理</strong></h4><h5 id="插入"><a href="#插入" class="headerlink" title="插入"></a><strong>插入</strong></h5><p>将 K/V 键值传给 put() 方法：<br>1、调用 hash(K) 方法计算 K 的 hash 值，然后结合数组长度，计算得数组下标；<br>2、如果 K 的 hash 值在 HashMap 中不存在，则执行插入；否则，发生 hash 冲突；<br>（3、发生 hash 冲突时，如果 equals 返回 true，则更新键值对；否则，插入链表（JDK 1.7 之前使用头插法、JDK 1.8 开始使用尾插法）或者红黑树中（树的添加方式）；）<br>（4、调整数组大小。当容器中的元素个数大于阈值时，容器会进行扩容。）</p><p><strong><em>如何计算数组索引位置？</em></strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> h;</div><div class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent, <span class="keyword">boolean</span> evict)</span> </span>&#123;</div><div class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</div><div class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</div><div class="line">        n = (tab = resize()).length;</div><div class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p><ol><li><code>(h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>：将 key 的 hashCode 值及其无符号右移16位后的值进行异或操作；</li><li><code>i = (n - 1) &amp; hash</code>：将 hash 值与数组大小 - 1 的值取与。</li></ol><p><strong><em>为什么不直接使用 hashCode？</em></strong><br>如果使用<code>(n - 1) &amp; hashCode</code>，因为 n 的值一般情况下很小，基本上只有 hashCode 的低 16 位能参与计算，这会导致数据在数组中分布不均匀；<code>(h = key.hashCode()) ^ (h &gt;&gt;&gt; 16)</code>是让 hashCode 的高 16 位也能间接参与计算，使数据在数组中均匀分布。</p><p><strong><em>为什么使用 (n - 1) &amp; hash 而不使用 hash % n ？</em></strong><br>结果是等价的。但是 &amp; 是二进制直接计算，效率高。<br>当数组大小是 2 的幂次方，也就是一个合数时，可能会导致 hash 冲突概率更高，因为质数比合数更保险。但是 2 的幂次方有利于<code>(n - 1) &amp; hash</code>运算，如果是合数会导致有几个位置不可用，肯定会增加 hash 冲突的概率，而且质数扩容后也得是质数。所以 2 的幂次方和<code>(n - 1) &amp; hash</code>的效率至少不低于质数 + <code>hash % n</code>。</p><p><strong><em>扩容？</em></strong><br>扩容时会以当前容量的 2 倍大小重新创建数组，并重新计算数据在数组中的位置。新位置可能是原位置，也可能是原位置 + 原数组大小。</p><h5 id="读取"><a href="#读取" class="headerlink" title="读取"></a><strong>读取</strong></h5><p>将 K 传给 get() 方法：<br>1、调用 hash(K) 方法计算 K 的 hash 值，然后结合数组长度，计算得数组下标；<br>2、遍历链表，使用 equals() 方法查找相同 K 值对应的 V 值。</p><h3 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a><strong>HashTable</strong></h3><p>已被 ConcurrentHashMap 取代。</p><p>与 HashMap 相比：</p><p>1、线程安全。<br>线程安全的实现原理：方法用 synchronized 修饰。</p><p>2、HashTable 的数据结构是数组 + 单向链表。</p><ul><li>最大容量是 Integer.MAX_VALUE - 8。</li><li>容器在构造函数中初始化。</li><li>默认容量大小是 11，负载因子是 0.75，所以当插入第 9 个元素时会进行第一次扩容，扩容倍数是 2 倍 + 1。</li></ul><p>优化：尽量避免触发扩容。HashTable 默认不触发扩容大小是 11 * 0.75 = 8.25，创建时估计好容量，使用带参数的构造方法创建。</p><p>不允许 null 键或 null 值。</p><p><strong><em>HashTable 为什么不允许 null 键或 null 值？</em></strong></p><ol><li>作者希望每个 key 都会实现 hashCode 和 equals 方法；</li><li>HashTable 开发时间早于 HashMap，是一个过时的类。</li></ol><h4 id="HashTable-工作原理"><a href="#HashTable-工作原理" class="headerlink" title="HashTable 工作原理"></a><strong>HashTable 工作原理</strong></h4><h5 id="插入-1"><a href="#插入-1" class="headerlink" title="插入"></a><strong>插入</strong></h5><p>将 K/V 键值传给 put() 方法：<br>1、计算数组下标；<br>2、如果 K 的 hash 值在 HashTable 中不存在，则执行插入；否则，发生 hash 冲突；<br>（3、发生 hash 冲突时，如果 equals 返回 true，则更新键值对；否则，插入链表；）<br>（4、调整数组大小。当容器中的元素个数大于或等于阈值时，容器会进行扩容。）</p><p><strong><em>如何计算数组索引位置？</em></strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> hash = key.hashCode();</div><div class="line"><span class="keyword">int</span> index = (hash &amp; <span class="number">0x7FFFFFFF</span>) % tab.length;</div></pre></td></tr></table></figure></p><h3 id="ConcurrentHashMap"><a href="#ConcurrentHashMap" class="headerlink" title="ConcurrentHashMap"></a><strong>ConcurrentHashMap</strong></h3><p>与 HashMap 相比：</p><p>1、线程安全。<br>线程安全的实现原理：JDK 1.7 使用分段锁、JDK 1.8 使用 CAS（无锁算法） + synchronized（ConcurrentHashMap 是 JDK 1.5 推出的，在 JDK 1.6 时 JVM 引入偏向锁、轻量锁，等到 JDK 1.8 才优化）。</p><p>不允许 null 键或 null 值。</p><ul><li>默认并发数量是 16（即 segment 数组的大小），最大是 2^16，会计算为 2 的幂次方。</li></ul><p>ConcurrentHashMap 有 fail-safe 机制。</p><p><strong><em>fail-fast 和 fail-safe 机制？</em></strong></p><ol><li>fail-fast 机制确保了遍历或多线程操作时，如果改变结构，就会抛出 ConcurrentModificationException，实现原理是通过变量 modCount 记录修改次数，在遍历时会判断 expectedModCount 是否和 modCount 相等。<br>大部分非同步的类都支持 fail-fast，而且 Vector 和 HashTable 也支持，用于迭代器遍历。</li><li>fail-safe 机制确保了改变结构时不会抛出 ConcurrentModificationException，实现原理是在原集合的 copy 上遍历，这会导致额外的空间和时间的开销，并且不能保证遍历的是最新的内容。</li></ol><p><strong><em>ConcurrentHashMap 分段锁的原理？</em></strong><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84202003125.png" alt=""></p><p>ConcurrentHashMap 持有一组锁（segment 数组），当写操作发生在不同的锁中时，就可以并行操作，实现了并发写；同时用 volatile 修饰 HashEntry 的 value，确保了并发读的一致性。</p><p><strong><em>Segment 为什么能当锁？</em></strong><br>Segment 类继承于 ReentrantLock 类。</p><p><strong><em>volatile 作用？</em></strong></p><ol><li>实现有序性：比如确保实例化对象的顺序——1）分配内存空间、2）初始化对象、3）将内存空间的地址赋值给对应的引用；原理是 volatile 会转换为 CPU 的 lock 指令，建立内存屏障；</li><li>实现多线程可见性：每个线程拥有自己的一个高速缓存区内存，其他线程不可见，修改 volatile 修饰的变量时会强制将修改后的值刷新到主内存中，同时让其他线程中缓存的该变量的值失效，读取时使用主内存的值；</li><li>只能保证单次操作的原子性，所以无法完全代替 synchronized。</li></ol><p><strong><em>为什么使用 CAS + synchronized 取代分段锁？</em></strong><br>在 JVM 中，对象在内存中的布局分为三块区域：对象头、实例数据和对齐填充。synchronized 是靠对象头和此对象对应的 monitor 来保证上锁的，也就是对象头里的重量级锁标志指向了 monitor，而 monitor 内部则保存了一个当前线程，也就是抢到了锁的线程。<br>synchronized 和 ReentrantLock 开销差距是释放锁时唤醒线程的数量，synchronized 是唤醒锁池里所有的线程 + 刚好来访问的线程，而 ReentrantLock 是当前线程后进来的第一个线程 + 刚好来访问的线程。synchronized 由于 JVM 优化后会经历偏向锁、轻量锁、自旋锁，不是重量级锁不存在线程挂起和唤醒的过程，所以性能高于 ReentrantLock。</p><h2 id="链表-哈希表"><a href="#链表-哈希表" class="headerlink" title="链表 + 哈希表"></a><strong>链表 + 哈希表</strong></h2><h3 id="LinkedHashMap"><a href="#LinkedHashMap" class="headerlink" title="LinkedHashMap"></a><strong>LinkedHashMap</strong></h3><p>HashMap 的子类，与 HashMap 相比：保存了记录的插入顺序。<br>保存插入顺序的原理：使用双向链表，重写 newNode 方法，插入的同时会调用 linkNodeLast 方法将新元素插入链表。</p><h2 id="树（Tree）"><a href="#树（Tree）" class="headerlink" title="树（Tree）"></a><strong>树（Tree）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84202003126.png" alt=""></p><h3 id="二叉查找树（Binary-Search-Tree）"><a href="#二叉查找树（Binary-Search-Tree）" class="headerlink" title="二叉查找树（Binary Search Tree）"></a><strong>二叉查找树（Binary Search Tree）</strong></h3><p>与树相比：最多有两棵子树，左子树上所有结点的值均小于它的根结点的值，右子树上所有结点的值均大于它的根结点的值。</p><h3 id="红黑树（Red-Black-Tree）"><a href="#红黑树（Red-Black-Tree）" class="headerlink" title="红黑树（Red-Black Tree）"></a><strong>红黑树（Red-Black Tree）</strong></h3><p>与二叉查找树相比：一个枝叶分布非常平均的二叉树，所以不管访问哪个元素，时间复杂度都不会特别离谱。</p><ul><li>每个节点是红色或黑色；</li><li>叶子节点（NIL）是黑色；</li><li>根节点是黑色；</li><li>不能有两个连续的红色节点；</li><li>从任一节点到其每个叶子节点的所有路径都包含相同数目的黑色节点。</li></ul><p>这些性质强制了红黑树的关键性质：从根到叶子的最长的可能路径不多于最短的可能路径的两倍长。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84202003127.jpeg" alt=""></p><p>在插入和删除元素时，可能需要旋转才能保持红黑树。</p><p><strong>左旋</strong><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84202003128.gif" alt=""></p><p><strong>右旋</strong><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84202003129.gif" alt=""></p><h4 id="插入-2"><a href="#插入-2" class="headerlink" title="插入"></a><strong>插入</strong></h4><p>1、为了避免违背性质 5，将插入的新节点着色为”红色”；<br>2、将红黑树当作一颗二叉查找树，将新节点插入；<br>3、插入后修复：<br>（1）父节点为黑色时——插入完成。<br>（2）父节点为红色且有叔叔节点（叔叔节点此时必为红色）时——让父辈节点都变黑色，爷爷节点变红色。此时爷爷节点相当于新插入的节点；<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%842020031210.png" alt=""><br>（3）只有红色父节点，且新节点、父节点、爷爷节点处于一侧时——让父节点旋转，同时父节点和爷爷节点变色。此时爷爷节点相当于新插入的节点；<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%842020031211.png" alt=""><br>（4）只有红色父节点，且新节点、父节点、爷爷节点不处于一侧时——先让新节点和父节点通过旋转变为同侧，再执行（3）；<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%842020031212.png" alt=""></p><h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a><strong>删除</strong></h4><p>1、将红黑树当作一颗二叉查找树，将节点删除（被删除节点有两个子树时，将被删除节点替换为右子树最小值或左子树最大值的节点，这样就将有两个子树的节点转为最多只有一个子树的节点）；<br>2、删除后修复：<br>（1）被删除节点是红色节点时——删除完成。<br>（2）被删除节点是黑色节点，且兄弟节点是红色时——让兄弟节点旋转，同时父节点和兄弟节点变色，此时新的兄弟节点是黑色的，变为（3）（4）（5）之一；<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%842020031213.png" alt=""><br>（3）被删除节点是黑色节点，且兄弟节点是黑色，且兄弟节点的子节点都是黑色时——让父节点和兄弟节点变色。此时父节点相当于新插入的节点；<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%842020031214.png" alt=""><br>（4）被删除节点是黑色节点，且兄弟节点是黑色，且兄弟节点的近端子节点是黑色时——让兄弟节点旋转，同时兄弟节点的右节点变色。<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%842020031215.png" alt=""><br>（5）被删除节点是黑色节点，且兄弟节点是黑色，且兄弟节点的远端子节点是黑色时——让兄弟节点旋转，同时兄弟节点和近端子节点变色，在执行（4）；<br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%842020031216.png" alt=""></p><h4 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a><strong>TreeMap</strong></h4><p>与红黑树区别：允许 null 键和 null 值。</p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://ju
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>设计模式</title>
    <link href="http://www.weichao.io/2020/03/03/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <id>http://www.weichao.io/2020/03/03/设计模式/</id>
    <published>2020-03-03T11:39:09.000Z</published>
    <updated>2020-03-03T11:55:09.543Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://www.cnblogs.com/zhuxiansheng/tag/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="https://www.cnblogs.com/zhuxiansheng/tag/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" target="_blank" rel="external">大话设计模式</a></li></ul><hr><h1 id="设计模式串联"><a href="#设计模式串联" class="headerlink" title="设计模式串联"></a><strong>设计模式串联</strong></h1><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F1.png" alt=""></p><hr><h1 id="创建型"><a href="#创建型" class="headerlink" title="创建型"></a><strong>创建型</strong></h1><h2 id="单例模式（Singleton）"><a href="#单例模式（Singleton）" class="headerlink" title="单例模式（Singleton）"></a><strong>单例模式（Singleton）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F2.png" alt=""></p><blockquote><p>保证一个类仅有一个实例，并提供一个访问它的全局访问点。<br>有个人自己开了一家餐厅，这家餐厅只有一个老板。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// InputMethodManager 用于控制显示或隐藏输入法面板</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">InputMethodManager</span> </span>&#123;</div><div class="line">    <span class="keyword">static</span> InputMethodManager sInstance;</div><div class="line">    </div><div class="line">    InputMethodManager(IInputMethodManager service, Looper looper) &#123;</div><div class="line">        mService = service;</div><div class="line">        mMainLooper = looper;</div><div class="line">        mH = <span class="keyword">new</span> H(looper);</div><div class="line">        mIInputContext = <span class="keyword">new</span> ControlledInputConnectionWrapper(looper, mDummyInputConnection, <span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> InputMethodManager <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span> (InputMethodManager.class) &#123;</div><div class="line">            <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    sInstance = <span class="keyword">new</span> InputMethodManager(Looper.getMainLooper());</div><div class="line">                &#125; <span class="keyword">catch</span> (ServiceNotFoundException e) &#123;</div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(e);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> sInstance;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="饿汉式"><a href="#饿汉式" class="headerlink" title="饿汉式"></a><strong>饿汉式</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> SingleTon mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="懒汉式-线程不安全"><a href="#懒汉式-线程不安全" class="headerlink" title="懒汉式(线程不安全)"></a><strong>懒汉式(线程不安全)</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> SingleTon mSingleTon = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>) &#123;</div><div class="line">mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="懒汉式-线程安全"><a href="#懒汉式-线程安全" class="headerlink" title="懒汉式(线程安全)"></a><strong>懒汉式(线程安全)</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> SingleTon mSingleTon = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>) &#123;</div><div class="line">mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="懒汉式-双重校验锁，线程不一定安全"><a href="#懒汉式-双重校验锁，线程不一定安全" class="headerlink" title="懒汉式(双重校验锁，线程不一定安全)"></a><strong>懒汉式(双重校验锁，线程不一定安全)</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> SingleTon mSingleTon = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>)&#123;</div><div class="line"><span class="keyword">synchronized</span>(SingleTon.class) &#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>) &#123;</div><div class="line">mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="懒汉式-双重校验锁，线程安全"><a href="#懒汉式-双重校验锁，线程安全" class="headerlink" title="懒汉式(双重校验锁，线程安全)"></a><strong>懒汉式(双重校验锁，线程安全)</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span></span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> SingleTon mSingleTon = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>)&#123;</div><div class="line"><span class="keyword">synchronized</span>(SingleTon.class) &#123;</div><div class="line"><span class="keyword">if</span>(mSingleTon == <span class="keyword">null</span>) &#123;</div><div class="line">mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a><strong>枚举</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">enum</span> SingleTon &#123;</div><div class="line">SINGLE</div><div class="line">&#125;</div><div class="line"></div><div class="line">SingleTon.SINGLE</div></pre></td></tr></table></figure><h3 id="静态内部类"><a href="#静态内部类" class="headerlink" title="静态内部类"></a><strong>静态内部类</strong></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleTon</span> </span>&#123;</div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InnerClass</span> </span>&#123;</div><div class="line"><span class="keyword">static</span> SingleTon mSingleTon = <span class="keyword">new</span> SingleTon();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="title">SingleTon</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingleTon <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line"><span class="keyword">return</span> InnerClass.mSingleTon;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="建造者模式（Builder）"><a href="#建造者模式（Builder）" class="headerlink" title="建造者模式（Builder）"></a><strong>建造者模式（Builder）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F3.png" alt=""></p><blockquote><p>将一个复杂的对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。<br>老板打算在招聘网站上招人，一般就是填写完招人要求后，网站返回符合要求的人。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 招人 </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> 年龄;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> 性别;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> 技能;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> 招人(招人要求 要求) &#123;</div><div class="line">        <span class="keyword">this</span>.年龄 = 要求.年龄;</div><div class="line">        <span class="keyword">this</span>.性别 = 要求.性别;</div><div class="line">        <span class="keyword">this</span>.技能 = 要求.技能;</div><div class="line">    &#125;</div><div class="line">        </div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> get年龄() &#123;</div><div class="line">        <span class="keyword">return</span> 年龄;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> get性别() &#123;</div><div class="line">        <span class="keyword">return</span> 性别;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> get技能() &#123;</div><div class="line">        <span class="keyword">return</span> 技能;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> 招人要求 </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> 年龄;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span> 性别;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> 技能;</div><div class="line">        </div><div class="line">        <span class="keyword">public</span> 招人要求(<span class="keyword">int</span> 技能) &#123;</div><div class="line">            <span class="keyword">this</span>.技能 = 技能;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">public</span> 招人要求 set年龄(<span class="keyword">int</span> 年龄) &#123;</div><div class="line">            <span class="keyword">this</span>.年龄 = 年龄;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">public</span> 招人要求 set性别(<span class="keyword">int</span> 性别) &#123;</div><div class="line">            <span class="keyword">this</span>.性别 = 性别;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">public</span> 招人 开始查找() &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> 招人(<span class="keyword">this</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        招人 服务员 = <span class="keyword">new</span> 招人.招人要求(辅助点餐)</div><div class="line">            .set年龄(<span class="number">60</span>以下)</div><div class="line">            .set性别(男女均可)</div><div class="line">            .开始查找();</div><div class="line">        招人 厨师 = <span class="keyword">new</span> 招人.招人要求(做菜)</div><div class="line">            .set年龄(<span class="number">60</span>以下)</div><div class="line">            .set性别(男女均可)</div><div class="line">            .开始查找();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="工厂方法模式（FactoryMethod）"><a href="#工厂方法模式（FactoryMethod）" class="headerlink" title="工厂方法模式（FactoryMethod）"></a><strong>工厂方法模式（FactoryMethod）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F4.png" alt=""></p><blockquote><p>定义一个用于创建对象的接口，让子类决定实例化哪一个类。<br>老板可能从某联上招人，也可能从某勾上招人，某联使用的就是某联的数据库，某勾使用的是某勾的数据库。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 服务员 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 辅助点餐();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 某联人才库中的服务员 <span class="keyword">implements</span> 服务员 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 辅助点餐() &#123;</div><div class="line">        System.out.println(<span class="string">"某联人才库中的服务员辅助点餐!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 某勾人才库中的服务员 <span class="keyword">implements</span> 服务员 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 辅助点餐() &#123;</div><div class="line">        System.out.println(<span class="string">"某勾人才库中的服务员辅助点餐!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 厨师 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 做菜();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 某联人才库中的厨师 <span class="keyword">implements</span> 厨师 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 做菜() &#123;</div><div class="line">        System.out.println(<span class="string">"某联人才库中的厨师做菜!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 某勾人才库中的厨师 <span class="keyword">implements</span> 厨师 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 做菜() &#123;</div><div class="line">        System.out.println(<span class="string">"某勾人才库中的厨师做菜!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 招聘网站 </span>&#123;</div><div class="line">    List&lt;员工&gt; 招聘();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 某联招聘网站 <span class="keyword">implements</span> 招聘网站 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;员工&gt; 招聘() &#123;</div><div class="line">        List&lt;员工&gt; 员工们 = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">2</span>);</div><div class="line">        员工们.add(<span class="keyword">new</span> 某联人才库中的服务员());</div><div class="line">        员工们.add(<span class="keyword">new</span> 某联人才库中的厨师());</div><div class="line">        <span class="keyword">return</span> 员工们;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 某勾招聘网站 <span class="keyword">implements</span> 招聘网站 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;员工&gt; 招聘() &#123;</div><div class="line">        List&lt;员工&gt; 员工们 = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">2</span>);</div><div class="line">        员工们.add(<span class="keyword">new</span> 某勾人才库中的服务员());</div><div class="line">        员工们.add(<span class="keyword">new</span> 某勾人才库中的厨师());</div><div class="line">        <span class="keyword">return</span> 员工们;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> 某勾招聘网站().招聘();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="抽象工厂模式（AbstractFactory）"><a href="#抽象工厂模式（AbstractFactory）" class="headerlink" title="抽象工厂模式（AbstractFactory）"></a><strong>抽象工厂模式（AbstractFactory）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F5.png" alt=""></p><blockquote><p>为创建一组相关或者是相互依赖的对象提供一个接口，而不需要指定他们的具体实现类。<br>招聘网站千千万找不过来，老板决定让猎头找。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 猎头招聘网站 <span class="keyword">implements</span> 招聘网站 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;员工&gt; 招聘() &#123;</div><div class="line">        List&lt;员工&gt; 员工们 = <span class="keyword">new</span> ArrayList&lt;&gt;(<span class="number">2</span>);</div><div class="line">        员工们.add(<span class="keyword">new</span> 某联人才库中的服务员());</div><div class="line">        员工们.add(<span class="keyword">new</span> 某勾人才库中的厨师());</div><div class="line">        <span class="keyword">return</span> 员工们;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> 猎头招聘网站().招聘();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="原型模式（Prototype）"><a href="#原型模式（Prototype）" class="headerlink" title="原型模式（Prototype）"></a><strong>原型模式（Prototype）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F6.png" alt=""></p><blockquote><p>创建对象的种类，并通过拷贝这些原型创建新的对象。<br>餐厅经营得不错，一段时间后，老板开了一家分店，又招了一批服务员和厨师，但是老板还是一个。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 餐厅 <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> 老板 唯一的老板;</div><div class="line">    <span class="keyword">private</span> List&lt;服务员&gt; 服务员们;</div><div class="line">    <span class="keyword">private</span> List&lt;厨师&gt; 厨师们;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> set老板(老板 唯一的老板) &#123;</div><div class="line">        <span class="keyword">this</span>.唯一的老板 = 唯一的老板;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> 老板 get老板() &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.唯一的老板;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> 餐厅 clone() <span class="keyword">throws</span> CloneNotSupportedException &#123;</div><div class="line">        餐厅 分店 = (餐厅)<span class="keyword">super</span>.clone();</div><div class="line">        分店.set老板(唯一的老板);</div><div class="line">        <span class="keyword">return</span> 分店;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> String 花名册() &#123;</div><div class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder();</div><div class="line">        builder.append(<span class="string">"老板:"</span> + 唯一的老板)</div><div class="line">            .append(<span class="string">"服务员们:"</span> + 服务员们)</div><div class="line">            .append(<span class="string">"厨师们:"</span> + 厨师们);</div><div class="line">        <span class="keyword">return</span> builder.toString();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        总店.clone().员工花名册();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><hr><h1 id="结构型"><a href="#结构型" class="headerlink" title="结构型"></a><strong>结构型</strong></h1><h2 id="适配器模式（Adapter）"><a href="#适配器模式（Adapter）" class="headerlink" title="适配器模式（Adapter）"></a><strong>适配器模式（Adapter）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F7.png" alt=""></p><blockquote><p>将一个接口转换成客户希望的另一个接口，使接口不兼容的那些类可以一起工作。<br>老板在某聘上招人，因为某聘和某联合作，所以某聘直接使用某联的人才库。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 某聘招聘网站 <span class="keyword">implements</span> 招聘网站 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;员工&gt; 招聘() &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> 某联招聘网站().招聘();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> 某聘招聘网站().招聘();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="装饰模式（Decorator）"><a href="#装饰模式（Decorator）" class="headerlink" title="装饰模式（Decorator）"></a><strong>装饰模式（Decorator）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F8.png" alt=""></p><blockquote><p>在不必改变原类文件和使用继承的情况下，动态地扩展一个对象的功能。<br>当服务员请假时，厨师可以兼任服务员的工作。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 厨师 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 做菜();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> 可以兼任工作的厨师 <span class="keyword">implements</span> 厨师 </span>&#123;</div><div class="line">    <span class="keyword">private</span> 厨师 某个厨师;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> 可以兼任工作的厨师(厨师 某个厨师) &#123;</div><div class="line">        <span class="keyword">this</span>.某个厨师 = 某个厨师;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 做菜() &#123;</div><div class="line">        某个厨师.做菜();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> 额外工作();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 可以兼任服务员的厨师 <span class="keyword">extends</span> 可以兼任工作的厨师 </span>&#123;</div><div class="line">    <span class="keyword">public</span> 可以兼任服务员的厨师(厨师 某个厨师) &#123;</div><div class="line">        <span class="keyword">super</span>(某个厨师);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 额外工作() &#123;</div><div class="line">        System.out.println(<span class="string">"兼任服务员辅助点餐!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</div><div class="line">        可以兼任工作的厨师 厨师 = <span class="keyword">new</span> 可以兼任服务员的厨师(<span class="keyword">new</span> 某联人才库中的厨师());</div><div class="line">        厨师.做菜();</div><div class="line">        厨师.额外工作();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="代理模式（Proxy）"><a href="#代理模式（Proxy）" class="headerlink" title="代理模式（Proxy）"></a><strong>代理模式（Proxy）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F9.png" alt=""></p><blockquote><p>调用原有的方法，且对产生的结果进行控制。<br>由于洗菜工还未入职，所以厨师做菜前，需要先洗菜。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 厨师 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 做菜();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> 需要承担额外工作的厨师 <span class="keyword">implements</span> 厨师 </span>&#123;</div><div class="line">    <span class="keyword">private</span> 厨师 某个厨师;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> 需要承担额外工作的厨师(厨师 某个厨师) &#123;</div><div class="line">        <span class="keyword">this</span>.某个厨师 = 某个厨师;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 做菜() &#123;</div><div class="line">        额外工作();</div><div class="line">        某个厨师.做菜();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> 额外工作();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 需要洗菜的厨师 <span class="keyword">extends</span> 需要承担额外工作的厨师 </span>&#123;</div><div class="line">    <span class="keyword">public</span> 需要洗菜的厨师(厨师 某个厨师) &#123;</div><div class="line">        <span class="keyword">super</span>(某个厨师);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 额外工作() &#123;</div><div class="line">        System.out.println(<span class="string">"厨师洗菜!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> 需要洗菜的厨师(<span class="keyword">new</span> 某联人才库中的厨师()).做菜();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="组合模式（Composite）"><a href="#组合模式（Composite）" class="headerlink" title="组合模式（Composite）"></a><strong>组合模式（Composite）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F10.png" alt=""></p><blockquote><p>将对象组合成树形结构以表示“部分-整体”的层次结构。<br>建立管理层，且新店开业后归总店管理。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(Component component)</span></span>;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(Component component)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 客服部 <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> List&lt;Component&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Component component)</span> </span>&#123;</div><div class="line">        list.add(component);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Component component)</span> </span>&#123;</div><div class="line">        list.remove(component);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 技术部 <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> List&lt;Component&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Component component)</span> </span>&#123;</div><div class="line">        list.add(component);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Component component)</span> </span>&#123;</div><div class="line">        list.remove(component);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 餐厅 <span class="keyword">implements</span> <span class="title">Component</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> List&lt;Component&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(Component component)</span> </span>&#123;</div><div class="line">        list.add(component);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Component component)</span> </span>&#123;</div><div class="line">        list.remove(component);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</div><div class="line">        餐厅 总店 = 总店.getInstance();</div><div class="line">        总店.add(<span class="keyword">new</span> 客服部());</div><div class="line">        总店.add(<span class="keyword">new</span> 技术部());</div><div class="line">        </div><div class="line">        餐厅 分店 = <span class="keyword">new</span> 餐厅();</div><div class="line">        分店.add(<span class="keyword">new</span> 客服部());</div><div class="line">        分店.add(<span class="keyword">new</span> 技术部());</div><div class="line">        </div><div class="line">        总店.add(分店);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="桥接模式（Bridge）"><a href="#桥接模式（Bridge）" class="headerlink" title="桥接模式（Bridge）"></a><strong>桥接模式（Bridge）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F11.png" alt=""></p><blockquote><p>把事物和其具体实现分开，使他们可以各自独立的变化。<br>老板想开发点餐软件，分为服务端和客户端，分别交给总店和分店的技术部实现。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 点餐软件 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 开发软件();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 服务端软件 <span class="keyword">implements</span> 点餐软件 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 开发软件() &#123;</div><div class="line">        System.out.println(<span class="string">"开发服务端软件！"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 客户端软件 <span class="keyword">implements</span> 点餐软件 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 开发软件() &#123;</div><div class="line">        System.out.println(<span class="string">"开发客户端软件！"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> 点餐软件专项组 </span>&#123;</div><div class="line">    <span class="keyword">private</span> 点餐软件 软件;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> set软件(点餐软件 软件) &#123;</div><div class="line">        <span class="keyword">this</span>.软件 = 软件;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> get软件() &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.一个软件;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> 开始开发();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 总店的技术部 <span class="keyword">extends</span> 点餐软件专项组 </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 开始开发() &#123;</div><div class="line">        System.out.println(<span class="string">"总店开始安排人手！"</span>);</div><div class="line">        get软件().开发软件();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 分店的技术部 <span class="keyword">extends</span> 点餐软件专项组 </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 开始开发() &#123;</div><div class="line">        System.out.println(<span class="string">"分店开始安排人手！"</span>);</div><div class="line">        get软件().开发软件();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        点餐软件专项组 总店的专项组 = <span class="keyword">new</span> 总店的技术部();</div><div class="line">        总店的专项组.set软件(<span class="keyword">new</span> 服务端软件());</div><div class="line">        总店的专项组.开始开发();</div><div class="line">        </div><div class="line">        点餐软件专项组 分店的专项组 = <span class="keyword">new</span> 分店的技术部();</div><div class="line">        分店的专项组.set软件(<span class="keyword">new</span> 客户端软件());</div><div class="line">        分店的专项组.开始开发();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="外观模式（Facade）"><a href="#外观模式（Facade）" class="headerlink" title="外观模式（Facade）"></a><strong>外观模式（Facade）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F12.png" alt=""></p><blockquote><p>避免几个类之间相互持有实例，将这几个类的实例放到同一个类中。<br>餐厅来了一个大客户，老板让一个大客户经理招待客户。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 司机 </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 开车() &#123;</div><div class="line">        System.out.println(<span class="string">"司机开车！"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 厨师 </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 做饭() &#123;</div><div class="line">        System.out.println(<span class="string">"厨师做饭！"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 技师 </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 搓澡() &#123;</div><div class="line">        System.out.println(<span class="string">"技师搓澡！"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 大客户经理 </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 招待客户() &#123;</div><div class="line">        <span class="keyword">new</span> 司机().开车();</div><div class="line">        <span class="keyword">new</span> 厨师().做饭();</div><div class="line">        <span class="keyword">new</span> 技师().搓澡();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> 大客户经理().招待客户();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="享元模式（Flyweight）"><a href="#享元模式（Flyweight）" class="headerlink" title="享元模式（Flyweight）"></a><strong>享元模式（Flyweight）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F13.png" alt=""></p><blockquote><p>将大量的小的重复使用的对象统一管理起来，避免用户多次创建重复对象造成的资源浪费。<br>大客户又来了，老板会优先安排上次的大客户经理，但是如果上次的大客户经理正忙，就会重新安排大客户经理招待客户。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 客服部 </span>&#123;</div><div class="line">    <span class="keyword">private</span> Map&lt;String, 大客户经理&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> 大客户经理 get大客户经理(String 大客户ID) &#123;</div><div class="line">        大客户经理 指定大客户经理 = map.get(大客户ID);</div><div class="line">        <span class="keyword">if</span>(指定大客户经理不存在 || 指定大客户经理正忙) &#123;</div><div class="line">            指定大客户经理 = 重新安排大客户经理();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> 指定大客户经理;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> 客服部().get大客户经理(大客户ID).招待客户();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><hr><h1 id="行为型"><a href="#行为型" class="headerlink" title="行为型"></a><strong>行为型</strong></h1><h2 id="观察者模式（Observer）"><a href="#观察者模式（Observer）" class="headerlink" title="观察者模式（Observer）"></a><strong>观察者模式（Observer）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F14.png" alt=""></p><blockquote><p>当一个对象变化时，其它依赖该对象的对象都会收到通知，并且随着变化。<br>老板进行面试，面试结束后通知参与面试的人面试结果。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 面试者 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 参加面试();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 校招人员 <span class="keyword">implements</span> 面试者 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 参加面试() &#123;</div><div class="line">        System.out.println(<span class="string">"校招人员参加面试"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 社招人员 <span class="keyword">implements</span> 面试者 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 参加面试() &#123;</div><div class="line">        System.out.println(<span class="string">"社招人员参加面试"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 面试官 </span>&#123;</div><div class="line">    <span class="keyword">void</span> add面试者(面试者 一个面试者);</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> notify面试者(面试者 一个面试者);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 技术部面试官 <span class="title">Implememnts</span> 面试官 </span>&#123;</div><div class="line">    <span class="keyword">private</span> List&lt;面试者&gt; 所有面试者 = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> add面试者(面试者 一个面试者) &#123;</div><div class="line">        所有面试官.add(一个面试官);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> notify面试者(面试者 确定录用者) &#123;</div><div class="line">        <span class="keyword">for</span>(面试者 一个面试者 : 所有面试者) &#123;</div><div class="line">            <span class="keyword">if</span>(一个面试者.equals(确定录用者)) &#123;</div><div class="line">                System.out.println(<span class="string">"发Offer"</span>);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                System.out.println(<span class="string">"发未通过面试通知"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        面试官 一个面试官 = <span class="keyword">new</span> 技术部面试官();</div><div class="line">        </div><div class="line">        面试者 一个面试者 = <span class="keyword">new</span> 校招人员();</div><div class="line">        一个面试官.add(一个面试者);</div><div class="line">        一个面试官.add(<span class="keyword">new</span> 校招人员());</div><div class="line">        一个面试官.add(<span class="keyword">new</span> 校招人员());</div><div class="line">        一个面试官.add(<span class="keyword">new</span> 社招人员());</div><div class="line">        </div><div class="line">        一个面试官.notify面试者(一个面试者);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="访问者模式（Visitor）"><a href="#访问者模式（Visitor）" class="headerlink" title="访问者模式（Visitor）"></a><strong>访问者模式（Visitor）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F15.png" alt=""></p><blockquote><p>封装一些作用于某种数据结构中的各元素的操作，它可以在不改变这个数据结构的前提下定义作用于这些元素的新的操作。<br>客人排队就餐，叫到号后可以进店就餐。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 吃饭的地 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 有空位需带人(排队的人 客户);</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> 服务员安排就餐位置(排队的人 客户);</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> 制作食物(排队的人 客户);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 餐厅 <span class="title">implememnts</span> 吃饭的地 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 有空位需带人(排队的人 客户) &#123;</div><div class="line">        客户.展示排队的号(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 服务员安排就餐位置(排队的人 客户) &#123;</div><div class="line">        客户.点餐(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 制作食物(排队的人 客户) &#123;</div><div class="line">        System.out.println(<span class="string">"餐厅开始制作食物了"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 排队的人 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 展示排队的号(吃饭的地 餐厅);</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> 点餐(吃饭的地 餐厅);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 客户 <span class="title">implememnts</span> 排队的人 </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> 号码;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> 展示排队的号(吃饭的地 餐厅) &#123;</div><div class="line">        餐厅.服务员安排就餐位置(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> 点餐(吃饭的地 餐厅) &#123;</div><div class="line">        餐厅.制作食物(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 服务员 </span>&#123;</div><div class="line">    <span class="keyword">private</span> List&lt;排队的人&gt; 列表 = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> 吃饭的地 餐厅;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> 服务员(吃饭的地 餐厅) &#123;</div><div class="line">        <span class="keyword">this</span>.餐厅 = 餐厅;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> add客户(排队的人 客户) &#123;</div><div class="line">        列表.add客户(客户);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 开始叫号() &#123;</div><div class="line">        <span class="keyword">for</span>(排队的人 客户 : 列表) &#123;</div><div class="line">            餐厅.有空位需带人(客户);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        服务员 一个服务员 = <span class="keyword">new</span> 服务员(<span class="keyword">new</span> 餐厅());</div><div class="line">        一个服务员.添加排队的人(<span class="keyword">new</span> 客户());</div><div class="line">        一个服务员.添加排队的人(<span class="keyword">new</span> 客户());</div><div class="line">        一个服务员.添加排队的人(<span class="keyword">new</span> 客户());</div><div class="line">        </div><div class="line">        一个服务员.开始叫号();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="迭代器模式（Iterator）"><a href="#迭代器模式（Iterator）" class="headerlink" title="迭代器模式（Iterator）"></a><strong>迭代器模式（Iterator）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F16.png" alt=""></p><blockquote><p>老板助理按照员工花名册依次叫员工去老板办公室领工资。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 辅助老板发工资的人 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 看还有没有人没领工资();</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> 叫员工去领工资();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 老板助理 <span class="keyword">implements</span> 辅助老板发工资的人 </span>&#123;</div><div class="line">    <span class="keyword">private</span> List&lt;String&gt; 员工花名册 = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> 当前叫过的人的数量 = <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> 老板助理(花名册 员工花名册) &#123;</div><div class="line">        <span class="keyword">this</span>.员工花名册 = 员工花名册;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 看还有没有人没领工资() &#123;</div><div class="line">        <span class="keyword">return</span> 当前叫过的人的数量 &lt; 员工花名册上的人数;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 叫员工去领工资() &#123;</div><div class="line">        System.out.println(<span class="string">"叫员工去领工资!"</span>);</div><div class="line">        当前叫过的人的数量++;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        辅助老板发工资的人 老板助理 = <span class="keyword">new</span> 老板助理(员工花名册);</div><div class="line">        <span class="keyword">while</span>(老板助理.看还有没有人没领工资()) &#123;</div><div class="line">            老板助理.叫员工去领工资();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="模板方法模式（TemplateMethod）"><a href="#模板方法模式（TemplateMethod）" class="headerlink" title="模板方法模式（TemplateMethod）"></a><strong>模板方法模式（TemplateMethod）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F17.png" alt=""></p><blockquote><p>开发软件前先确定架构。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> 项目 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 开始开发() &#123;</div><div class="line">        确定架构();</div><div class="line">        System.out.println(<span class="string">"开始开发"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> 确定架构();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 点餐软件 <span class="keyword">extends</span> 项目 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 确定架构() &#123;</div><div class="line">        System.out.println(<span class="string">"确定架构"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> 点餐软件().开始开发();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="中介者模式（Mediator）"><a href="#中介者模式（Mediator）" class="headerlink" title="中介者模式（Mediator）"></a><strong>中介者模式（Mediator）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F18.png" alt=""></p><blockquote><p>餐厅上线了外卖业务，订餐人向餐厅要一杯咖啡，餐厅委托骑手送咖啡。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 平台 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 转发消息();</div><div class="line">    </div><div class="line">    <span class="keyword">void</span> set送餐者();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 外卖业务 <span class="keyword">implements</span> 平台 </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> 客户端 订餐者;</div><div class="line">    <span class="keyword">private</span> 客户端 送餐者;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> 订单(客户端 订餐者) &#123;</div><div class="line">        <span class="keyword">this</span>.订餐者 = 订餐者;</div><div class="line">        订餐者.set订单(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> set送餐者(客户端 送餐者) &#123;</div><div class="line">        <span class="keyword">this</span>.送餐者 = 送餐者;</div><div class="line">        送餐者.set订单(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 转发消息(String 消息, 客户端 用户) &#123;</div><div class="line">        <span class="keyword">if</span>(订餐者.equals(用户)) &#123;</div><div class="line">            送餐者.接收消息(消息);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            订餐者.接收消息(消息);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 客户端 </span>&#123;</div><div class="line">    <span class="keyword">private</span> 平台 外卖平台;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> set平台(平台 外卖平台) &#123;</div><div class="line">        <span class="keyword">this</span>.外卖平台 = 外卖平台;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 发送消息(String 消息) &#123;</div><div class="line">        外卖平台.转发消息(消息, <span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 接收消息(String 消息) &#123;</div><div class="line">        System.out.println(<span class="string">"接收消息:"</span> + 消息);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        客户端 订餐者 = <span class="keyword">new</span> 客户端();</div><div class="line">        客户端 送餐者 = <span class="keyword">new</span> 客户端();</div><div class="line"></div><div class="line">        平台 外卖平台 = <span class="keyword">new</span> 外卖业务(订餐者);</div><div class="line">        外卖平台.set送餐者(送餐者);</div><div class="line">        </div><div class="line">        订餐者.发送消息(<span class="string">"我要一杯咖啡"</span>);</div><div class="line">        送餐者.发送消息(<span class="string">"已取，马上为您送到"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="备忘录模式（Memento）"><a href="#备忘录模式（Memento）" class="headerlink" title="备忘录模式（Memento）"></a><strong>备忘录模式（Memento）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F19.png" alt=""></p><blockquote><p>主要目的是保存一个对象的某个状态，以便在适当的时候恢复对象。<br>老板规定分店每月保留10万用于平时开销，盈利部分划归总店，亏损部分总店补齐。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 餐厅 </span>&#123;</div><div class="line">    <span class="keyword">private</span> 账上资金 资金;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> 分店每月分配额度 额度;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> 餐厅(<span class="keyword">long</span> 初始金额) &#123;</div><div class="line">        账上资金 = <span class="keyword">new</span> 账上资金(初始金额);</div><div class="line">        额度 = <span class="keyword">new</span> 分店每月分配额度(账上资金);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> <span class="keyword">void</span> 买菜(<span class="keyword">long</span> 金额) &#123;</div><div class="line">        资金 -= 金额;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> <span class="keyword">void</span> 卖菜(<span class="keyword">long</span> 金额) &#123;</div><div class="line">        资金 += 金额;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> <span class="keyword">void</span> 月末结算() &#123;</div><div class="line">        System.out.println(<span class="string">"当月收支："</span> + (资金.get资金() - 额度.get额度()));</div><div class="line">        账上资金 = 额度.get额度();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">long</span> get资金() &#123;</div><div class="line">        <span class="keyword">return</span> 资金.get资金();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 账上资金 </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">long</span> 资金;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> 账上资金(<span class="keyword">long</span> 资金) &#123;</div><div class="line">        <span class="keyword">this</span>.资金 = 资金;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 花钱(<span class="keyword">long</span> 金额) &#123;</div><div class="line">        <span class="keyword">this</span>.资金 -= 金额;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 赚钱(<span class="keyword">long</span> 金额) &#123;</div><div class="line">        <span class="keyword">this</span>.资金 += 金额;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">long</span> get资金() &#123;</div><div class="line">        <span class="keyword">return</span> 资金;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 分店每月分配额度 </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">long</span> 额度;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> 分店每月分配额度(账上资金 资金) &#123;</div><div class="line">        <span class="keyword">this</span>.额度 = 资金.get资金();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">long</span> get额度() &#123;</div><div class="line">        <span class="keyword">return</span> 额度;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        餐厅 分店 = <span class="keyword">new</span> 餐厅(<span class="number">100000</span>);</div><div class="line">        </div><div class="line">        分店.买菜(<span class="number">1000</span>);</div><div class="line">        分店.卖菜(<span class="number">1500</span>);</div><div class="line">        分店.get资金();</div><div class="line">        </div><div class="line">        分店.月末结算();</div><div class="line">        分店.get资金();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="状态模式（State）"><a href="#状态模式（State）" class="headerlink" title="状态模式（State）"></a><strong>状态模式（State）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F20.png" alt=""></p><blockquote><p>可以通过改变状态来获得不同的行为。<br>建立员工审批制度，员工先向直属上级发起审批请求，待审批通过后，再向店长发起审批请求。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 审批 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 决定是否通过审批(审批表 一个审批表);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 审批表 </span>&#123;</div><div class="line">    <span class="keyword">private</span> 审批 审批流程 = <span class="keyword">new</span> 部门经理审批();</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 走审批流程() &#123;</div><div class="line">        审批流程.决定是否通过审批(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 转到上级审批(审批 上级审批) &#123;</div><div class="line">        审批流程 = 上级审批;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> 审批 get审批() &#123;</div><div class="line">        <span class="keyword">return</span> 审批流程;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 部门经理审批 <span class="keyword">implements</span> 审批 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 决定是否通过审批(审批表 一个审批表) &#123;</div><div class="line">        System.out.println(<span class="string">"部门经理通过审批"</span>);</div><div class="line">        一个审批表.转到上级审批(<span class="keyword">new</span> 店长审批());</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 店长审批 <span class="keyword">implements</span> 审批 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 决定是否通过审批(审批表 一个审批表) &#123;</div><div class="line">        System.out.println(<span class="string">"店长通过审批"</span>);</div><div class="line">        一个审批表.转到上级审批(<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        审批表 一个审批表 = <span class="keyword">new</span> 审批表();</div><div class="line">        <span class="keyword">while</span>(一个审批表.get审批() != <span class="keyword">null</span>) &#123;</div><div class="line">            一个审批表.走审批流程();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="策略模式（Strategy）"><a href="#策略模式（Strategy）" class="headerlink" title="策略模式（Strategy）"></a><strong>策略模式（Strategy）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F21.png" alt=""></p><blockquote><p>定义一系列算法，并将每个算法封装起来，使他们可以相互替换，且算法的变化不会影响到使用算法的客户。<br>新店开业大酬宾，店长推出各种优惠活动：满200减50、老客户全单打9折、新客户全单打8折，优惠不能同时享。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 优惠活动 </span>&#123;</div><div class="line">    <span class="keyword">float</span> get帐单金额();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 账单 </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> 原价;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> 优惠活动 一个优惠活动;</div><div class="line">    </div><div class="line">    <span class="keyword">private</span> 账单(<span class="keyword">float</span> 原价) &#123;</div><div class="line">        <span class="keyword">this</span>.原价 = 原价;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> set优惠活动(优惠活动 一个优惠活动) &#123;</div><div class="line">        <span class="keyword">this</span>.一个优惠活动 = 一个优惠活动;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">public</span> <span class="keyword">float</span> get帐单金额() &#123;</div><div class="line">        <span class="keyword">if</span>(一个优惠活动 == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> 原价;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> 一个优惠活动.get帐单金额();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> 满200减50 <span class="keyword">implements</span> 优惠活动 </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> 原价;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> 满<span class="number">200</span>减<span class="number">50</span>(<span class="keyword">float</span> 原价) &#123;</div><div class="line">        <span class="keyword">this</span>.原价 = 原价;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">float</span> get帐单金额() &#123;</div><div class="line">        <span class="keyword">return</span> 原价 &gt;= <span class="number">200</span> ? 原价 - <span class="number">50</span> : 原价;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> 老客户全单打9折 <span class="keyword">implements</span> 优惠活动 </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> 原价;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> 老客户全单打<span class="number">9</span>折(<span class="keyword">float</span> 原价) &#123;</div><div class="line">        <span class="keyword">this</span>.原价 = 原价;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">float</span> get帐单金额() &#123;</div><div class="line">        <span class="keyword">return</span> 原价 * <span class="number">0.9f</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> 新客户全单打8折 <span class="keyword">implements</span> 优惠活动 </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> 原价;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> 新客户全单打<span class="number">8</span>折(<span class="keyword">float</span> 原价) &#123;</div><div class="line">        <span class="keyword">this</span>.原价 = 原价;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">float</span> get帐单金额() &#123;</div><div class="line">        <span class="keyword">return</span> 原价 * <span class="number">0.8f</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        账单 一个账单 = <span class="keyword">new</span> 账单(<span class="number">100</span>);</div><div class="line">        <span class="keyword">float</span> 不参加优惠活动的金额 = 一个账单.get帐单金额();</div><div class="line">        <span class="keyword">float</span> 参加满<span class="number">200</span>减<span class="number">50</span>的金额 = 一个账单.get帐单金额(一个账单.set优惠活动(<span class="keyword">new</span> 满<span class="number">200</span>减<span class="number">50</span>(<span class="number">100</span>)));</div><div class="line">        <span class="keyword">float</span> 参加老客户全单打<span class="number">9</span>折的金额 = 一个账单.get帐单金额(一个账单.set优惠活动(<span class="keyword">new</span> 老客户全单打<span class="number">9</span>折(<span class="number">100</span>)));</div><div class="line">        <span class="keyword">float</span> 参加新客户全单打<span class="number">8</span>折的金额 = 一个账单.get帐单金额(一个账单.set优惠活动(<span class="keyword">new</span> 新客户全单打<span class="number">8</span>折(<span class="number">100</span>)));</div><div class="line">        <span class="keyword">float</span> 最优惠金额 = sort(不参加优惠活动的金额, 参加老客户全单打<span class="number">9</span>折的金额, 参加老客户全单打<span class="number">9</span>折的金额, 参加新客户全单打<span class="number">8</span>折的金额);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="职责链模式（ChainOfResponsibility）"><a href="#职责链模式（ChainOfResponsibility）" class="headerlink" title="职责链模式（ChainOfResponsibility）"></a><strong>职责链模式（ChainOfResponsibility）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F22.png" alt=""></p><blockquote><p>将接受请求的对象连成一条线链并且沿着这条链传递请求，直到有一个对象能够处理它为止。<br>有记者来采访，找到了保安，保安知道自己不能接受采访，把记者带给保安队长，保安队长也知道自己不能接受采访，把记者带给店长。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> 餐厅职员 </span>&#123;</div><div class="line"><span class="keyword">protected</span> 餐厅职员 上级管理者;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> set上级管理者(餐厅职员 一个餐厅职员) &#123;</div><div class="line"><span class="keyword">this</span>.上级管理者 = 一个管理者;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">void</span> get上级管理者() &#123;</div><div class="line">    <span class="keyword">return</span> 上级管理者;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> 接受采访();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 保安 <span class="keyword">extends</span> 餐厅职员 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 接受采访() &#123;</div><div class="line">        <span class="keyword">if</span> (保安有接受采访权限) &#123;</div><div class="line">            System.out.println(<span class="string">"保安接受采访！"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (有上级管理者) &#123;</div><div class="line">            get上级管理者().接受采访();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 保安队长 <span class="keyword">extends</span> 餐厅职员 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 接受采访() &#123;</div><div class="line">        <span class="keyword">if</span> (保安队长有接受采访权限) &#123;</div><div class="line">            System.out.println(<span class="string">"保安队长接受采访！"</span>);</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (有上级管理者) &#123;</div><div class="line">            get上级管理者().接受采访();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 店长 <span class="keyword">extends</span> 餐厅职员 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 接受采访() &#123;</div><div class="line">        System.out.println(<span class="string">"店长接受采访！"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        餐厅职员 一个保安 = <span class="keyword">new</span> 保安();</div><div class="line">        餐厅职员 一个保安队长 = <span class="keyword">new</span> 保安队长();</div><div class="line">        餐厅职员 一个店长 = <span class="keyword">new</span> 店长();</div><div class="line">        </div><div class="line">        一个保安.set上级管理者(一个保安队长);</div><div class="line">        一个保安队长.set上级管理者(一个店长);</div><div class="line">        </div><div class="line">        一个保安.接受采访();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="命令模式（Command）"><a href="#命令模式（Command）" class="headerlink" title="命令模式（Command）"></a><strong>命令模式（Command）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F23.png" alt=""></p><blockquote><p>命令模式的目的就是达到命令的发出者和执行者之间解耦，实现请求和执行分开。<strong>与责任链模式不同的是执行者是确定的，中途命令不能被处理，只能被传递。</strong><br>又有记者来了，保安想起来上次是店长接受的采访，所以就知道了只要有记者来采访，就直接找店长。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 预案 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 有记者来访();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 公关预案 <span class="keyword">implements</span> 预案 </span>&#123;</div><div class="line">    <span class="keyword">private</span> 店长 一个店长;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> 公关部(店长 一个店长) &#123;</div><div class="line">        <span class="keyword">this</span>.一个店长 = 一个店长;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 有记者来访() &#123;</div><div class="line">        一个店长.接受采访();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 店长 </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 接受采访() &#123;</div><div class="line">        System.out.println(<span class="string">"店长接受采访!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 保安 </span>&#123;</div><div class="line">    <span class="keyword">private</span> 公关预案 一个公关预案;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> 保安(公关预案 一个公关预案) &#123;</div><div class="line">        <span class="keyword">this</span>.一个公关预案 = 一个公关预案;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 发现记者来了() &#123;</div><div class="line">        一个公关预案.有记者来访();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        店长 一个店长 = <span class="keyword">new</span> 店长();</div><div class="line">        公关预案 一个公关预案 = <span class="keyword">new</span> 公关预案(一个店长);</div><div class="line">        保安 一个保安 = <span class="keyword">new</span> 保安(一个公关预案);</div><div class="line">        一个保安.发现记者来了();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><h2 id="解释器模式（Interpreter）"><a href="#解释器模式（Interpreter）" class="headerlink" title="解释器模式（Interpreter）"></a><strong>解释器模式（Interpreter）</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F24.png" alt=""></p><blockquote><p>在系统中如果某一特定类型的问题在频繁的发生，此时我们就有必要将这些问题的实例表述为一个语言中句子，因此可以构建一个解释器，然后利用该解释器来解释这些句子来解决这些问题。<br>两个记者分别来自不同的报社，一个是经济报社的，一个是美食报社的，虽然店长接受采访时和他们说了相同的内容，但是两个记者分别从两个角度完成了采访后稿件。</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> 采访的人 </span>&#123;</div><div class="line">    <span class="keyword">void</span> 写采访后的稿件(采访的内容 一次采访的内容);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 经济报社记者 <span class="keyword">implements</span> 采访的人 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 写采访后的稿件(采访的内容 一次采访的内容) &#123;</div><div class="line">        System.out.println(<span class="string">"从经济角度写采访后的稿件!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> 美食报社记者 <span class="keyword">implements</span> 采访的人 </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">void</span> 写采访后的稿件(采访的内容 一次采访的内容) &#123;</div><div class="line">        System.out.println(<span class="string">"从美食角度写采访后的稿件!"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><ul><li>测试<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InterpreterTest</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> 美食报社记者().写采访后的稿件(店长接受采访时说的话);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></li></ul><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://ww
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>TensorFlow 张量排序</title>
    <link href="http://www.weichao.io/2019/05/28/TensorFlow-%E5%BC%A0%E9%87%8F%E6%8E%92%E5%BA%8F/"/>
    <id>http://www.weichao.io/2019/05/28/TensorFlow-张量排序/</id>
    <published>2019-05-28T01:45:13.000Z</published>
    <updated>2019-05-29T01:46:00.535Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" title="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" target="_blank" rel="external">深度学习与 TensorFlow 2 入门实战</a></li><li><a href="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" title="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" target="_blank" rel="external">TensorFlow-2.x-Tutorials</a></li></ul><hr><h1 id="sort、argsort"><a href="#sort、argsort" class="headerlink" title="sort、argsort"></a><strong>sort、argsort</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">10</span>)</div><div class="line">arr1 = tf.random.shuffle(arr)</div><div class="line">arr21 = tf.sort(arr1, direction=<span class="string">'DESCENDING'</span>)</div><div class="line">arr22 = tf.argsort(arr1, direction=<span class="string">'DESCENDING'</span>)</div><div class="line">arr31 = tf.sort(arr1, direction=<span class="string">'ASCENDING'</span>)</div><div class="line">arr32 = tf.argsort(arr1, direction=<span class="string">'ASCENDING'</span>)</div><div class="line">print(arr1) <span class="comment"># tf.Tensor([8 5 3 2 4 0 7 1 9 6], shape=(10,), dtype=int32)</span></div><div class="line">print(arr21) <span class="comment"># tf.Tensor([9 8 7 6 5 4 3 2 1 0], shape=(10,), dtype=int32)</span></div><div class="line">print(arr22) <span class="comment"># tf.Tensor([8 0 6 9 1 4 2 3 7 5], shape=(10,), dtype=int32)</span></div><div class="line">print(arr31) <span class="comment"># tf.Tensor([0 1 2 3 4 5 6 7 8 9], shape=(10,), dtype=int32)</span></div><div class="line">print(arr32) <span class="comment"># tf.Tensor([5 7 3 2 4 1 9 6 0 8], shape=(10,), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="top-k"><a href="#top-k" class="headerlink" title="top_k"></a><strong>top_k</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">10</span>)</div><div class="line">arr1 = tf.random.shuffle(arr)</div><div class="line">res = tf.math.top_k(arr1, <span class="number">2</span>)</div><div class="line">print(arr1) <span class="comment"># tf.Tensor([8 7 3 2 9 5 0 6 4 1], shape=(10,), dtype=int32)</span></div><div class="line">print(res.values) <span class="comment"># tf.Tensor([9 8], shape=(2,), dtype=int32)</span></div><div class="line">print(res.indices) <span class="comment"># tf.Tensor([4 0], shape=(2,), dtype=int32)</span></div></pre></td></tr></table></figure><h2 id="计算-top-k-概率"><a href="#计算-top-k-概率" class="headerlink" title="计算 top_k 概率"></a><strong>计算 top_k 概率</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">accuracy</span><span class="params">(output, target, topk=<span class="params">(<span class="number">1</span>,)</span>)</span>:</span></div><div class="line">    maxk = max(topk)</div><div class="line">    batch_size = target.shape[<span class="number">0</span>]</div><div class="line"></div><div class="line">    pred = tf.math.top_k(output, maxk).indices</div><div class="line">    print(pred) <span class="comment"># tf.Tensor(</span></div><div class="line">                <span class="comment"># [[1 0 2]</span></div><div class="line">                <span class="comment">#  [0 1 2]</span></div><div class="line">                <span class="comment">#  [1 0 2]</span></div><div class="line">                <span class="comment">#  [1 0 2]], shape=(4, 3), dtype=int32)</span></div><div class="line"></div><div class="line">    <span class="comment"># 转置</span></div><div class="line">    pred = tf.transpose(pred, perm=[<span class="number">1</span>, <span class="number">0</span>])</div><div class="line">    print(pred) <span class="comment"># tf.Tensor(</span></div><div class="line">                <span class="comment"># [[1 0 1 1]</span></div><div class="line">                <span class="comment">#  [0 1 0 0]</span></div><div class="line">                <span class="comment">#  [2 2 2 2]], shape=(3, 4), dtype=int32)</span></div><div class="line"></div><div class="line">    target_ = tf.broadcast_to(target, pred.shape)</div><div class="line">    print(target_) <span class="comment"># tf.Tensor(</span></div><div class="line">                   <span class="comment"># [[0 1 0 2]</span></div><div class="line">                   <span class="comment">#  [0 1 0 2]</span></div><div class="line">                   <span class="comment">#  [0 1 0 2]], shape=(3, 4), dtype=int32)</span></div><div class="line">    correct = tf.equal(pred, target_)</div><div class="line">    print(correct) <span class="comment"># tf.Tensor(</span></div><div class="line">                   <span class="comment"># [[False False False False]</span></div><div class="line">                   <span class="comment">#  [ True  True  True False]</span></div><div class="line">                   <span class="comment">#  [False False False  True]], shape=(3, 4), dtype=bool)</span></div><div class="line"></div><div class="line">    res = []</div><div class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> topk:</div><div class="line">        correct_k = tf.cast(tf.reshape(correct[:k], [<span class="number">-1</span>]), dtype=tf.float32)</div><div class="line">        correct_k = tf.reduce_sum(correct_k)</div><div class="line">        acc = float(correct_k * (<span class="number">100.0</span> / batch_size))</div><div class="line">        res.append(acc)</div><div class="line"></div><div class="line">    <span class="keyword">return</span> res</div><div class="line"></div><div class="line"></div><div class="line">output = tf.random.normal([<span class="number">4</span>, <span class="number">3</span>])</div><div class="line">output = tf.math.softmax(output, axis=<span class="number">1</span>)</div><div class="line">print(<span class="string">'output:'</span>, output.numpy()) <span class="comment"># output: [[0.16469155 0.7675324  0.06777601]</span></div><div class="line">                                 <span class="comment">#  [0.50406045 0.31256208 0.18337746]</span></div><div class="line">                                 <span class="comment">#  [0.24097656 0.5227547  0.23626871]</span></div><div class="line">                                 <span class="comment">#  [0.2440812  0.5844257  0.17149314]]</span></div><div class="line">target = tf.random.uniform([<span class="number">4</span>], maxval=<span class="number">3</span>, dtype=tf.int32)</div><div class="line">print(<span class="string">'target:'</span>, target.numpy()) <span class="comment"># target: [0 1 0 2]</span></div><div class="line">acc = accuracy(output, target, topk=(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</div><div class="line">print(<span class="string">'top1-6 acc:'</span>, acc) <span class="comment"># top1-6 acc: [0.0, 75.0, 100.0]</span></div></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://st
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>TensorFlow 数据统计</title>
    <link href="http://www.weichao.io/2019/05/22/TensorFlow-%E6%95%B0%E6%8D%AE%E7%BB%9F%E8%AE%A1/"/>
    <id>http://www.weichao.io/2019/05/22/TensorFlow-数据统计/</id>
    <published>2019-05-22T01:43:45.000Z</published>
    <updated>2019-05-29T01:44:32.673Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" title="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" target="_blank" rel="external">深度学习与 TensorFlow 2 入门实战</a></li><li><a href="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" title="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" target="_blank" rel="external">TensorFlow-2.x-Tutorials</a></li></ul><hr><h1 id="norm"><a href="#norm" class="headerlink" title="norm"></a><strong>norm</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">-2</span>, <span class="number">4</span>)</div><div class="line">t = tf.cast(tf.reshape(arr, [<span class="number">2</span>, <span class="number">-1</span>]), tf.float32)</div><div class="line"></div><div class="line"><span class="comment"># = square root(|-2|^2+|-1|^2+|0|^2+|1|^2+|2|^2+|3|^2) = sqrt(19) = 4.358899</span></div><div class="line">t10 = tf.sqrt(tf.reduce_sum(tf.square(t)))</div><div class="line">t11 = tf.norm(t)</div><div class="line">t12 = tf.norm(t, ord=<span class="number">2</span>)</div><div class="line"></div><div class="line"><span class="comment"># = |-2|+|-1|+|0|+|1|+|2|+|3| = 9</span></div><div class="line">t21 = tf.norm(t, ord=<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="comment"># = cubic root(|-2|^3+|-1|^3+|0|^3+|1|^3+|2|^3+|3|^3) = curt(45) = 3.5568933</span></div><div class="line">t22 = tf.norm(t, ord=<span class="number">3</span>)</div><div class="line"></div><div class="line"><span class="comment"># = [square root(|-2|^2+|1|^2), square root(|-1|^2+|2|^2), square root(|0|^2+|3|^2)] = [sqrt(5), sqrt(5), sqrt(9)] = [2.236068, 2.236068, 3]</span></div><div class="line">t31 = tf.norm(t, axis=<span class="number">0</span>)</div><div class="line"></div><div class="line"><span class="comment"># = [square root(|-2|^2+|-1|^2+|0|^2), square root(|1|^2+|2|^2+|3|^2)] = [sqrt(5), sqrt(14)] = [2.236068, 3.7416575]</span></div><div class="line">t32 = tf.norm(t, axis=<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="comment"># = [|-2|+|1|, |-1|+|2|, |0|+|3|] = [3, 3, 3]</span></div><div class="line">t41 = tf.norm(t, ord=<span class="number">1</span>, axis=<span class="number">0</span>)</div><div class="line"></div><div class="line"><span class="comment"># = [cubic root(|-2|^3+|1|^3), cubic root(|-1|^3+|2|^3), cubic root(|0|^3+|3|^3)] = [curt(9), curt(9), curt(27)] = [2.080084, 2.080084, 3]</span></div><div class="line">t42 = tf.norm(t, ord=<span class="number">3</span>, axis=<span class="number">0</span>)</div><div class="line"></div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[-2. -1.  0.]</span></div><div class="line">         <span class="comment">#  [ 1.  2.  3.]], shape=(2, 3), dtype=float32)</span></div><div class="line">print(t10) <span class="comment"># tf.Tensor(4.358899, shape=(), dtype=float32)</span></div><div class="line">print(t11) <span class="comment"># tf.Tensor(4.358899, shape=(), dtype=float32)</span></div><div class="line">print(t12) <span class="comment"># tf.Tensor(4.358899, shape=(), dtype=float32)</span></div><div class="line">print(t21) <span class="comment"># tf.Tensor(9.0, shape=(), dtype=float32)</span></div><div class="line">print(t22) <span class="comment"># tf.Tensor(3.5568933, shape=(), dtype=float32)</span></div><div class="line">print(t31) <span class="comment"># tf.Tensor([2.236068 2.236068 3.      ], shape=(3,), dtype=float32)</span></div><div class="line">print(t32) <span class="comment"># tf.Tensor([2.236068  3.7416575], shape=(2,), dtype=float32)</span></div><div class="line">print(t41) <span class="comment"># tf.Tensor([3. 3. 3.], shape=(3,), dtype=float32)</span></div><div class="line">print(t42) <span class="comment"># tf.Tensor([2.080084 2.080084 3.      ], shape=(3,), dtype=float32)</span></div></pre></td></tr></table></figure><hr><h1 id="reduce-min、reduce-max、reduce-mean、argmin、argmax、argmax"><a href="#reduce-min、reduce-max、reduce-mean、argmin、argmax、argmax" class="headerlink" title="reduce_min、reduce_max、reduce_mean、argmin、argmax、argmax"></a><strong>reduce_min、reduce_max、reduce_mean、argmin、argmax、argmax</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">arr0 = tf.range(<span class="number">12</span>)</div><div class="line">arr1 = tf.random.shuffle(arr0)</div><div class="line">arr = tf.reshape(arr1, [<span class="number">3</span>, <span class="number">4</span>])</div><div class="line">t11 = tf.reduce_min(arr)</div><div class="line">t12 = tf.reduce_min(arr, axis=<span class="number">1</span>)</div><div class="line">t21 = tf.reduce_max(arr)</div><div class="line">t22 = tf.reduce_max(arr, axis=<span class="number">1</span>)</div><div class="line">t31 = tf.reduce_mean(arr)</div><div class="line">t32 = tf.reduce_mean(arr, axis=<span class="number">1</span>)</div><div class="line">print(arr) <span class="comment"># tf.Tensor(</span></div><div class="line">           <span class="comment"># [[ 1  8  0  4]</span></div><div class="line">           <span class="comment">#  [10 11  2  9]</span></div><div class="line">           <span class="comment">#  [ 6  7  5  3]], shape=(3, 4), dtype=int32)</span></div><div class="line">print(tf.argmin(arr)) <span class="comment"># tf.Tensor([0 2 0 2], shape=(4,), dtype=int64)</span></div><div class="line">print(tf.argmax(arr)) <span class="comment"># tf.Tensor([1 1 2 1], shape=(4,), dtype=int64)</span></div><div class="line">print(tf.argmax(arr)) <span class="comment"># tf.Tensor([1 1 2 1], shape=(4,), dtype=int64)</span></div><div class="line">print(t11) <span class="comment"># tf.Tensor(0, shape=(), dtype=int32)</span></div><div class="line">print(t12) <span class="comment"># tf.Tensor([0 2 3], shape=(3,), dtype=int32)</span></div><div class="line">print(tf.argmin(arr, axis=<span class="number">1</span>)) <span class="comment"># tf.Tensor([2 2 3], shape=(3,), dtype=int64)</span></div><div class="line">print(t21) <span class="comment"># tf.Tensor(11, shape=(), dtype=int32)</span></div><div class="line">print(t22) <span class="comment"># tf.Tensor([ 8 11  7], shape=(3,), dtype=int32)</span></div><div class="line">print(tf.argmax(arr, axis=<span class="number">1</span>)) <span class="comment"># tf.Tensor([1 1 1], shape=(3,), dtype=int64)</span></div><div class="line">print(t31) <span class="comment"># tf.Tensor(5, shape=(), dtype=int32)</span></div><div class="line">print(t32) <span class="comment"># tf.Tensor([3 8 5], shape=(3,), dtype=int32)</span></div><div class="line">print(tf.argmax(arr, axis=<span class="number">1</span>)) <span class="comment"># tf.Tensor([1 1 1], shape=(3,), dtype=int64)</span></div></pre></td></tr></table></figure><hr><h1 id="equal"><a href="#equal" class="headerlink" title="equal"></a><strong>equal</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">arr11 = tf.random.uniform([<span class="number">1</span>, <span class="number">10</span>], dtype=tf.int32, maxval=<span class="number">4</span>)</div><div class="line">arr1 = tf.squeeze(arr11)</div><div class="line">arr21 = tf.random.uniform([<span class="number">1</span>, <span class="number">10</span>], dtype=tf.int32, maxval=<span class="number">4</span>)</div><div class="line">arr2 = tf.squeeze(arr21)</div><div class="line">t = tf.equal(arr1, arr2)</div><div class="line">t1 = tf.reduce_sum(tf.cast(t, dtype=tf.int32))</div><div class="line">print(arr1) <span class="comment"># tf.Tensor([1 0 2 3 3 1 1 1 0 1], shape=(10,), dtype=int32)</span></div><div class="line">print(arr2) <span class="comment"># tf.Tensor([3 0 2 2 1 3 1 2 1 2], shape=(10,), dtype=int32)</span></div><div class="line">print(t) <span class="comment"># tf.Tensor([False  True  True False False False  True False False False], shape=(10,), dtype=bool)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor(3, shape=(), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="unique"><a href="#unique" class="headerlink" title="unique"></a><strong>unique</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">arr0 = tf.random.uniform([<span class="number">1</span>, <span class="number">10</span>], dtype=tf.int32, maxval=<span class="number">8</span>)</div><div class="line">arr = tf.squeeze(arr0)</div><div class="line">y, idx = tf.unique(arr)</div><div class="line">arr1 = tf.gather(y, idx)</div><div class="line">print(arr) <span class="comment"># tf.Tensor([0 1 2 3 3 1 3 7 5 7], shape=(10,), dtype=int32)</span></div><div class="line">print(y) <span class="comment"># tf.Tensor([0 1 2 3 7 5], shape=(6,), dtype=int32)</span></div><div class="line">print(idx) <span class="comment"># tf.Tensor([0 1 2 3 3 1 3 4 5 4], shape=(10,), dtype=int32)</span></div><div class="line">print(arr1) <span class="comment"># tf.Tensor([0 1 2 3 3 1 3 7 5 7], shape=(10,), dtype=int32)</span></div></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://st
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>TensorFlow 合并与分割</title>
    <link href="http://www.weichao.io/2019/05/21/TensorFlow-%E5%90%88%E5%B9%B6%E4%B8%8E%E5%88%86%E5%89%B2/"/>
    <id>http://www.weichao.io/2019/05/21/TensorFlow-合并与分割/</id>
    <published>2019-05-21T09:00:12.000Z</published>
    <updated>2019-05-21T09:00:52.803Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" title="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" target="_blank" rel="external">深度学习与 TensorFlow 2 入门实战</a></li><li><a href="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" title="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" target="_blank" rel="external">TensorFlow-2.x-Tutorials</a></li></ul><hr><h1 id="concat"><a href="#concat" class="headerlink" title="concat"></a><strong>concat</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">a = tf.range(<span class="number">12</span>)</div><div class="line">b = tf.range(<span class="number">12</span>, <span class="number">36</span>)</div><div class="line">a1 = tf.reshape(a, [<span class="number">2</span>, <span class="number">6</span>])</div><div class="line">b1 = tf.reshape(b, [<span class="number">4</span>, <span class="number">6</span>])</div><div class="line">t = tf.concat([a1, b1], axis=<span class="number">0</span>)</div><div class="line">print(a) <span class="comment"># tf.Tensor([ 0  1  2  3  4  5  6  7  8  9 10 11], shape=(12,), dtype=int32)</span></div><div class="line">print(b) <span class="comment"># tf.Tensor([12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35], shape=(24,), dtype=int32)</span></div><div class="line">print(a1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4  5]</span></div><div class="line">          <span class="comment">#  [ 6  7  8  9 10 11]], shape=(2, 6), dtype=int32)</span></div><div class="line">print(b1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[12 13 14 15 16 17]</span></div><div class="line">          <span class="comment">#  [18 19 20 21 22 23]</span></div><div class="line">          <span class="comment">#  [24 25 26 27 28 29]</span></div><div class="line">          <span class="comment">#  [30 31 32 33 34 35]], shape=(4, 6), dtype=int32)</span></div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[ 0  1  2  3  4  5]</span></div><div class="line">         <span class="comment">#  [ 6  7  8  9 10 11]</span></div><div class="line">         <span class="comment">#  [12 13 14 15 16 17]</span></div><div class="line">         <span class="comment">#  [18 19 20 21 22 23]</span></div><div class="line">         <span class="comment">#  [24 25 26 27 28 29]</span></div><div class="line">         <span class="comment">#  [30 31 32 33 34 35]], shape=(6, 6), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="stack"><a href="#stack" class="headerlink" title="stack"></a><strong>stack</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">a = tf.range(<span class="number">12</span>)</div><div class="line">c = tf.range(<span class="number">12</span>, <span class="number">24</span>)</div><div class="line">a1 = tf.reshape(a, [<span class="number">2</span>, <span class="number">6</span>])</div><div class="line">c1 = tf.reshape(c, [<span class="number">2</span>, <span class="number">6</span>])</div><div class="line">t = tf.stack([a1, c1], axis=<span class="number">0</span>)</div><div class="line">print(a) <span class="comment"># tf.Tensor([ 0  1  2  3  4  5  6  7  8  9 10 11], shape=(12,), dtype=int32)</span></div><div class="line">print(c) <span class="comment"># tf.Tensor([12 13 14 15 16 17 18 19 20 21 22 23], shape=(12,), dtype=int32)</span></div><div class="line">print(a1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4  5]</span></div><div class="line">          <span class="comment">#  [ 6  7  8  9 10 11]], shape=(2, 6), dtype=int32)</span></div><div class="line">print(c1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[12 13 14 15 16 17]</span></div><div class="line">          <span class="comment">#  [18 19 20 21 22 23]], shape=(2, 6), dtype=int32)</span></div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0  1  2  3  4  5]</span></div><div class="line">         <span class="comment">#   [ 6  7  8  9 10 11]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[12 13 14 15 16 17]</span></div><div class="line">         <span class="comment">#   [18 19 20 21 22 23]]], shape=(2, 2, 6), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="unstack"><a href="#unstack" class="headerlink" title="unstack"></a><strong>unstack</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">a = tf.range(<span class="number">12</span>)</div><div class="line">c = tf.range(<span class="number">12</span>, <span class="number">24</span>)</div><div class="line">a1 = tf.reshape(a, [<span class="number">2</span>, <span class="number">6</span>])</div><div class="line">c1 = tf.reshape(c, [<span class="number">2</span>, <span class="number">6</span>])</div><div class="line">t = tf.stack([a1, c1], axis=<span class="number">0</span>)</div><div class="line">t1 = tf.unstack(t, axis=<span class="number">0</span>)</div><div class="line">t2 = tf.unstack(t, axis=<span class="number">2</span>)</div><div class="line">print(a) <span class="comment"># tf.Tensor([ 0  1  2  3  4  5  6  7  8  9 10 11], shape=(12,), dtype=int32)</span></div><div class="line">print(c) <span class="comment"># tf.Tensor([12 13 14 15 16 17 18 19 20 21 22 23], shape=(12,), dtype=int32)</span></div><div class="line">print(a1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4  5]</span></div><div class="line">          <span class="comment">#  [ 6  7  8  9 10 11]], shape=(2, 6), dtype=int32)</span></div><div class="line">print(c1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[12 13 14 15 16 17]</span></div><div class="line">          <span class="comment">#  [18 19 20 21 22 23]], shape=(2, 6), dtype=int32)</span></div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0  1  2  3  4  5]</span></div><div class="line">         <span class="comment">#   [ 6  7  8  9 10 11]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[12 13 14 15 16 17]</span></div><div class="line">         <span class="comment">#   [18 19 20 21 22 23]]], shape=(2, 2, 6), dtype=int32)</span></div><div class="line">print(t1) <span class="comment"># [&lt;tf.Tensor: id=13, shape=(2, 6), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[ 0,  1,  2,  3,  4,  5],</span></div><div class="line">          <span class="comment">#        [ 6,  7,  8,  9, 10, 11]])&gt;, &lt;tf.Tensor: id=14, shape=(2, 6), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[12, 13, 14, 15, 16, 17],</span></div><div class="line">          <span class="comment">#        [18, 19, 20, 21, 22, 23]])&gt;]</span></div><div class="line">print(t2) <span class="comment"># [&lt;tf.Tensor: id=15, shape=(2, 2), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[ 0,  6],</span></div><div class="line">          <span class="comment">#        [12, 18]])&gt;, &lt;tf.Tensor: id=16, shape=(2, 2), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[ 1,  7],</span></div><div class="line">          <span class="comment">#        [13, 19]])&gt;, &lt;tf.Tensor: id=17, shape=(2, 2), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[ 2,  8],</span></div><div class="line">          <span class="comment">#        [14, 20]])&gt;, &lt;tf.Tensor: id=18, shape=(2, 2), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[ 3,  9],</span></div><div class="line">          <span class="comment">#        [15, 21]])&gt;, &lt;tf.Tensor: id=19, shape=(2, 2), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[ 4, 10],</span></div><div class="line">          <span class="comment">#        [16, 22]])&gt;, &lt;tf.Tensor: id=20, shape=(2, 2), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[ 5, 11],</span></div><div class="line">          <span class="comment">#        [17, 23]])&gt;]</span></div></pre></td></tr></table></figure><hr><h1 id="split"><a href="#split" class="headerlink" title="split"></a><strong>split</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">24</span>)</div><div class="line">t = tf.reshape(arr, [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</div><div class="line">t0 = tf.unstack(t, axis=<span class="number">2</span>)</div><div class="line">t1 = tf.split(t, axis=<span class="number">2</span>, num_or_size_splits=<span class="number">2</span>)</div><div class="line">t2 = tf.split(t, axis=<span class="number">2</span>, num_or_size_splits=[<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>])</div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0  1  2  3]</span></div><div class="line">         <span class="comment">#   [ 4  5  6  7]</span></div><div class="line">         <span class="comment">#   [ 8  9 10 11]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[12 13 14 15]</span></div><div class="line">         <span class="comment">#   [16 17 18 19]</span></div><div class="line">         <span class="comment">#   [20 21 22 23]]], shape=(2, 3, 4), dtype=int32)</span></div><div class="line">print(t0) <span class="comment"># [&lt;tf.Tensor: id=6, shape=(2, 3), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[ 0,  4,  8],</span></div><div class="line">          <span class="comment">#        [12, 16, 20]])&gt;, &lt;tf.Tensor: id=7, shape=(2, 3), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[ 1,  5,  9],</span></div><div class="line">          <span class="comment">#        [13, 17, 21]])&gt;, &lt;tf.Tensor: id=8, shape=(2, 3), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[ 2,  6, 10],</span></div><div class="line">          <span class="comment">#        [14, 18, 22]])&gt;, &lt;tf.Tensor: id=9, shape=(2, 3), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[ 3,  7, 11],</span></div><div class="line">          <span class="comment">#        [15, 19, 23]])&gt;]</span></div><div class="line">print(t1) <span class="comment"># [&lt;tf.Tensor: id=12, shape=(2, 3, 2), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[[ 0,  1],</span></div><div class="line">          <span class="comment">#         [ 4,  5],</span></div><div class="line">          <span class="comment">#         [ 8,  9]],</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#        [[12, 13],</span></div><div class="line">          <span class="comment">#         [16, 17],</span></div><div class="line">          <span class="comment">#         [20, 21]]])&gt;, &lt;tf.Tensor: id=13, shape=(2, 3, 2), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[[ 2,  3],</span></div><div class="line">          <span class="comment">#         [ 6,  7],</span></div><div class="line">          <span class="comment">#         [10, 11]],</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#        [[14, 15],</span></div><div class="line">          <span class="comment">#         [18, 19],</span></div><div class="line">          <span class="comment">#         [22, 23]]])&gt;]</span></div><div class="line">print(t2) <span class="comment"># [&lt;tf.Tensor: id=16, shape=(2, 3, 1), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[[ 0],</span></div><div class="line">          <span class="comment">#         [ 4],</span></div><div class="line">          <span class="comment">#         [ 8]],</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#        [[12],</span></div><div class="line">          <span class="comment">#         [16],</span></div><div class="line">          <span class="comment">#         [20]]])&gt;, &lt;tf.Tensor: id=17, shape=(2, 3, 2), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[[ 1,  2],</span></div><div class="line">          <span class="comment">#         [ 5,  6],</span></div><div class="line">          <span class="comment">#         [ 9, 10]],</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#        [[13, 14],</span></div><div class="line">          <span class="comment">#         [17, 18],</span></div><div class="line">          <span class="comment">#         [21, 22]]])&gt;, &lt;tf.Tensor: id=18, shape=(2, 3, 1), dtype=int32, numpy=</span></div><div class="line">          <span class="comment"># array([[[ 3],</span></div><div class="line">          <span class="comment">#         [ 7],</span></div><div class="line">          <span class="comment">#         [11]],</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#        [[15],</span></div><div class="line">          <span class="comment">#         [19],</span></div><div class="line">          <span class="comment">#         [23]]])&gt;]</span></div></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://st
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>TensorFlow 实战——前向传播（张量）</title>
    <link href="http://www.weichao.io/2019/05/20/TensorFlow-%E5%AE%9E%E6%88%98%E2%80%94%E2%80%94%E5%89%8D%E5%90%91%E4%BC%A0%E6%92%AD%EF%BC%88%E5%BC%A0%E9%87%8F%EF%BC%89/"/>
    <id>http://www.weichao.io/2019/05/20/TensorFlow-实战——前向传播（张量）/</id>
    <published>2019-05-20T08:57:27.000Z</published>
    <updated>2019-05-21T08:59:20.985Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" title="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" target="_blank" rel="external">深度学习与 TensorFlow 2 入门实战</a></li><li><a href="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" title="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" target="_blank" rel="external">TensorFlow-2.x-Tutorials</a></li></ul><hr><h1 id="coding"><a href="#coding" class="headerlink" title="coding"></a><strong>coding</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</div><div class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</div><div class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> datasets</div><div class="line"><span class="keyword">import</span> os</div><div class="line"></div><div class="line">os.environ[<span class="string">'TF_CPP_MIN_LOG_LEVEL'</span>] = <span class="string">'2'</span></div><div class="line"></div><div class="line">print(<span class="string">'GPU'</span>, tf.test.is_gpu_available())</div><div class="line"></div><div class="line">(x, y), _ = datasets.mnist.load_data()</div><div class="line">x = tf.convert_to_tensor(x, dtype=tf.float32) / <span class="number">255.</span></div><div class="line">y = tf.convert_to_tensor(y, dtype=tf.int32)</div><div class="line">print(x.shape)  <span class="comment"># (60000, 28, 28)</span></div><div class="line">print(y.shape)  <span class="comment"># (60000,)</span></div><div class="line"></div><div class="line"><span class="comment"># 使用tf.Variable包装,因为tf.Variable有梯度信息</span></div><div class="line">w1 = tf.Variable(tf.random.truncated_normal([<span class="number">784</span>, <span class="number">256</span>], stddev=<span class="number">0.1</span>))</div><div class="line">b1 = tf.Variable(tf.zeros([<span class="number">256</span>]))</div><div class="line">w2 = tf.Variable(tf.random.truncated_normal([<span class="number">256</span>, <span class="number">128</span>], stddev=<span class="number">0.1</span>))</div><div class="line">b2 = tf.Variable(tf.zeros([<span class="number">128</span>]))</div><div class="line">w3 = tf.Variable(tf.random.truncated_normal([<span class="number">128</span>, <span class="number">10</span>], stddev=<span class="number">0.1</span>))</div><div class="line">b3 = tf.Variable(tf.zeros([<span class="number">10</span>]))</div><div class="line">print(w1.shape, b1.shape)  <span class="comment"># (784, 256) (256,)</span></div><div class="line">print(w2.shape, b2.shape)  <span class="comment"># (256, 128) (128,)</span></div><div class="line">print(w3.shape, b3.shape)  <span class="comment"># (128, 10) (10,)</span></div><div class="line"></div><div class="line">train_db = tf.data.Dataset.from_tensor_slices((x, y)).batch(<span class="number">128</span>)  <span class="comment"># 一次取128张图片</span></div><div class="line">lr = <span class="number">1e-3</span></div><div class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> range(<span class="number">10</span>):</div><div class="line">    <span class="keyword">for</span> step, (x, y) <span class="keyword">in</span> enumerate(train_db):</div><div class="line">        <span class="comment"># (128, 28, 28) =&gt; (128, 784)</span></div><div class="line">        x = tf.reshape(x, [<span class="number">-1</span>, <span class="number">28</span> * <span class="number">28</span>])</div><div class="line"></div><div class="line">        <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape:</div><div class="line">            <span class="comment"># (128, 784)@(784, 256) + (256,) =&gt; (128, 256) + (256,) =&gt; (128, 256) + (128, 256) =&gt; (128, 256)</span></div><div class="line">            h1 = x @ w1 + b1</div><div class="line"></div><div class="line">            h1 = tf.nn.relu(h1)</div><div class="line">            h2 = h1 @ w2 + b2</div><div class="line">            h2 = tf.nn.relu(h2)</div><div class="line">            out = h2 @ w3 + b3</div><div class="line"></div><div class="line">            y_onehot = tf.one_hot(y, depth=<span class="number">10</span>)</div><div class="line">            loss = tf.square(y_onehot - out)</div><div class="line">            loss = tf.reduce_mean(loss)</div><div class="line"></div><div class="line">        grads = tape.gradient(loss, [w1, b1, w2, b2, w3, b3])  <span class="comment"># 计算梯度</span></div><div class="line">        <span class="comment"># w1 = w1 - lr * grads[0]会返回tf.Tensor类型的数据，使用assign_sub包装会原地更新</span></div><div class="line">        w1.assign_sub(lr * grads[<span class="number">0</span>])</div><div class="line">        b1.assign_sub(lr * grads[<span class="number">1</span>])</div><div class="line">        w2.assign_sub(lr * grads[<span class="number">2</span>])</div><div class="line">        b2.assign_sub(lr * grads[<span class="number">3</span>])</div><div class="line">        w3.assign_sub(lr * grads[<span class="number">4</span>])</div><div class="line">        b3.assign_sub(lr * grads[<span class="number">5</span>])</div><div class="line"></div><div class="line">        print(epoch, step, <span class="string">'loss: '</span>, float(loss))</div></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://st
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>TensorFlow broadcasting</title>
    <link href="http://www.weichao.io/2019/05/14/TensorFlow-broadcasting/"/>
    <id>http://www.weichao.io/2019/05/14/TensorFlow-broadcasting/</id>
    <published>2019-05-14T01:33:53.000Z</published>
    <updated>2019-06-04T07:17:56.245Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" title="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" target="_blank" rel="external">深度学习与 TensorFlow 2 入门实战</a></li><li><a href="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" title="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" target="_blank" rel="external">TensorFlow-2.x-Tutorials</a></li></ul><hr><h1 id="broadcasting"><a href="#broadcasting" class="headerlink" title="broadcasting"></a><strong>broadcasting</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">arr1 = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">t = tf.cast(arr1, dtype=tf.float32)</div><div class="line">t1 = tf.ones(<span class="number">5</span>)</div><div class="line">t2 = tf.ones([<span class="number">4</span>, <span class="number">1</span>])</div><div class="line">t3 = tf.ones([<span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>])</div><div class="line">t11 = t + t1</div><div class="line">t21 = t + t2</div><div class="line">t31 = t + t3</div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0.  1.  2.  3.  4.]</span></div><div class="line">         <span class="comment">#   [ 5.  6.  7.  8.  9.]</span></div><div class="line">         <span class="comment">#   [10. 11. 12. 13. 14.]</span></div><div class="line">         <span class="comment">#   [15. 16. 17. 18. 19.]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[20. 21. 22. 23. 24.]</span></div><div class="line">         <span class="comment">#   [25. 26. 27. 28. 29.]</span></div><div class="line">         <span class="comment">#   [30. 31. 32. 33. 34.]</span></div><div class="line">         <span class="comment">#   [35. 36. 37. 38. 39.]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[40. 41. 42. 43. 44.]</span></div><div class="line">         <span class="comment">#   [45. 46. 47. 48. 49.]</span></div><div class="line">         <span class="comment">#   [50. 51. 52. 53. 54.]</span></div><div class="line">         <span class="comment">#   [55. 56. 57. 58. 59.]]], shape=(3, 4, 5), dtype=float32)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor([1. 1. 1. 1. 1.], shape=(5,), dtype=float32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[1.]</span></div><div class="line">          <span class="comment">#  [1.]</span></div><div class="line">          <span class="comment">#  [1.]</span></div><div class="line">          <span class="comment">#  [1.]], shape=(4, 1), dtype=float32)</span></div><div class="line">print(t3) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[1.]</span></div><div class="line">          <span class="comment">#   [1.]</span></div><div class="line">          <span class="comment">#   [1.]</span></div><div class="line">          <span class="comment">#   [1.]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[1.]</span></div><div class="line">          <span class="comment">#   [1.]</span></div><div class="line">          <span class="comment">#   [1.]</span></div><div class="line">          <span class="comment">#   [1.]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[1.]</span></div><div class="line">          <span class="comment">#   [1.]</span></div><div class="line">          <span class="comment">#   [1.]</span></div><div class="line">          <span class="comment">#   [1.]]], shape=(3, 4, 1), dtype=float32)</span></div><div class="line">print(t11) <span class="comment"># tf.Tensor(</span></div><div class="line">           <span class="comment"># [[[ 1.  2.  3.  4.  5.]</span></div><div class="line">           <span class="comment">#   [ 6.  7.  8.  9. 10.]</span></div><div class="line">           <span class="comment">#   [11. 12. 13. 14. 15.]</span></div><div class="line">           <span class="comment">#   [16. 17. 18. 19. 20.]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[21. 22. 23. 24. 25.]</span></div><div class="line">           <span class="comment">#   [26. 27. 28. 29. 30.]</span></div><div class="line">           <span class="comment">#   [31. 32. 33. 34. 35.]</span></div><div class="line">           <span class="comment">#   [36. 37. 38. 39. 40.]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[41. 42. 43. 44. 45.]</span></div><div class="line">           <span class="comment">#   [46. 47. 48. 49. 50.]</span></div><div class="line">           <span class="comment">#   [51. 52. 53. 54. 55.]</span></div><div class="line">           <span class="comment">#   [56. 57. 58. 59. 60.]]], shape=(3, 4, 5), dtype=float32)</span></div><div class="line">print(t21) <span class="comment"># tf.Tensor(</span></div><div class="line">           <span class="comment"># [[[ 1.  2.  3.  4.  5.]</span></div><div class="line">           <span class="comment">#   [ 6.  7.  8.  9. 10.]</span></div><div class="line">           <span class="comment">#   [11. 12. 13. 14. 15.]</span></div><div class="line">           <span class="comment">#   [16. 17. 18. 19. 20.]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[21. 22. 23. 24. 25.]</span></div><div class="line">           <span class="comment">#   [26. 27. 28. 29. 30.]</span></div><div class="line">           <span class="comment">#   [31. 32. 33. 34. 35.]</span></div><div class="line">           <span class="comment">#   [36. 37. 38. 39. 40.]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[41. 42. 43. 44. 45.]</span></div><div class="line">           <span class="comment">#   [46. 47. 48. 49. 50.]</span></div><div class="line">           <span class="comment">#   [51. 52. 53. 54. 55.]</span></div><div class="line">           <span class="comment">#   [56. 57. 58. 59. 60.]]], shape=(3, 4, 5), dtype=float32)</span></div><div class="line">print(t31) <span class="comment"># tf.Tensor(</span></div><div class="line">           <span class="comment"># [[[ 1.  2.  3.  4.  5.]</span></div><div class="line">           <span class="comment">#   [ 6.  7.  8.  9. 10.]</span></div><div class="line">           <span class="comment">#   [11. 12. 13. 14. 15.]</span></div><div class="line">           <span class="comment">#   [16. 17. 18. 19. 20.]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[21. 22. 23. 24. 25.]</span></div><div class="line">           <span class="comment">#   [26. 27. 28. 29. 30.]</span></div><div class="line">           <span class="comment">#   [31. 32. 33. 34. 35.]</span></div><div class="line">           <span class="comment">#   [36. 37. 38. 39. 40.]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[41. 42. 43. 44. 45.]</span></div><div class="line">           <span class="comment">#   [46. 47. 48. 49. 50.]</span></div><div class="line">           <span class="comment">#   [51. 52. 53. 54. 55.]</span></div><div class="line">           <span class="comment">#   [56. 57. 58. 59. 60.]]], shape=(3, 4, 5), dtype=float32)</span></div><div class="line"></div><div class="line">t4 = tf.ones([<span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>])</div><div class="line">t41 = t + t4 <span class="comment"># tensorflow.python.framework.errors_impl.InvalidArgumentError: Incompatible shapes: [3,4,5] vs. [3,4,2] [Op:Add] name: add/</span></div></pre></td></tr></table></figure><hr><h1 id="broadcast-to"><a href="#broadcast-to" class="headerlink" title="broadcast_to"></a><strong>broadcast_to</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">12</span>)</div><div class="line">arr1 = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>])</div><div class="line">t = tf.cast(arr1, dtype=tf.float32)</div><div class="line">t1 = tf.broadcast_to(t, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0.]</span></div><div class="line">         <span class="comment">#   [ 1.]</span></div><div class="line">         <span class="comment">#   [ 2.]</span></div><div class="line">         <span class="comment">#   [ 3.]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[ 4.]</span></div><div class="line">         <span class="comment">#   [ 5.]</span></div><div class="line">         <span class="comment">#   [ 6.]</span></div><div class="line">         <span class="comment">#   [ 7.]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[ 8.]</span></div><div class="line">         <span class="comment">#   [ 9.]</span></div><div class="line">         <span class="comment">#   [10.]</span></div><div class="line">         <span class="comment">#   [11.]]], shape=(3, 4, 1), dtype=float32)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0.  0.  0.  0.  0.]</span></div><div class="line">          <span class="comment">#   [ 1.  1.  1.  1.  1.]</span></div><div class="line">          <span class="comment">#   [ 2.  2.  2.  2.  2.]</span></div><div class="line">          <span class="comment">#   [ 3.  3.  3.  3.  3.]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[ 4.  4.  4.  4.  4.]</span></div><div class="line">          <span class="comment">#   [ 5.  5.  5.  5.  5.]</span></div><div class="line">          <span class="comment">#   [ 6.  6.  6.  6.  6.]</span></div><div class="line">          <span class="comment">#   [ 7.  7.  7.  7.  7.]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[ 8.  8.  8.  8.  8.]</span></div><div class="line">          <span class="comment">#   [ 9.  9.  9.  9.  9.]</span></div><div class="line">          <span class="comment">#   [10. 10. 10. 10. 10.]</span></div><div class="line">          <span class="comment">#   [11. 11. 11. 11. 11.]]], shape=(3, 4, 5), dtype=float32)</span></div></pre></td></tr></table></figure><hr><h1 id="tile"><a href="#tile" class="headerlink" title="tile"></a><strong>tile</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">12</span>)</div><div class="line">a = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>])</div><div class="line">a1 = tf.broadcast_to(a, [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</div><div class="line">a2 = tf.expand_dims(a, axis=<span class="number">0</span>)</div><div class="line">a21 = tf.tile(a2, [<span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>])</div><div class="line">print(a) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[ 0  1  2  3]</span></div><div class="line">         <span class="comment">#  [ 4  5  6  7]</span></div><div class="line">         <span class="comment">#  [ 8  9 10 11]], shape=(3, 4), dtype=int32)</span></div><div class="line">print(a1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3]</span></div><div class="line">          <span class="comment">#   [ 4  5  6  7]</span></div><div class="line">          <span class="comment">#   [ 8  9 10 11]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[ 0  1  2  3]</span></div><div class="line">          <span class="comment">#   [ 4  5  6  7]</span></div><div class="line">          <span class="comment">#   [ 8  9 10 11]]], shape=(2, 3, 4), dtype=int32)</span></div><div class="line">print(a2) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3]</span></div><div class="line">          <span class="comment">#   [ 4  5  6  7]</span></div><div class="line">          <span class="comment">#   [ 8  9 10 11]]], shape=(1, 3, 4), dtype=int32)</span></div><div class="line">print(a21) <span class="comment"># tf.Tensor(</span></div><div class="line">           <span class="comment"># [[[ 0  1  2  3]</span></div><div class="line">           <span class="comment">#   [ 4  5  6  7]</span></div><div class="line">           <span class="comment">#   [ 8  9 10 11]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[ 0  1  2  3]</span></div><div class="line">           <span class="comment">#   [ 4  5  6  7]</span></div><div class="line">           <span class="comment">#   [ 8  9 10 11]]], shape=(2, 3, 4), dtype=int32)</span></div></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://st
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>TensorFlow 维度变换</title>
    <link href="http://www.weichao.io/2019/05/13/TensorFlow-%E7%BB%B4%E5%BA%A6%E5%8F%98%E6%8D%A2/"/>
    <id>http://www.weichao.io/2019/05/13/TensorFlow-维度变换/</id>
    <published>2019-05-13T01:31:52.000Z</published>
    <updated>2019-05-20T01:33:29.131Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" title="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" target="_blank" rel="external">深度学习与 TensorFlow 2 入门实战</a></li><li><a href="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" title="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" target="_blank" rel="external">TensorFlow-2.x-Tutorials</a></li></ul><hr><h1 id="reshape"><a href="#reshape" class="headerlink" title="reshape"></a><strong>reshape</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">t1 = tf.reshape(t, [<span class="number">3</span>, <span class="number">4</span> * <span class="number">5</span>])</div><div class="line">t2 = tf.reshape(t, [<span class="number">3</span>, <span class="number">-1</span>])</div><div class="line">t3 = tf.reshape(t, [<span class="number">-1</span>])</div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">         <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">         <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">         <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">         <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">         <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">         <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">         <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">         <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">         <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19]</span></div><div class="line">          <span class="comment">#  [20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39]</span></div><div class="line">          <span class="comment">#  [40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59]], shape=(3, 20), dtype=int32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19]</span></div><div class="line">          <span class="comment">#  [20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39]</span></div><div class="line">          <span class="comment">#  [40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59]], shape=(3, 20), dtype=int32)</span></div><div class="line">print(t3) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23</span></div><div class="line">          <span class="comment">#  24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47</span></div><div class="line">          <span class="comment">#  48 49 50 51 52 53 54 55 56 57 58 59], shape=(60,), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="transpose"><a href="#transpose" class="headerlink" title="transpose"></a><strong>transpose</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t1 = tf.reshape(arr, [<span class="number">3</span>, <span class="number">-1</span>])</div><div class="line">t2 = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">t11 = tf.transpose(t1)</div><div class="line">t21 = tf.transpose(t2)</div><div class="line">t22 = tf.transpose(t2, perm=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>])</div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19]</span></div><div class="line">          <span class="comment">#  [20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39]</span></div><div class="line">          <span class="comment">#  [40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59]], shape=(3, 20), dtype=int32)</span></div><div class="line">print(t11) <span class="comment"># tf.Tensor(</span></div><div class="line">           <span class="comment"># [[ 0 20 40]</span></div><div class="line">           <span class="comment">#  [ 1 21 41]</span></div><div class="line">           <span class="comment">#  [ 2 22 42]</span></div><div class="line">           <span class="comment">#  [ 3 23 43]</span></div><div class="line">           <span class="comment">#  [ 4 24 44]</span></div><div class="line">           <span class="comment">#  [ 5 25 45]</span></div><div class="line">           <span class="comment">#  [ 6 26 46]</span></div><div class="line">           <span class="comment">#  [ 7 27 47]</span></div><div class="line">           <span class="comment">#  [ 8 28 48]</span></div><div class="line">           <span class="comment">#  [ 9 29 49]</span></div><div class="line">           <span class="comment">#  [10 30 50]</span></div><div class="line">           <span class="comment">#  [11 31 51]</span></div><div class="line">           <span class="comment">#  [12 32 52]</span></div><div class="line">           <span class="comment">#  [13 33 53]</span></div><div class="line">           <span class="comment">#  [14 34 54]</span></div><div class="line">           <span class="comment">#  [15 35 55]</span></div><div class="line">           <span class="comment">#  [16 36 56]</span></div><div class="line">           <span class="comment">#  [17 37 57]</span></div><div class="line">           <span class="comment">#  [18 38 58]</span></div><div class="line">           <span class="comment">#  [19 39 59]], shape=(20, 3), dtype=int32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">          <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">          <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">          <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t21) <span class="comment"># tf.Tensor(</span></div><div class="line">           <span class="comment"># [[[ 0 20 40]</span></div><div class="line">           <span class="comment">#   [ 5 25 45]</span></div><div class="line">           <span class="comment">#   [10 30 50]</span></div><div class="line">           <span class="comment">#   [15 35 55]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[ 1 21 41]</span></div><div class="line">           <span class="comment">#   [ 6 26 46]</span></div><div class="line">           <span class="comment">#   [11 31 51]</span></div><div class="line">           <span class="comment">#   [16 36 56]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[ 2 22 42]</span></div><div class="line">           <span class="comment">#   [ 7 27 47]</span></div><div class="line">           <span class="comment">#   [12 32 52]</span></div><div class="line">           <span class="comment">#   [17 37 57]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[ 3 23 43]</span></div><div class="line">           <span class="comment">#   [ 8 28 48]</span></div><div class="line">           <span class="comment">#   [13 33 53]</span></div><div class="line">           <span class="comment">#   [18 38 58]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[ 4 24 44]</span></div><div class="line">           <span class="comment">#   [ 9 29 49]</span></div><div class="line">           <span class="comment">#   [14 34 54]</span></div><div class="line">           <span class="comment">#   [19 39 59]]], shape=(5, 4, 3), dtype=int32)</span></div><div class="line">print(t22) <span class="comment"># tf.Tensor(</span></div><div class="line">           <span class="comment"># [[[ 0  5 10 15]</span></div><div class="line">           <span class="comment">#   [ 1  6 11 16]</span></div><div class="line">           <span class="comment">#   [ 2  7 12 17]</span></div><div class="line">           <span class="comment">#   [ 3  8 13 18]</span></div><div class="line">           <span class="comment">#   [ 4  9 14 19]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[20 25 30 35]</span></div><div class="line">           <span class="comment">#   [21 26 31 36]</span></div><div class="line">           <span class="comment">#   [22 27 32 37]</span></div><div class="line">           <span class="comment">#   [23 28 33 38]</span></div><div class="line">           <span class="comment">#   [24 29 34 39]]</span></div><div class="line">           <span class="comment"># </span></div><div class="line">           <span class="comment">#  [[40 45 50 55]</span></div><div class="line">           <span class="comment">#   [41 46 51 56]</span></div><div class="line">           <span class="comment">#   [42 47 52 57]</span></div><div class="line">           <span class="comment">#   [43 48 53 58]</span></div><div class="line">           <span class="comment">#   [44 49 54 59]]], shape=(3, 5, 4), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="expand-dims"><a href="#expand-dims" class="headerlink" title="expand_dims"></a><strong>expand_dims</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">t1 = tf.expand_dims(t, axis=<span class="number">0</span>)</div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">         <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">         <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">         <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">         <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">         <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">         <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">         <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">         <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">         <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#    [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#    [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#    [15 16 17 18 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#   [[20 21 22 23 24]</span></div><div class="line">          <span class="comment">#    [25 26 27 28 29]</span></div><div class="line">          <span class="comment">#    [30 31 32 33 34]</span></div><div class="line">          <span class="comment">#    [35 36 37 38 39]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#   [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#    [45 46 47 48 49]</span></div><div class="line">          <span class="comment">#    [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#    [55 56 57 58 59]]]], shape=(1, 3, 4, 5), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="squeeze"><a href="#squeeze" class="headerlink" title="squeeze"></a><strong>squeeze</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t = tf.reshape(arr, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">t1 = tf.squeeze(t, axis=<span class="number">0</span>)</div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[[ 0  1  2  3  4]</span></div><div class="line">         <span class="comment">#    [ 5  6  7  8  9]</span></div><div class="line">         <span class="comment">#    [10 11 12 13 14]</span></div><div class="line">         <span class="comment">#    [15 16 17 18 19]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#   [[20 21 22 23 24]</span></div><div class="line">         <span class="comment">#    [25 26 27 28 29]</span></div><div class="line">         <span class="comment">#    [30 31 32 33 34]</span></div><div class="line">         <span class="comment">#    [35 36 37 38 39]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#   [[40 41 42 43 44]</span></div><div class="line">         <span class="comment">#    [45 46 47 48 49]</span></div><div class="line">         <span class="comment">#    [50 51 52 53 54]</span></div><div class="line">         <span class="comment">#    [55 56 57 58 59]]]], shape=(1, 3, 4, 5), dtype=int32)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">          <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">          <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">          <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://st
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>TensorFlow 索引与切片</title>
    <link href="http://www.weichao.io/2019/05/09/TensorFlow-%E7%B4%A2%E5%BC%95%E4%B8%8E%E5%88%87%E7%89%87/"/>
    <id>http://www.weichao.io/2019/05/09/TensorFlow-索引与切片/</id>
    <published>2019-05-09T01:30:11.000Z</published>
    <updated>2019-05-20T01:31:14.573Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" title="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" target="_blank" rel="external">深度学习与 TensorFlow 2 入门实战</a></li><li><a href="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" title="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" target="_blank" rel="external">TensorFlow-2.x-Tutorials</a></li></ul><hr><h1 id="Basic-indexing"><a href="#Basic-indexing" class="headerlink" title="Basic indexing"></a><strong>Basic indexing</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t1 = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">          <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">          <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">          <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t1[<span class="number">0</span>]) <span class="comment"># tf.Tensor(</span></div><div class="line">             <span class="comment"># [[ 0  1  2  3  4]</span></div><div class="line">             <span class="comment">#  [ 5  6  7  8  9]</span></div><div class="line">             <span class="comment">#  [10 11 12 13 14]</span></div><div class="line">             <span class="comment">#  [15 16 17 18 19]], shape=(4, 5), dtype=int32)</span></div><div class="line">print(t1[<span class="number">0</span>][<span class="number">0</span>]) <span class="comment"># tf.Tensor([0 1 2 3 4], shape=(5,), dtype=int32)</span></div><div class="line">print(t1[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]) <span class="comment"># tf.Tensor(0, shape=(), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="numpy-style-indexing"><a href="#numpy-style-indexing" class="headerlink" title="numpy-style indexing"></a><strong>numpy-style indexing</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t1 = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">          <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">          <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">          <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t1[<span class="number">0</span>]) <span class="comment"># tf.Tensor(</span></div><div class="line">             <span class="comment"># [[ 0  1  2  3  4]</span></div><div class="line">             <span class="comment">#  [ 5  6  7  8  9]</span></div><div class="line">             <span class="comment">#  [10 11 12 13 14]</span></div><div class="line">             <span class="comment">#  [15 16 17 18 19]], shape=(4, 5), dtype=int32)</span></div><div class="line">print(t1[<span class="number">0</span>, <span class="number">0</span>]) <span class="comment"># tf.Tensor([0 1 2 3 4], shape=(5,), dtype=int32)</span></div><div class="line">print(t1[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]) <span class="comment"># tf.Tensor(0, shape=(), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="截取"><a href="#截取" class="headerlink" title="截取"></a><strong>截取</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">t = tf.range(<span class="number">10</span>)</div><div class="line">t1 = t[<span class="number">2</span>:]</div><div class="line">t2 = t[<span class="number">-2</span>:]</div><div class="line">t3 = t[:<span class="number">2</span>]</div><div class="line">t4 = t[:<span class="number">-2</span>]</div><div class="line">print(t) <span class="comment"># tf.Tensor([0 1 2 3 4 5 6 7 8 9], shape=(10,), dtype=int32)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor([2 3 4 5 6 7 8 9], shape=(8,), dtype=int32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor([8 9], shape=(2,), dtype=int32)</span></div><div class="line">print(t3) <span class="comment"># tf.Tensor([0 1], shape=(2,), dtype=int32)</span></div><div class="line">print(t4) <span class="comment"># tf.Tensor([0 1 2 3 4 5 6 7], shape=(8,), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="indexing-by"><a href="#indexing-by" class="headerlink" title="indexing by :"></a><strong>indexing by :</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">t1 = t[<span class="number">0</span>, :, :]</div><div class="line">t2 = t[:, <span class="number">0</span>, :]</div><div class="line">t3 = t[:, :, <span class="number">0</span>]</div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">         <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">         <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">         <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">         <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">         <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">         <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">         <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">         <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">         <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#  [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#  [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#  [15 16 17 18 19]], shape=(4, 5), dtype=int32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#  [20 21 22 23 24]</span></div><div class="line">          <span class="comment">#  [40 41 42 43 44]], shape=(3, 5), dtype=int32)</span></div><div class="line">print(t3) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  5 10 15]</span></div><div class="line">          <span class="comment">#  [20 25 30 35]</span></div><div class="line">          <span class="comment">#  [40 45 50 55]], shape=(3, 4), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="indexing-by-1"><a href="#indexing-by-1" class="headerlink" title="indexing by ::"></a><strong>indexing by ::</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">t1 = t[:, ::<span class="number">2</span>, :]</div><div class="line">t2 = t[<span class="number">0</span>::<span class="number">2</span>, :, :]</div><div class="line">t3 = t[<span class="number">0</span>, ::<span class="number">2</span>, :]</div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">         <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">         <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">         <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">         <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">         <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">         <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">         <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">         <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">         <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">          <span class="comment">#   [30 31 32 33 34]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]]], shape=(3, 2, 5), dtype=int32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#   [55 56 57 58 59]]], shape=(2, 4, 5), dtype=int32)</span></div><div class="line">print(t3) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#  [10 11 12 13 14]], shape=(2, 5), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="…"><a href="#…" class="headerlink" title="…"></a><strong>…</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">t1 = t[<span class="number">0</span>, ...]</div><div class="line">t2 = t[..., <span class="number">0</span>]</div><div class="line">t3 = t[<span class="number">0</span>, <span class="number">0</span>, ...]</div><div class="line">t4 = t[..., <span class="number">0</span>, <span class="number">0</span>]</div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">         <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">         <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">         <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">         <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">         <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">         <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">         <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">         <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">         <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#  [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#  [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#  [15 16 17 18 19]], shape=(4, 5), dtype=int32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  5 10 15]</span></div><div class="line">          <span class="comment">#  [20 25 30 35]</span></div><div class="line">          <span class="comment">#  [40 45 50 55]], shape=(3, 4), dtype=int32)</span></div><div class="line">print(t3) <span class="comment"># tf.Tensor([0 1 2 3 4], shape=(5,), dtype=int32)</span></div><div class="line">print(t4) <span class="comment"># tf.Tensor([ 0 20 40], shape=(3,), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="gather"><a href="#gather" class="headerlink" title="gather"></a><strong>gather</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">t1 = tf.gather(t, axis=<span class="number">0</span>, indices=[<span class="number">0</span>, <span class="number">2</span>])</div><div class="line">t2 = tf.gather(t, axis=<span class="number">0</span>, indices=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>])</div><div class="line">t3 = tf.gather(t, axis=<span class="number">1</span>, indices=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>])</div><div class="line">t4 = tf.gather(t, axis=<span class="number">1</span>, indices=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>])</div><div class="line">t5 = tf.gather(t, axis=<span class="number">2</span>, indices=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>])</div><div class="line">t6 = tf.gather(t, axis=<span class="number">2</span>, indices=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>])</div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#   [55 56 57 58 59]]], shape=(2, 4, 5), dtype=int32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#   [55 56 57 58 59]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">          <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">          <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">          <span class="comment">#   [35 36 37 38 39]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t3) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#   [ 5  6  7  8  9]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">          <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">          <span class="comment">#   [25 26 27 28 29]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#   [45 46 47 48 49]]], shape=(3, 3, 5), dtype=int32)</span></div><div class="line">print(t4) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">          <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">          <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">          <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">          <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t5) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  2  1  4]</span></div><div class="line">          <span class="comment">#   [ 5  7  6  9]</span></div><div class="line">          <span class="comment">#   [10 12 11 14]</span></div><div class="line">          <span class="comment">#   [15 17 16 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[20 22 21 24]</span></div><div class="line">          <span class="comment">#   [25 27 26 29]</span></div><div class="line">          <span class="comment">#   [30 32 31 34]</span></div><div class="line">          <span class="comment">#   [35 37 36 39]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 42 41 44]</span></div><div class="line">          <span class="comment">#   [45 47 46 49]</span></div><div class="line">          <span class="comment">#   [50 52 51 54]</span></div><div class="line">          <span class="comment">#   [55 57 56 59]]], shape=(3, 4, 4), dtype=int32)</span></div><div class="line">print(t6) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  2  1  4  3]</span></div><div class="line">          <span class="comment">#   [ 5  7  6  9  8]</span></div><div class="line">          <span class="comment">#   [10 12 11 14 13]</span></div><div class="line">          <span class="comment">#   [15 17 16 19 18]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[20 22 21 24 23]</span></div><div class="line">          <span class="comment">#   [25 27 26 29 28]</span></div><div class="line">          <span class="comment">#   [30 32 31 34 33]</span></div><div class="line">          <span class="comment">#   [35 37 36 39 38]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 42 41 44 43]</span></div><div class="line">          <span class="comment">#   [45 47 46 49 48]</span></div><div class="line">          <span class="comment">#   [50 52 51 54 53]</span></div><div class="line">          <span class="comment">#   [55 57 56 59 58]]], shape=(3, 4, 5), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="gather-nd"><a href="#gather-nd" class="headerlink" title="gather_nd"></a><strong>gather_nd</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">t1 = tf.gather_nd(t, [<span class="number">0</span>])</div><div class="line">t2 = tf.gather_nd(t, [<span class="number">0</span>, <span class="number">1</span>])</div><div class="line">t3 = tf.gather_nd(t, [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>])</div><div class="line">t4 = tf.gather_nd(t, [[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>]])</div><div class="line">t5 = tf.gather_nd(t, [[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">1</span>]])</div><div class="line">t6 = tf.gather_nd(t, [[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>]])</div><div class="line">t7 = tf.gather_nd(t, [[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]])</div><div class="line">t8 = tf.gather_nd(t, [[[<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]]])</div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">         <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">         <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">         <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">         <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">         <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">         <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">         <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">         <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">         <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#  [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#  [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#  [15 16 17 18 19]], shape=(4, 5), dtype=int32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor([5 6 7 8 9], shape=(5,), dtype=int32)</span></div><div class="line">print(t3) <span class="comment"># tf.Tensor(7, shape=(), dtype=int32)</span></div><div class="line">print(t4) <span class="comment"># tf.Tensor([7], shape=(1,), dtype=int32)</span></div><div class="line">print(t5) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#  [25 26 27 28 29]], shape=(2, 5), dtype=int32)</span></div><div class="line">print(t6) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#  [25 26 27 28 29]</span></div><div class="line">          <span class="comment">#  [50 51 52 53 54]], shape=(3, 5), dtype=int32)</span></div><div class="line">print(t7) <span class="comment"># tf.Tensor([ 0 26 52], shape=(3,), dtype=int32)</span></div><div class="line">print(t8) <span class="comment"># tf.Tensor([[ 0 26 52]], shape=(1, 3), dtype=int32)</span></div></pre></td></tr></table></figure><hr><h1 id="boolean-mask"><a href="#boolean-mask" class="headerlink" title="boolean_mask"></a><strong>boolean_mask</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">arr = tf.range(<span class="number">60</span>)</div><div class="line">t = tf.reshape(arr, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</div><div class="line">t1 = tf.boolean_mask(t, mask=[<span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">True</span>])</div><div class="line">t2 = tf.boolean_mask(t, mask=[<span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">True</span>], axis=<span class="number">1</span>)</div><div class="line">t3 = tf.boolean_mask(t, mask=[[<span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">True</span>], [<span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">False</span>, <span class="keyword">True</span>], [<span class="keyword">False</span>, <span class="keyword">True</span>, <span class="keyword">False</span>, <span class="keyword">True</span>]])</div><div class="line">print(t) <span class="comment"># tf.Tensor(</span></div><div class="line">         <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">         <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">         <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">         <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">         <span class="comment">#   [25 26 27 28 29]</span></div><div class="line">         <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">         <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">         <span class="comment"># </span></div><div class="line">         <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">         <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">         <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">         <span class="comment">#   [55 56 57 58 59]]], shape=(3, 4, 5), dtype=int32)</span></div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [ 5  6  7  8  9]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [45 46 47 48 49]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#   [55 56 57 58 59]]], shape=(2, 4, 5), dtype=int32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#   [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#   [15 16 17 18 19]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[20 21 22 23 24]</span></div><div class="line">          <span class="comment">#   [30 31 32 33 34]</span></div><div class="line">          <span class="comment">#   [35 36 37 38 39]]</span></div><div class="line">          <span class="comment"># </span></div><div class="line">          <span class="comment">#  [[40 41 42 43 44]</span></div><div class="line">          <span class="comment">#   [50 51 52 53 54]</span></div><div class="line">          <span class="comment">#   [55 56 57 58 59]]], shape=(3, 3, 5), dtype=int32)</span></div><div class="line">print(t3) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 0  1  2  3  4]</span></div><div class="line">          <span class="comment">#  [10 11 12 13 14]</span></div><div class="line">          <span class="comment">#  [15 16 17 18 19]</span></div><div class="line">          <span class="comment">#  [20 21 22 23 24]</span></div><div class="line">          <span class="comment">#  [35 36 37 38 39]</span></div><div class="line">          <span class="comment">#  [45 46 47 48 49]</span></div><div class="line">          <span class="comment">#  [55 56 57 58 59]], shape=(7, 5), dtype=int32)</span></div></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://st
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>TensorFlow 数据类型</title>
    <link href="http://www.weichao.io/2019/05/06/TensorFlow-%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/"/>
    <id>http://www.weichao.io/2019/05/06/TensorFlow-数据类型/</id>
    <published>2019-05-06T01:23:38.000Z</published>
    <updated>2019-05-20T01:27:46.631Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" title="https://study.163.com/course/courseMain.htm?courseId=1209092816&amp;share=1&amp;shareId=1143588469" target="_blank" rel="external">深度学习与 TensorFlow 2 入门实战</a></li><li><a href="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" title="https://github.com/dragen1860/TensorFlow-2.x-Tutorials" target="_blank" rel="external">TensorFlow-2.x-Tutorials</a></li></ul><hr><h1 id="list"><a href="#list" class="headerlink" title="list"></a><strong>list</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">1.2</span>, <span class="string">'Hello'</span>, (<span class="number">1</span>, <span class="number">2</span>), layers]</div><div class="line">[<span class="number">64</span>, <span class="number">32</span>, <span class="number">32</span>, <span class="number">3</span>]</div></pre></td></tr></table></figure><hr><h1 id="np-array"><a href="#np-array" class="headerlink" title="np.array"></a><strong>np.array</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="number">64</span>, <span class="number">224</span>, <span class="number">224</span>, <span class="number">3</span>]</div></pre></td></tr></table></figure><p>解决同类型数据运算。</p><p>深度计算之前已经设计好的科学计算库，不支持 GPU，不支持自动求导。TensorFlow 解决了这一问题。</p><hr><h1 id="tf-Tensor"><a href="#tf-Tensor" class="headerlink" title="tf.Tensor"></a><strong>tf.Tensor</strong></h1><h2 id="int-float-double-bool-string"><a href="#int-float-double-bool-string" class="headerlink" title="int, float, double, bool, string"></a><strong>int, float, double, bool, string</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">a = tf.constant(<span class="number">1</span>)</div><div class="line">print(a) <span class="comment"># tf.Tensor(1, shape=(), dtype=int32)</span></div><div class="line"></div><div class="line">a = tf.constant(<span class="number">1.</span>)</div><div class="line">print(a) <span class="comment"># tf.Tensor(1.0, shape=(), dtype=float32)</span></div><div class="line"></div><div class="line">a = tf.constant(<span class="number">2.2</span>, dtype=tf.int32)</div><div class="line">print(a) <span class="comment"># TypeError: Cannot convert provided value to EagerTensor. Provided value: 2.2 Requested dtype: int32</span></div><div class="line"></div><div class="line">a = tf.constant(<span class="number">2.2</span>, dtype=tf.double)</div><div class="line">print(a) <span class="comment"># tf.Tensor(2.2, shape=(), dtype=float64)</span></div><div class="line"></div><div class="line">a = tf.constant([<span class="keyword">True</span>, <span class="keyword">False</span>])</div><div class="line">print(a) <span class="comment"># tf.Tensor([ True False], shape=(2,), dtype=bool)</span></div><div class="line"></div><div class="line">a = tf.constant(<span class="string">'Hello, world!'</span>)</div><div class="line">print(a) <span class="comment"># tf.Tensor(b'Hello, world!', shape=(), dtype=string)</span></div></pre></td></tr></table></figure><h2 id="scalar"><a href="#scalar" class="headerlink" title="scalar"></a><strong>scalar</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">1.1</span></div></pre></td></tr></table></figure><h2 id="vector"><a href="#vector" class="headerlink" title="vector"></a><strong>vector</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1.1</span>], [<span class="number">1.1</span>, <span class="number">1.2</span>]</div></pre></td></tr></table></figure><h2 id="matrix"><a href="#matrix" class="headerlink" title="matrix"></a><strong>matrix</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[<span class="number">1.1</span>, <span class="number">2.2</span>], [<span class="number">3.3</span>, <span class="number">4.4</span>], [<span class="number">5.5</span>, <span class="number">6.6</span>]]</div></pre></td></tr></table></figure><h2 id="tensor"><a href="#tensor" class="headerlink" title="tensor"></a><strong>tensor</strong></h2><p>rank &gt; 2</p><hr><h1 id="Tensor-Property"><a href="#Tensor-Property" class="headerlink" title="Tensor Property"></a><strong>Tensor Property</strong></h1><h2 id="切换-Tensor-到-CPU-或-GPU"><a href="#切换-Tensor-到-CPU-或-GPU" class="headerlink" title="切换 Tensor 到 CPU 或 GPU"></a><strong>切换 Tensor 到 CPU 或 GPU</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> tf.device(<span class="string">"cpu"</span>):</div><div class="line">    a = tf.constant([<span class="number">1</span>])</div><div class="line"><span class="keyword">with</span> tf.device(<span class="string">"gpu"</span>):</div><div class="line">    b = tf.range(<span class="number">4</span>)</div><div class="line">print(a.device) <span class="comment"># /job:localhost/replica:0/task:0/device:CPU:0</span></div><div class="line">print(b.device) <span class="comment"># /job:localhost/replica:0/task:0/device:GPU:0</span></div><div class="line"></div><div class="line">aa = a.gpu()</div><div class="line">bb = b.cpu()</div><div class="line">print(aa.device) <span class="comment"># /job:localhost/replica:0/task:0/device:GPU:0</span></div><div class="line">print(bb.device) <span class="comment"># /job:localhost/replica:0/task:0/device:CPU:0</span></div></pre></td></tr></table></figure><h2 id="Tensor-转-numpy"><a href="#Tensor-转-numpy" class="headerlink" title="Tensor 转 numpy"></a><strong>Tensor 转 numpy</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">b = tf.range(<span class="number">4</span>)</div><div class="line">bb = b.numpy()</div><div class="line">print(b) <span class="comment"># tf.Tensor([0 1 2 3], shape=(4,), dtype=int32)</span></div><div class="line">print(bb) <span class="comment"># [0 1 2 3]</span></div></pre></td></tr></table></figure><h2 id="numpy-转-Tensor"><a href="#numpy-转-Tensor" class="headerlink" title="numpy 转 Tensor"></a><strong>numpy 转 Tensor</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">a = np.arange(<span class="number">5</span>)</div><div class="line">a1 = a.dtype</div><div class="line">a2 = tf.convert_to_tensor(a)</div><div class="line">a3 = tf.convert_to_tensor(a, dtype=tf.int64)</div><div class="line">print(a1) <span class="comment"># int32</span></div><div class="line">print(a2) <span class="comment"># tf.Tensor([0 1 2 3 4], shape=(5,), dtype=int32)</span></div><div class="line">print(a3) <span class="comment"># tf.Tensor([0 1 2 3 4], shape=(5,), dtype=int64)</span></div></pre></td></tr></table></figure><h2 id="int32-转-float32-double-int64"><a href="#int32-转-float32-double-int64" class="headerlink" title="int32 转 float32/double/int64"></a><strong>int32 转 float32/double/int64</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">b = tf.range(<span class="number">4</span>)</div><div class="line">b1 = tf.cast(b, dtype=tf.float32)</div><div class="line">b2 = tf.cast(b, dtype=tf.double)</div><div class="line">b3 = tf.cast(b, dtype=tf.int64)</div><div class="line">print(b) <span class="comment"># tf.Tensor([0 1 2 3], shape=(4,), dtype=int32)</span></div><div class="line">print(b1) <span class="comment"># tf.Tensor([0. 1. 2. 3.], shape=(4,), dtype=float32)</span></div><div class="line">print(b2) <span class="comment"># tf.Tensor([0. 1. 2. 3.], shape=(4,), dtype=float64)</span></div><div class="line">print(b3) <span class="comment"># tf.Tensor([0 1 2 3], shape=(4,), dtype=int64)</span></div><div class="line"></div><div class="line">a = tf.ones([])</div><div class="line">a1 = int(a)</div><div class="line">a2 = float(a)</div><div class="line">print(a) <span class="comment"># tf.Tensor(1.0, shape=(), dtype=float32)</span></div><div class="line">print(a1) <span class="comment"># 1</span></div><div class="line">print(a2) <span class="comment"># 1.0</span></div></pre></td></tr></table></figure><h2 id="int32-和-bool-的相互转换"><a href="#int32-和-bool-的相互转换" class="headerlink" title="int32 和 bool 的相互转换"></a><strong>int32 和 bool 的相互转换</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">b = tf.constant([<span class="number">0</span>, <span class="number">1</span>])</div><div class="line">b1 = tf.cast(b, dtype=tf.bool)</div><div class="line">b2 = tf.cast(b1, dtype=tf.int32)</div><div class="line">print(b1) <span class="comment"># tf.Tensor([False  True], shape=(2,), dtype=bool)</span></div><div class="line">print(b2) <span class="comment"># tf.Tensor([0 1], shape=(2,), dtype=int32)</span></div></pre></td></tr></table></figure><h2 id="Tensor-转-Variable"><a href="#Tensor-转-Variable" class="headerlink" title="Tensor 转 Variable"></a><strong>Tensor 转 Variable</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">a = tf.range(<span class="number">5</span>)</div><div class="line">b = tf.Variable(a)</div><div class="line">print(b.trainable) <span class="comment"># True</span></div><div class="line"></div><div class="line">b1 = isinstance(b, tf.Tensor)</div><div class="line">b2 = isinstance(b, tf.Variable)</div><div class="line">b3 = tf.is_tensor(b)</div><div class="line">print(b1) <span class="comment"># False</span></div><div class="line">print(b2) <span class="comment"># True</span></div><div class="line">print(b3) <span class="comment"># True</span></div></pre></td></tr></table></figure><h2 id="获取-Tensor-的-rank"><a href="#获取-Tensor-的-rank" class="headerlink" title="获取 Tensor 的 rank"></a><strong>获取 Tensor 的 rank</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">a = tf.constant(<span class="number">1.1</span>)</div><div class="line">b = tf.constant([<span class="number">1.1</span>])</div><div class="line">print(a.ndim) <span class="comment"># 0</span></div><div class="line">print(b.ndim) <span class="comment"># 1</span></div><div class="line">print(tf.rank(a)) <span class="comment"># tf.Tensor(0, shape=(), dtype=int32)</span></div><div class="line">print(tf.rank(b)) <span class="comment"># tf.Tensor(1, shape=(), dtype=int32)</span></div></pre></td></tr></table></figure><h2 id="判断是否为-Tensor"><a href="#判断是否为-Tensor" class="headerlink" title="判断是否为 Tensor"></a><strong>判断是否为 Tensor</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">a = tf.constant([<span class="number">1.</span>])</div><div class="line">d = np.arange(<span class="number">4</span>)</div><div class="line">a1 = isinstance(a, tf.Tensor)</div><div class="line">a2 = tf.is_tensor(a)</div><div class="line">d1 = isinstance(d, tf.Tensor)</div><div class="line">d2 = tf.is_tensor(d)</div><div class="line">print(a1) <span class="comment"># True</span></div><div class="line">print(a2) <span class="comment"># True</span></div><div class="line">print(d1) <span class="comment"># False</span></div><div class="line">print(d2) <span class="comment"># False</span></div></pre></td></tr></table></figure><h2 id="获取-Tensor-的数据类型"><a href="#获取-Tensor-的数据类型" class="headerlink" title="获取 Tensor 的数据类型"></a><strong>获取 Tensor 的数据类型</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = tf.constant([<span class="number">1.</span>])</div><div class="line">d = np.arange(<span class="number">4</span>)</div><div class="line">print(a.dtype) <span class="comment"># &lt;dtype: 'float32'&gt;</span></div><div class="line">print(d.dtype) <span class="comment"># int32</span></div></pre></td></tr></table></figure><h2 id="判断-Tensor-是否为指定的数据类型"><a href="#判断-Tensor-是否为指定的数据类型" class="headerlink" title="判断 Tensor 是否为指定的数据类型"></a><strong>判断 Tensor 是否为指定的数据类型</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = tf.constant([<span class="number">1.</span>])</div><div class="line">d = np.arange(<span class="number">4</span>)</div><div class="line">print(a.dtype == tf.float32) <span class="comment"># True</span></div><div class="line">print(d.dtype == np.int32) <span class="comment"># True</span></div></pre></td></tr></table></figure><hr><h1 id="Tensor-初始化"><a href="#Tensor-初始化" class="headerlink" title="Tensor 初始化"></a><strong>Tensor 初始化</strong></h1><h2 id="from-numpy-list"><a href="#from-numpy-list" class="headerlink" title="from numpy, list"></a><strong>from numpy, list</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">t1 = tf.convert_to_tensor(np.ones([<span class="number">2</span>, <span class="number">3</span>]))</div><div class="line">t2 = tf.convert_to_tensor([<span class="number">2</span>, <span class="number">3</span>])</div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[1. 1. 1.]</span></div><div class="line">          <span class="comment">#  [1. 1. 1.]], shape=(2, 3), dtype=float64)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor([2 3], shape=(2,), dtype=int32)</span></div></pre></td></tr></table></figure><h2 id="zeros"><a href="#zeros" class="headerlink" title="zeros"></a><strong>zeros</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">t1 = tf.zeros([<span class="number">2</span>, <span class="number">3</span>])</div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[0. 0. 0.]</span></div><div class="line">          <span class="comment">#  [0. 0. 0.]], shape=(2, 3), dtype=float32)</span></div></pre></td></tr></table></figure><h2 id="ones"><a href="#ones" class="headerlink" title="ones"></a><strong>ones</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">t1 = tf.ones([<span class="number">2</span>, <span class="number">3</span>])</div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[1. 1. 1.]</span></div><div class="line">          <span class="comment">#  [1. 1. 1.]], shape=(2, 3), dtype=float32)</span></div></pre></td></tr></table></figure><h2 id="fill"><a href="#fill" class="headerlink" title="fill"></a><strong>fill</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">t1 = tf.fill([<span class="number">2</span>, <span class="number">3</span>], <span class="number">3.14</span>)</div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[3.14 3.14 3.14]</span></div><div class="line">          <span class="comment">#  [3.14 3.14 3.14]], shape=(2, 3), dtype=float32)</span></div></pre></td></tr></table></figure><h2 id="random"><a href="#random" class="headerlink" title="random"></a><strong>random</strong></h2><h3 id="normal-truncated-normal"><a href="#normal-truncated-normal" class="headerlink" title="normal, truncated_normal"></a><strong>normal, truncated_normal</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">t1 = tf.random.normal([<span class="number">2</span>, <span class="number">3</span>], mean=<span class="number">1</span>, stddev=<span class="number">1</span>)</div><div class="line">t2 = tf.random.normal([<span class="number">2</span>, <span class="number">3</span>], mean=<span class="number">1</span>, stddev=<span class="number">1</span>)</div><div class="line">t3 = tf.random.truncated_normal([<span class="number">2</span>, <span class="number">3</span>], mean=<span class="number">1</span>, stddev=<span class="number">1</span>)</div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[1.2308737 0.8250756 2.6446304]</span></div><div class="line">          <span class="comment">#  [2.714213  2.0199542 1.3591613]], shape=(2, 3), dtype=float32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 1.5890408  -0.8608984   1.7205659 ]</span></div><div class="line">          <span class="comment">#  [ 1.9205048   0.7741975   0.73170424]], shape=(2, 3), dtype=float32)</span></div><div class="line">print(t3) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[ 1.3489898 -0.4739654  0.5768948]</span></div><div class="line">          <span class="comment">#  [ 2.3000512  0.7400613  1.8497746]], shape=(2, 3), dtype=float32)</span></div></pre></td></tr></table></figure><h3 id="uniform"><a href="#uniform" class="headerlink" title="uniform"></a><strong>uniform</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">t1 = tf.random.uniform([<span class="number">2</span>, <span class="number">3</span>], minval=<span class="number">0</span>, maxval=<span class="number">100</span>)</div><div class="line">print(t1) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[19.821571  44.24106   29.511225 ]</span></div><div class="line">          <span class="comment">#  [ 0.7015109  7.66474    5.251384 ]], shape=(2, 3), dtype=float32)</span></div></pre></td></tr></table></figure><h3 id="shuffle"><a href="#shuffle" class="headerlink" title="shuffle"></a><strong>shuffle</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">id = tf.range(<span class="number">10</span>)</div><div class="line">id1 = tf.random.shuffle(id)</div><div class="line">print(id) <span class="comment"># tf.Tensor([0 1 2 3 4 5 6 7 8 9], shape=(10,), dtype=int32)</span></div><div class="line">print(id1) <span class="comment"># tf.Tensor([8 1 4 0 7 2 5 3 9 6], shape=(10,), dtype=int32)</span></div></pre></td></tr></table></figure><h2 id="constant"><a href="#constant" class="headerlink" title="constant"></a><strong>constant</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">t1 = tf.constant(<span class="number">1</span>)</div><div class="line">print(t1) <span class="comment"># tf.Tensor(1, shape=(), dtype=int32)</span></div></pre></td></tr></table></figure><h2 id="range"><a href="#range" class="headerlink" title="range"></a><strong>range</strong></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">t1 = tf.range(<span class="number">4</span>)</div><div class="line">t2 = tf.one_hot(t1, <span class="number">6</span>)</div><div class="line">print(t1) <span class="comment"># tf.Tensor([0 1 2 3], shape=(4,), dtype=int32)</span></div><div class="line">print(t2) <span class="comment"># tf.Tensor(</span></div><div class="line">          <span class="comment"># [[1. 0. 0. 0. 0. 0.]</span></div><div class="line">          <span class="comment">#  [0. 1. 0. 0. 0. 0.]</span></div><div class="line">          <span class="comment">#  [0. 0. 1. 0. 0. 0.]</span></div><div class="line">          <span class="comment">#  [0. 0. 0. 1. 0. 0.]], shape=(4, 6), dtype=float32)</span></div></pre></td></tr></table></figure><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://st
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Flutter 学习（0）</title>
    <link href="http://www.weichao.io/2018/12/06/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%89/"/>
    <id>http://www.weichao.io/2018/12/06/Flutter-学习（0）/</id>
    <published>2018-12-06T13:50:04.000Z</published>
    <updated>2018-12-07T11:03:52.070Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://flutter.io/" title="https://flutter.io/" target="_blank" rel="external">Flutter</a></li><li><a href="https://plugins.jetbrains.com/androidstudio" title="https://plugins.jetbrains.com/androidstudio" target="_blank" rel="external">Android Studio Plugins</a></li></ul><hr><h1 id="搭建开发环境"><a href="#搭建开发环境" class="headerlink" title="搭建开发环境"></a><strong>搭建开发环境</strong></h1><h2 id="安装-Flutter-SDK"><a href="#安装-Flutter-SDK" class="headerlink" title="安装 Flutter SDK"></a><strong>安装 Flutter SDK</strong></h2><h3 id="下载-SDK"><a href="#下载-SDK" class="headerlink" title="下载 SDK"></a><strong>下载 SDK</strong></h3><p>打开下载 SDK 的<a href="https://flutter.io/docs/get-started/install/windows" title="https://flutter.io/docs/get-started/install/windows" target="_blank" rel="external">网站</a></p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%891.png" alt=""></p><h3 id="安装-SDK"><a href="#安装-SDK" class="headerlink" title="安装 SDK"></a><strong>安装 SDK</strong></h3><p>1、下载并解压缩 zip 包到本地，找到 \flutter\bin\flutter.bat，双击运行</p><p>2、在 \flutter\bin 路径下打开 cmd，运行 <code>flutter --version</code> 验证是否安装成功</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%892.png" alt=""></p><h3 id="将-Flutter-加入环境变量"><a href="#将-Flutter-加入环境变量" class="headerlink" title="将 Flutter 加入环境变量"></a><strong>将 Flutter 加入环境变量</strong></h3><p>1、创建 Flutter 环境变量</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%893.png" alt=""></p><p>2、将 Flutter 环境变量加入 Path</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%894.png" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%895.png" alt=""></p><p>3、重启 cmd，在非 \flutter\bin 路径下运行 <code>flutter --version</code> 验证是否加入成功</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%896.png" alt=""></p><h3 id="查询-Flutter-依赖是否完全已安装"><a href="#查询-Flutter-依赖是否完全已安装" class="headerlink" title="查询 Flutter 依赖是否完全已安装"></a><strong>查询 Flutter 依赖是否完全已安装</strong></h3><p>1、运行 <code>flutter doctor</code>，未安装的依赖会有相关提示</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%897.png" alt=""></p><p>2、根据提示安装依赖、插入设备</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%898.png" alt=""></p><p>3、再次查询，则没有问题了</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%899.png" alt=""></p><h2 id="Android-Studio-关联-Flutter"><a href="#Android-Studio-关联-Flutter" class="headerlink" title="Android Studio 关联 Flutter"></a><strong>Android Studio 关联 Flutter</strong></h2><h3 id="下载插件"><a href="#下载插件" class="headerlink" title="下载插件"></a><strong>下载插件</strong></h3><p>1、打开下载插件的<a href="https://plugins.jetbrains.com/androidstudio" title="https://plugins.jetbrains.com/androidstudio" target="_blank" rel="external">网站</a></p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%8910.png" alt=""></p><p>2、查看 Android Studio 对应的 Intellij 版本</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%8911.png" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%8912.png" alt=""></p><p>3、搜索 Flutter，下载匹配的版本，下载下来的是个 zip 包</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%8913.png" alt=""></p><p>4、因为 Flutter 依赖 Dart，所以参照 Flutter， 一并下载了</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%8914.png" alt=""></p><h3 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件"></a><strong>安装插件</strong></h3><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%8915.png" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%8916.png" alt=""></p><p>选择下载好的 Dart 和 Flutter 的 zip 包并安装，重新启动 Android Studio。</p><h3 id="验证关联成功"><a href="#验证关联成功" class="headerlink" title="验证关联成功"></a><strong>验证关联成功</strong></h3><p>Android Studio 可以创建 Flutter 项目。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%8917.png" alt=""></p><hr><h1 id="运行-demo"><a href="#运行-demo" class="headerlink" title="运行 demo"></a><strong>运行 demo</strong></h1><p>1、新建 Flutter 项目</p><p>2、运行</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/Flutter-%E5%AD%A6%E4%B9%A0%EF%BC%880%EF%BC%8918.jpeg" alt=""></p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://fl
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>U-Push 集成</title>
    <link href="http://www.weichao.io/2018/08/31/U-Push-%E9%9B%86%E6%88%90/"/>
    <id>http://www.weichao.io/2018/08/31/U-Push-集成/</id>
    <published>2018-08-31T14:06:55.000Z</published>
    <updated>2018-12-07T11:03:52.362Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://developer.umeng.com/docs/66632/detail/66744#h1-u91CDu8981u66F4u65B02" title="https://developer.umeng.com/docs/66632/detail/66744#h1-u91CDu8981u66F4u65B02" target="_blank" rel="external">U-Push集成文档</a></li></ul><hr><h1 id="在控制台创建-app"><a href="#在控制台创建-app" class="headerlink" title="在控制台创建 app"></a><strong>在控制台创建 app</strong></h1><hr><h1 id="导入-PushSDK"><a href="#导入-PushSDK" class="headerlink" title="导入 PushSDK"></a><strong>导入 PushSDK</strong></h1><p>1、工程添加仓库：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">allprojects</span> &#123;</div><div class="line">    <span class="keyword">repositories</span> &#123;</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、app 添加依赖：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    implementation <span class="string">'com.umeng.sdk:common:1.5.3'</span>     <span class="comment">// 友盟推送</span></div><div class="line">    implementation <span class="string">'com.umeng.sdk:utdid:1.1.5.3'</span></div><div class="line">    implementation <span class="string">'com.umeng.sdk:push:4.2.0'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>3、如果运行时报错：</p><blockquote><p>Program type already present: com.alibaba.sdk.android.utils.AMSDevReporter<br>Message{kind=ERROR, text=Program type already present: com.alibaba.sdk.android.utils.AMSDevReporter, sources=[Unknown source file], tool name=Optional.of(D8)}</p></blockquote><p>说明存在 jar 包冲突，即引用了同一 jar 包的不同版本，解决方法是去掉其中一个 jar 包的引用，比如：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    implementation(<span class="string">'com.aliyun.ams:alicloud-android-hotfix:3.1.2'</span>) &#123;    <span class="comment">// 热修复</span></div><div class="line">        <span class="comment">// 关闭传递性依赖</span></div><div class="line">        <span class="keyword">exclude</span>(module: <span class="string">'alicloud-android-utdid'</span>)</div><div class="line">        <span class="keyword">exclude</span>(module: <span class="string">'alicloud-android-utils'</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><hr><h1 id="初始化-PushSDK"><a href="#初始化-PushSDK" class="headerlink" title="初始化 PushSDK"></a><strong>初始化 PushSDK</strong></h1><p>修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate();</div><div class="line">    initUPush();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><hr><h1 id="统计应用启动数据"><a href="#统计应用启动数据" class="headerlink" title="统计应用启动数据"></a><strong>统计应用启动数据</strong></h1><p>修改 BaseActivity：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    Log.d(<span class="string">"life"</span>, TAG + <span class="string">" onCreate"</span>);</div><div class="line">    PushAgent.getInstance(<span class="keyword">this</span>).onAppStart();</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>如果不调用此方法，不仅会导致按照“几天不活跃”条件来推送失效，还将导致广播发送不成功以及设备描述红色等问题发生。</p><hr><h1 id="混淆配置"><a href="#混淆配置" class="headerlink" title="混淆配置"></a><strong>混淆配置</strong></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">-dontwarn com.umeng.**</div><div class="line">-dontwarn com.taobao.**</div><div class="line">-dontwarn anet.channel.**</div><div class="line">-dontwarn anetwork.channel.**</div><div class="line">-dontwarn org.android.**</div><div class="line">-dontwarn org.apache.thrift.**</div><div class="line">-dontwarn com.xiaomi.**</div><div class="line">-dontwarn com.huawei.**</div><div class="line">-dontwarn com.meizu.**</div></pre></td></tr></table></figure><h1 id="功能集成"><a href="#功能集成" class="headerlink" title="功能集成"></a><strong>功能集成</strong></h1><h2 id="设置通知点击后的行为"><a href="#设置通知点击后的行为" class="headerlink" title="设置通知点击后的行为"></a><strong>设置通知点击后的行为</strong></h2><p>修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    <span class="comment">// 自定义行为的回调处理，参考文档：高级功能-通知的展示及提醒-自定义通知打开动作</span></div><div class="line">    <span class="comment">// UmengNotificationClickHandler是在BroadcastReceiver中被调用，故如果需启动Activity，需添加Intent.FLAG_ACTIVITY_NEW_TASK</span></div><div class="line">    <span class="keyword">final</span> UmengNotificationClickHandler umengNotificationClickHandler = <span class="keyword">new</span> UmengNotificationClickHandler() &#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 启动 app</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">launchApp</span><span class="params">(Context context, UMessage msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.launchApp(context, msg);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 打开 URL</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openUrl</span><span class="params">(Context context, UMessage msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.openUrl(context, msg);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 打开指定页面</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openActivity</span><span class="params">(Context context, UMessage msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">super</span>.openActivity(context, msg);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 自定义行为</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dealWithCustomAction</span><span class="params">(Context context, UMessage msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span> (Constant.DEBUG) &#123;</div><div class="line">                Toast.makeText(context, msg.custom, Toast.LENGTH_LONG).show();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    pushAgent.setNotificationClickHandler(umengNotificationClickHandler);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="设置是否展示通知"><a href="#设置是否展示通知" class="headerlink" title="设置是否展示通知"></a><strong>设置是否展示通知</strong></h2><p>修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">final</span> UmengMessageHandler umengMessageHandler = <span class="keyword">new</span> UmengMessageHandler() &#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 通知的回调方法，通知送达时触发</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dealWithNotificationMessage</span><span class="params">(Context context, UMessage msg)</span> </span>&#123;</div><div class="line">            <span class="comment">// 调用super，会展示通知；不调用super，则不展示通知。</span></div><div class="line">            <span class="keyword">super</span>.dealWithNotificationMessage(context, msg);</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    pushAgent.setMessageHandler(umengMessageHandler);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="设置通知免打扰时间段"><a href="#设置通知免打扰时间段" class="headerlink" title="设置通知免打扰时间段"></a><strong>设置通知免打扰时间段</strong></h2><p>默认是 23:00~7:00。</p><p>修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    pushAgent.setNoDisturbMode(<span class="number">23</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="number">0</span>); <span class="comment">// 关闭免打扰：pushAgent.setNoDisturbMode(0, 0, 0, 0);</span></div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="设置通知冷却时间"><a href="#设置通知冷却时间" class="headerlink" title="设置通知冷却时间"></a><strong>设置通知冷却时间</strong></h2><p>默认是 60 秒。</p><p>修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    pushAgent.setMuteDurationSeconds(<span class="number">10</span>);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="设置合并通知数"><a href="#设置合并通知数" class="headerlink" title="设置合并通知数"></a><strong>设置合并通知数</strong></h2><p>可以设置为 0~10 之间任意整数，默认是 1。</p><p>1、修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    pushAgent.setDisplayNotificationNumber(<span class="number">2</span>); <span class="comment">// 参数为 0 时，表示不合并通知。</span></div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、效果</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%901.png" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%902.jpeg" alt=""></p><h2 id="自定义通知栏图标"><a href="#自定义通知栏图标" class="headerlink" title="自定义通知栏图标"></a><strong>自定义通知栏图标</strong></h2><ul><li>如果在发送后台没有指定通知栏图标，SDK 将使用本地的默认图标，其中，大图标默认使用 drawable 下的 umeng_push_notification_default_large_icon，小图标默认使用 drawable 下的 umeng_push_notification_default_small_icon。</li><li><del>若开发者没有设置这两个图标，则默认使用应用的图标（&lt;application android:icon=”@mipmap/ic_launcher”&gt;&lt;/application&gt;）。</del></li><li><del>若开发者在发送后台指定了图片的链接，则该链接将通过 Message 的 img 字段进行传输。当 SDK 接受到消息后，会先下载图片，下载成功后显示通知；若下载失败，会自动重试两次（总共下载 3 次）；若仍失败，则采用默认图片进行显示。</del></li><li><del>如果使用 API 方式来发送消息, 可以指定 icon 和 largeIcon 字段，分别对应状态栏图标和通知栏下拉之后左侧大图标 id（[R.drawable].icon）, 请填写对应图片文件名，不包含扩展名。</del></li><li><p>MIUI 暂时无法支持自定义通知栏图标，若开发者有需求，也可通过自定义通知栏样式来解决。</p></li><li><p>小图标 smallIcon：要求为 48*48 像素，图片各边至少留 1 个像素的透明，图标主体使用颜色，背景均使用透明。</p></li><li>大图标 largeIcon：要求为 64*64 像素。</li><li>对于超高分辨率的机型的适配，可以适当提高图标的尺寸。</li></ul><h2 id="自定义通知栏样式"><a href="#自定义通知栏样式" class="headerlink" title="自定义通知栏样式"></a><strong>自定义通知栏样式</strong></h2><p>1、新建布局 notification.xml：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"64dp"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:background</span>=<span class="string">"@drawable/bg_new_word_list_recyclerview"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/notification_large_icon"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"64dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"64dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:scaleType</span>=<span class="string">"fitXY"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@mipmap/ic_launcher"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/notification_title"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_marginTop</span>=<span class="string">"5dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_toEndOf</span>=<span class="string">"@+id/notification_large_icon"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Title"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"@color/black"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/notification_text"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_below</span>=<span class="string">"@+id/notification_title"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_toEndOf</span>=<span class="string">"@+id/notification_large_icon"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"Message"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"@color/black"</span> /&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_below</span>=<span class="string">"@+id/notification_text"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_marginStart</span>=<span class="string">"10dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_toEndOf</span>=<span class="string">"@+id/notification_large_icon"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">"(嘿嘿，偷偷听告诉你，我是自定义的)"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:textColor</span>=<span class="string">"@color/black"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">"12sp"</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/notification_small_icon"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"24dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"24dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_alignParentEnd</span>=<span class="string">"true"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_marginBottom</span>=<span class="string">"5dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:layout_marginEnd</span>=<span class="string">"5dp"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:scaleType</span>=<span class="string">"fitXY"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@mipmap/ic_launcher"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></div></pre></td></tr></table></figure><p>2、修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">final</span> UmengMessageHandler umengMessageHandler = <span class="keyword">new</span> UmengMessageHandler() &#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 自定义通知栏样式的回调方法，通知展示到通知栏时触发</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Notification <span class="title">getNotification</span><span class="params">(Context context, UMessage msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">switch</span> (msg.builder_id) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">                    <span class="keyword">final</span> Notification.Builder builder;</div><div class="line">                    <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) &#123;</div><div class="line">                        <span class="keyword">final</span> NotificationChannel channel = <span class="keyword">new</span> NotificationChannel(<span class="string">"channel_id"</span>, <span class="string">"channel_name"</span>, NotificationManager.IMPORTANCE_HIGH);</div><div class="line">                        <span class="keyword">final</span> NotificationManager manager = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);</div><div class="line">                        <span class="keyword">if</span> (manager != <span class="keyword">null</span>) &#123;</div><div class="line">                            manager.createNotificationChannel(channel);</div><div class="line">                        &#125;</div><div class="line">                        builder = <span class="keyword">new</span> Notification.Builder(context, <span class="string">"channel_id"</span>);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        builder = <span class="keyword">new</span> Notification.Builder(context);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">final</span> RemoteViews remoteViews = <span class="keyword">new</span> RemoteViews(context.getPackageName(), R.layout.notification);</div><div class="line">                    remoteViews.setTextViewText(R.id.notification_title, msg.title);</div><div class="line">                    remoteViews.setTextViewText(R.id.notification_text, msg.text);</div><div class="line">                    remoteViews.setImageViewBitmap(R.id.notification_large_icon, getLargeIcon(context, msg));</div><div class="line">                    remoteViews.setImageViewResource(R.id.notification_small_icon, getSmallIconId(context, msg));</div><div class="line">                    <span class="keyword">return</span> builder.setContent(remoteViews)</div><div class="line">                            .setSmallIcon(getSmallIconId(context, msg))</div><div class="line">                            .setTicker(msg.ticker)</div><div class="line">                            .setAutoCancel(<span class="keyword">true</span>)</div><div class="line">                            .build();</div><div class="line">                <span class="keyword">default</span>:</div><div class="line">                    <span class="comment">// 默认为0，若填写的builder_id并不存在，也使用默认。</span></div><div class="line">                    <span class="keyword">return</span> <span class="keyword">super</span>.getNotification(context, msg);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    pushAgent.setMessageHandler(umengMessageHandler);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>3、效果</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%903.png" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%904.jpeg" alt=""></p><h2 id="设置通知到达时响铃、震动、呼吸灯策略"><a href="#设置通知到达时响铃、震动、呼吸灯策略" class="headerlink" title="设置通知到达时响铃、震动、呼吸灯策略"></a><strong>设置通知到达时响铃、震动、呼吸灯策略</strong></h2><ul><li>MsgConstant.NOTIFICATION_PLAY_SERVER：通过服务端推送状态来设置客户端响铃、震动、呼吸灯的状态。</li><li>MsgConstant.NOTIFICATION_PLAY_SDK_ENABLE：不关心服务端推送状态，客户端都会响铃、震动、呼吸灯亮。</li><li>MsgConstant.NOTIFICATION_PLAY_SDK_DISABLE：不关心服务端推送状态，客户端不会响铃、震动、呼吸灯亮。</li></ul><p>修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    pushAgent.setNotificationPlaySound(MsgConstant.NOTIFICATION_PLAY_SERVER);       <span class="comment">// 声音</span></div><div class="line">    pushAgent.setNotificationPlayLights(MsgConstant.NOTIFICATION_PLAY_SDK_ENABLE);  <span class="comment">// 呼吸灯</span></div><div class="line">    pushAgent.setNotificationPlayVibrate(MsgConstant.NOTIFICATION_PLAY_SDK_DISABLE);<span class="comment">// 振动</span></div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="自定义通知栏声音"><a href="#自定义通知栏声音" class="headerlink" title="自定义通知栏声音"></a><strong>自定义通知栏声音</strong></h2><p><em>TODO 适配 8.0+。</em></p><ul><li>如果在发送后台没有指定通知栏的声音，SDK 将采用本地默认的声音，即 res/raw/umeng_push_notification_default_sound。若无此文件，则默认使用系统的 Notification 声音。</li><li>若需要在线配置声音，则需先将与配置的声音文件放置在 res/raw 下，然后自发送后台指定声音的 id，即 R.raw.[sound] 里的 sound。</li></ul><h2 id="设置应用在前台时是否显示通知"><a href="#设置应用在前台时是否显示通知" class="headerlink" title="设置应用在前台时是否显示通知"></a><strong>设置应用在前台时是否显示通知</strong></h2><p>修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    pushAgent.setNotificaitonOnForeground(<span class="keyword">false</span>);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="自定义消息"><a href="#自定义消息" class="headerlink" title="自定义消息"></a><strong>自定义消息</strong></h2><p>自定义消息的内容存放在 UMessage.custom 字段里。</p><p>修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">final</span> UmengMessageHandler umengMessageHandler = <span class="keyword">new</span> UmengMessageHandler() &#123;</div><div class="line">        <span class="comment">/**</span></div><div class="line"><span class="comment">         * 自定义消息的回调方法，通知被点击时触发</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dealWithCustomMessage</span><span class="params">(<span class="keyword">final</span> Context context, <span class="keyword">final</span> UMessage msg)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"dealWithCustomMessage()"</span>);</div><div class="line">            <span class="keyword">if</span> (Constant.DEBUG) &#123;</div><div class="line">                Toast.makeText(context, msg.custom, Toast.LENGTH_LONG).show();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    pushAgent.setMessageHandler(umengMessageHandler);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="设置用户标签（Tag）"><a href="#设置用户标签（Tag）" class="headerlink" title="设置用户标签（Tag）"></a><strong>设置用户标签（Tag）</strong></h2><p>方便推送时按标签过滤。</p><h3 id="添加标签"><a href="#添加标签" class="headerlink" title="添加标签"></a><strong>添加标签</strong></h3><p>1、修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    pushAgent.getTagManager().addTags(<span class="keyword">new</span> TagManager.TCallBack() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(<span class="keyword">final</span> <span class="keyword">boolean</span> isSuccess, <span class="keyword">final</span> ITagManager.Result result)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"isSuccess: "</span> + isSuccess + <span class="string">";result: "</span> + result.toString());</div><div class="line">        &#125;</div><div class="line">    &#125;, <span class="string">"movie"</span>, <span class="string">"sport"</span>);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、断点查看：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%905.png" alt=""></p><p>3、添加完成后，如果之前没有用户添加过该标签，现在就可以从控制台可以看到该标签并可以按该标签推送了：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%906.png" alt=""></p><h3 id="获取服务器端的所有标签"><a href="#获取服务器端的所有标签" class="headerlink" title="获取服务器端的所有标签"></a><strong>获取服务器端的所有标签</strong></h3><p>1、修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    pushAgent.getTagManager().getTags(<span class="keyword">new</span> TagManager.TagListCallBack() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(<span class="keyword">boolean</span> isSuccess, List&lt;String&gt; result)</span> </span>&#123;</div><div class="line">            Log.i(TAG, result.toString());</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、断点查看：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%907.png" alt=""></p><h3 id="删除标签"><a href="#删除标签" class="headerlink" title="删除标签"></a><strong>删除标签</strong></h3><p>1、修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    pushAgent.getTagManager().deleteTags(<span class="keyword">new</span> TagManager.TCallBack() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(<span class="keyword">final</span> <span class="keyword">boolean</span> isSuccess, <span class="keyword">final</span> ITagManager.Result result)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"isSuccess: "</span> + isSuccess + <span class="string">";result: "</span> + result.toString());</div><div class="line">        &#125;</div><div class="line">    &#125;, <span class="string">"movie"</span>);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、断点查看：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%908.png" alt=""></p><h2 id="设置用户加权标签（Weighted-Tag）"><a href="#设置用户加权标签（Weighted-Tag）" class="headerlink" title="设置用户加权标签（Weighted Tag）"></a><strong>设置用户加权标签（Weighted Tag）</strong></h2><p><em>TODO 该功能尚未开通。</em></p><h3 id="添加加权标签"><a href="#添加加权标签" class="headerlink" title="添加加权标签"></a><strong>添加加权标签</strong></h3><p>1、修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">final</span> Hashtable&lt;String, Integer&gt; hashtable = <span class="keyword">new</span> Hashtable&lt;&gt;();</div><div class="line">    hashtable.put(<span class="string">"财经"</span>, <span class="number">5</span>);</div><div class="line">    pushAgent.getTagManager().addWeightedTags(<span class="keyword">new</span> TagManager.TCallBack() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(<span class="keyword">final</span> <span class="keyword">boolean</span> isSuccess, <span class="keyword">final</span> ITagManager.Result result)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"isSuccess: "</span> + isSuccess + <span class="string">";result: "</span> + result.toString());</div><div class="line">        &#125;</div><div class="line">    &#125;, hashtable);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、断点查看：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%909.png" alt=""></p><h3 id="获取服务器端的所有加权标签"><a href="#获取服务器端的所有加权标签" class="headerlink" title="获取服务器端的所有加权标签"></a><strong>获取服务器端的所有加权标签</strong></h3><h3 id="删除加权标签"><a href="#删除加权标签" class="headerlink" title="删除加权标签"></a><strong>删除加权标签</strong></h3><h2 id="设置用户别名（Alias）"><a href="#设置用户别名（Alias）" class="headerlink" title="设置用户别名（Alias）"></a><strong>设置用户别名（Alias）</strong></h2><p>如果你的应用有自有的用户 id 体系，可以 在SDK 中通过 Alias 字段上传自有用户 id，按用户 id 向用户推送消息。<br>方便推送时按别名过滤（单点推送）。</p><h3 id="添加用户别名"><a href="#添加用户别名" class="headerlink" title="添加用户别名"></a><strong>添加用户别名</strong></h3><p>1、修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    pushAgent.addAlias(<span class="string">"659xxx"</span>, <span class="string">"ALIAS_TYPE_DEMO"</span>, <span class="keyword">new</span> UTrack.ICallBack() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(<span class="keyword">boolean</span> isSuccess, String message)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"isSuccess: "</span> + isSuccess + <span class="string">";message: "</span> + message);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、断点查看：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%9010.png" alt=""></p><h3 id="删除用户别名"><a href="#删除用户别名" class="headerlink" title="删除用户别名"></a><strong>删除用户别名</strong></h3><p>1、修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    pushAgent.deleteAlias(<span class="string">"659xxx"</span>, <span class="string">"ALIAS_TYPE_DEMO"</span>, <span class="keyword">new</span> UTrack.ICallBack() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(<span class="keyword">boolean</span> isSuccess, String message)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"isSuccess: "</span> + isSuccess + <span class="string">";message: "</span> + message);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、断点查看：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%9011.png" alt=""></p><h2 id="自定义参数"><a href="#自定义参数" class="headerlink" title="自定义参数"></a><strong>自定义参数</strong></h2><h3 id="SDK-回调"><a href="#SDK-回调" class="headerlink" title="SDK 回调"></a><strong>SDK 回调</strong></h3><h4 id="getNotification-Context-context-UMessage-msg"><a href="#getNotification-Context-context-UMessage-msg" class="headerlink" title="getNotification(Context context, UMessage msg)"></a><strong>getNotification(Context context, UMessage msg)</strong></h4><p>通知展示到通知栏时触发。</p><p>1、修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">final</span> UmengMessageHandler umengMessageHandler = <span class="keyword">new</span> UmengMessageHandler() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Notification <span class="title">getNotification</span><span class="params">(Context context, UMessage msg)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"getNotification()"</span>);</div><div class="line">            <span class="keyword">if</span> (msg != <span class="keyword">null</span> &amp;&amp; msg.extra != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : msg.extra.entrySet()) &#123;</div><div class="line">                    <span class="keyword">final</span> String key = entry.getKey();</div><div class="line">                    <span class="keyword">final</span> String value = entry.getValue();</div><div class="line">                    Log.i(TAG, <span class="string">"key: "</span> + key + <span class="string">";value: "</span> + value);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    pushAgent.setMessageHandler(umengMessageHandler);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、Logcat 查看：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%9012.png" alt=""></p><h4 id="dealWithCustomAction-Context-context-UMessage-msg"><a href="#dealWithCustomAction-Context-context-UMessage-msg" class="headerlink" title="dealWithCustomAction(Context context, UMessage msg)"></a><strong>dealWithCustomAction(Context context, UMessage msg)</strong></h4><p>通知被点击时触发。</p><p>修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    <span class="keyword">final</span> UmengNotificationClickHandler umengNotificationClickHandler = <span class="keyword">new</span> UmengNotificationClickHandler() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dealWithCustomAction</span><span class="params">(Context context, UMessage msg)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"dealWithCustomAction()"</span>);</div><div class="line">            <span class="keyword">if</span> (msg != <span class="keyword">null</span> &amp;&amp; msg.extra != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : msg.extra.entrySet()) &#123;</div><div class="line">                    <span class="keyword">final</span> String key = entry.getKey();</div><div class="line">                    <span class="keyword">final</span> String value = entry.getValue();</div><div class="line">                    Log.i(TAG, <span class="string">"key: "</span> + key + <span class="string">";value: "</span> + value);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    pushAgent.setNotificationClickHandler(umengNotificationClickHandler);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="Intent-回调"><a href="#Intent-回调" class="headerlink" title="Intent 回调"></a><strong>Intent 回调</strong></h3><p>1、修改 Activity：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onResume();</div><div class="line">    <span class="keyword">final</span> Bundle bundle = getIntent().getExtras();</div><div class="line">    <span class="keyword">if</span> (bundle != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">final</span> Set&lt;String&gt; keySet = bundle.keySet();</div><div class="line">        <span class="keyword">for</span> (String key : keySet) &#123;</div><div class="line">            <span class="keyword">final</span> String value = bundle.getString(key);</div><div class="line">            Log.i(TAG, <span class="string">"key: "</span> + key + <span class="string">";value: "</span> + value);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onNewIntent</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onNewIntent(intent);</div><div class="line">    setIntent(intent);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、修改 Activity 启动方式为 singleTask。</p><p>3、断点查看：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%9013.png" alt=""></p><h2 id="自定义资源包名"><a href="#自定义资源包名" class="headerlink" title="自定义资源包名"></a><strong>自定义资源包名</strong></h2><p>修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initUPush</span><span class="params">()</span> </span>&#123;</div><div class="line">    UMConfigure.init(<span class="keyword">this</span>, <span class="string">"5xxxxxxxxxxxxxxxxxxxxxx0"</span>, AppUtil.getMetaDataValueFromApplication(<span class="keyword">this</span>, <span class="string">"UMENG_CHANNEL"</span>), UMConfigure.DEVICE_TYPE_PHONE, <span class="string">"4xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx3"</span>);</div><div class="line">    <span class="keyword">final</span> PushAgent pushAgent = PushAgent.getInstance(<span class="keyword">this</span>);</div><div class="line">    pushAgent.setResourcePackageName(<span class="string">"com.xx.xx"</span>);</div><div class="line">    <span class="comment">// 注册</span></div><div class="line">    pushAgent.register(<span class="keyword">new</span> IUmengRegisterCallback() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">(String deviceToken)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"device token: "</span> + deviceToken);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">            Log.i(TAG, <span class="string">"register failed: "</span> + s + <span class="string">" "</span> + s1);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="关闭推送"><a href="#关闭推送" class="headerlink" title="关闭推送"></a><strong>关闭推送</strong></h2><p>不能在刚刚注册后开启或关闭推送。</p><p>1、修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">pushAgent.disable(<span class="keyword">new</span> IUmengCallback() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">()</span> </span>&#123;</div><div class="line">        Log.i(TAG, <span class="string">"onSuccess()"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">        Log.i(TAG, <span class="string">"onFailure(s"</span> + s + <span class="string">", "</span> + s1 + <span class="string">")"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>2、断点查看：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%9014.png" alt=""></p><h2 id="开启推送"><a href="#开启推送" class="headerlink" title="开启推送"></a><strong>开启推送</strong></h2><p>不能在刚刚注册后开启或关闭推送。</p><p>1、修改 Application：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">pushAgent.enable(<span class="keyword">new</span> IUmengCallback() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onSuccess</span><span class="params">()</span> </span>&#123;</div><div class="line">        Log.i(TAG, <span class="string">"onSuccess()"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(String s, String s1)</span> </span>&#123;</div><div class="line">        Log.i(TAG, <span class="string">"onFailure(s"</span> + s + <span class="string">", "</span> + s1 + <span class="string">")"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>2、断点查看：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%9015.png" alt=""></p><h2 id="支持多包名"><a href="#支持多包名" class="headerlink" title="支持多包名"></a><strong>支持多包名</strong></h2><p>若一个 APP 针对不同渠道有不同的包名，则可通过开通多包名支持一个 AppKey 对应多个包名发送消息。<br>如果同一设备安装同一应用的不同包名的多个安装包，只有最后安装的应用可以正常收到推送消息。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E9%9B%86%E6%88%9016.png" alt=""></p><h2 id="完全自定义处理（透传）"><a href="#完全自定义处理（透传）" class="headerlink" title="完全自定义处理（透传）"></a><strong>完全自定义处理（透传）</strong></h2><p><em>TODO 未实现。</em></p><p>使用完全自定义处理后，PushSDK 只负责下发消息体且只统计送达数，展示逻辑需由开发者自己写代码实现，点击数和忽略数需由开发者调用 UTrack 类的 trackMsgClick 和 trackMsgDismissed 方法进行统计。</p><h2 id="应用内消息"><a href="#应用内消息" class="headerlink" title="应用内消息"></a><strong>应用内消息</strong></h2><h3 id="全屏消息"><a href="#全屏消息" class="headerlink" title="全屏消息"></a><strong>全屏消息</strong></h3><p><em>TODO 未实现。</em></p><p>Activity 需要继承 UmengSplashMessageActivity，而不是实现某个接口。</p><h3 id="插屏消息"><a href="#插屏消息" class="headerlink" title="插屏消息"></a><strong>插屏消息</strong></h3><p><em>TODO 未实现。</em></p><h3 id="自定义插屏"><a href="#自定义插屏" class="headerlink" title="自定义插屏"></a><strong>自定义插屏</strong></h3><p><em>TODO 未实现。</em></p><h3 id="纯文本"><a href="#纯文本" class="headerlink" title="纯文本"></a><strong>纯文本</strong></h3><p><em>TODO 未实现。</em></p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://de
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>U-Push 控制台可配置参数及其对应效果的测试</title>
    <link href="http://www.weichao.io/2018/08/24/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%95/"/>
    <id>http://www.weichao.io/2018/08/24/U-Push-控制台可配置参数及其对应效果的测试/</id>
    <published>2018-08-24T12:52:46.000Z</published>
    <updated>2018-12-07T11:03:52.360Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://github.com/umeng/MultiFunctionAndroidDemo" title="https://github.com/umeng/MultiFunctionAndroidDemo" target="_blank" rel="external">MultiFunctionAndroidDemo</a></li><li><a href="https://developer.umeng.com/docs/66632/detail/66744#h2--appkey-umeng-message-secret3" title="https://developer.umeng.com/docs/66632/detail/66744#h2--appkey-umeng-message-secret3" target="_blank" rel="external">U-Push集成文档</a></li></ul><hr><h1 id="全部默认"><a href="#全部默认" class="headerlink" title="全部默认"></a><strong>全部默认</strong></h1><h2 id="消息详情"><a href="#消息详情" class="headerlink" title="消息详情"></a><strong>消息详情</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%951.png" alt=""></p><h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a><strong>效果</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%952.png" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%953.jpeg" alt=""></p><hr><h1 id="基础内容-展示样式-定制样式"><a href="#基础内容-展示样式-定制样式" class="headerlink" title="基础内容/展示样式/定制样式"></a><strong>基础内容/展示样式/定制样式</strong></h1><h2 id="预置在-app-内的样式"><a href="#预置在-app-内的样式" class="headerlink" title="预置在 app 内的样式"></a><strong>预置在 app 内的样式</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> Notification <span class="title">getNotification</span><span class="params">(Context context, UMessage msg)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span> (msg.builder_id) &#123;</div><div class="line">        <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">            Notification.Builder builder = <span class="keyword">new</span> Notification.Builder(context);</div><div class="line">            RemoteViews myNotificationView = <span class="keyword">new</span> RemoteViews(context.getPackageName(),</div><div class="line">                R.layout.notification_view);</div><div class="line">            myNotificationView.setTextViewText(R.id.notification_title, msg.title);</div><div class="line">            myNotificationView.setTextViewText(R.id.notification_text, msg.text);</div><div class="line">            myNotificationView.setImageViewBitmap(R.id.notification_large_icon, getLargeIcon(context, msg));</div><div class="line">            myNotificationView.setImageViewResource(R.id.notification_small_icon,</div><div class="line">                getSmallIconId(context, msg));</div><div class="line">            builder.setContent(myNotificationView)</div><div class="line">                .setSmallIcon(getSmallIconId(context, msg))</div><div class="line">                .setTicker(msg.ticker)</div><div class="line">                .setAutoCancel(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">            <span class="keyword">return</span> builder.getNotification();</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="comment">//默认为0，若填写的builder_id并不存在，也使用默认。</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.getNotification(context, msg);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="消息详情-1"><a href="#消息详情-1" class="headerlink" title="消息详情"></a><strong>消息详情</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%954.png" alt=""></p><h2 id="效果-1"><a href="#效果-1" class="headerlink" title="效果"></a><strong>效果</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%955.png" alt=""></p><hr><h1 id="基础内容-展示样式-图片"><a href="#基础内容-展示样式-图片" class="headerlink" title="基础内容/展示样式/图片"></a><strong>基础内容/展示样式/图片</strong></h1><h2 id="上传图片"><a href="#上传图片" class="headerlink" title="上传图片"></a><strong>上传图片</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%956.png" alt=""></p><h2 id="消息详情-2"><a href="#消息详情-2" class="headerlink" title="消息详情"></a><strong>消息详情</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%957.png" alt=""></p><h2 id="效果-2"><a href="#效果-2" class="headerlink" title="效果"></a><strong>效果</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%958.png" alt=""></p><hr><h1 id="基础内容-自定义图标-应用内图标文件"><a href="#基础内容-自定义图标-应用内图标文件" class="headerlink" title="基础内容/自定义图标/应用内图标文件"></a><strong>基础内容/自定义图标/应用内图标文件</strong></h1><h2 id="大图标文件"><a href="#大图标文件" class="headerlink" title="大图标文件"></a><strong>大图标文件</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%959.png" alt=""></p><h2 id="小图标文件"><a href="#小图标文件" class="headerlink" title="小图标文件"></a><strong>小图标文件</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9510.png" alt=""></p><h2 id="消息详情-3"><a href="#消息详情-3" class="headerlink" title="消息详情"></a><strong>消息详情</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9511.png" alt=""></p><h2 id="效果-3"><a href="#效果-3" class="headerlink" title="效果"></a><strong>效果</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9512.png" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9513.jpeg" alt=""></p><hr><h1 id="基础内容-自定义图标-上传图标文件"><a href="#基础内容-自定义图标-上传图标文件" class="headerlink" title="基础内容/自定义图标/上传图标文件"></a><strong>基础内容/自定义图标/上传图标文件</strong></h1><h2 id="大图标文件-1"><a href="#大图标文件-1" class="headerlink" title="大图标文件"></a><strong>大图标文件</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9514.png" alt=""></p><h2 id="小图标文件-1"><a href="#小图标文件-1" class="headerlink" title="小图标文件"></a><strong>小图标文件</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9515.png" alt=""></p><h2 id="消息详情-4"><a href="#消息详情-4" class="headerlink" title="消息详情"></a><strong>消息详情</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9516.png" alt=""></p><h2 id="效果-4"><a href="#效果-4" class="headerlink" title="效果"></a><strong>效果</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9517.png" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9518.jpeg" alt=""></p><hr><h1 id="基础内容-是否展开-大图"><a href="#基础内容-是否展开-大图" class="headerlink" title="基础内容/是否展开/大图"></a><strong>基础内容/是否展开/大图</strong></h1><h2 id="上传图片-1"><a href="#上传图片-1" class="headerlink" title="上传图片"></a><strong>上传图片</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9519.png" alt=""></p><h2 id="消息详情-5"><a href="#消息详情-5" class="headerlink" title="消息详情"></a><strong>消息详情</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9520.png" alt=""></p><h2 id="效果-5"><a href="#效果-5" class="headerlink" title="效果"></a><strong>效果</strong></h2><p>点击下拉按钮可以显示图片。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9521.png" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9522.jpeg" alt=""></p><hr><h1 id="目标人群-目标人群-部分用户"><a href="#目标人群-目标人群-部分用户" class="headerlink" title="目标人群/目标人群/部分用户"></a><strong>目标人群/目标人群/部分用户</strong></h1><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9523.png" alt=""></p><p>按【标签】过滤时提示“无匹配结果”是因为没有用户添加过标签。</p><hr><h1 id="目标人群-目标人群-独立用户"><a href="#目标人群-目标人群-独立用户" class="headerlink" title="目标人群/目标人群/独立用户"></a><strong>目标人群/目标人群/独立用户</strong></h1><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9524.png" alt=""></p><hr><h1 id="目标人群-目标人群-推送时间-定时推送"><a href="#目标人群-目标人群-推送时间-定时推送" class="headerlink" title="目标人群/目标人群/推送时间/定时推送"></a><strong>目标人群/目标人群/推送时间/定时推送</strong></h1><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9525.png" alt=""></p><hr><h1 id="目标人群-目标人群-推送时间-重复推送"><a href="#目标人群-目标人群-推送时间-重复推送" class="headerlink" title="目标人群/目标人群/推送时间/重复推送"></a><strong>目标人群/目标人群/推送时间/重复推送</strong></h1><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9526.png" alt=""></p><hr><h1 id="后续行为-后续动作-打开连接-URL"><a href="#后续行为-后续动作-打开连接-URL" class="headerlink" title="后续行为/后续动作/打开连接(URL)"></a><strong>后续行为/后续动作/打开连接(URL)</strong></h1><h2 id="消息详情-6"><a href="#消息详情-6" class="headerlink" title="消息详情"></a><strong>消息详情</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9527.png" alt=""></p><h2 id="效果-6"><a href="#效果-6" class="headerlink" title="效果"></a><strong>效果</strong></h2><p>显示效果和默认相同，但是点击后启动浏览器访问 URL。</p><hr><h1 id="后续行为-后续动作-打开指定页面"><a href="#后续行为-后续动作-打开指定页面" class="headerlink" title="后续行为/后续动作/打开指定页面"></a><strong>后续行为/后续动作/打开指定页面</strong></h1><h2 id="消息详情-7"><a href="#消息详情-7" class="headerlink" title="消息详情"></a><strong>消息详情</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9528.png" alt=""></p><h2 id="效果-7"><a href="#效果-7" class="headerlink" title="效果"></a><strong>效果</strong></h2><p>显示效果和默认相同，但是点击后打开 app 内的一个 activity，不能是其他 app 的。</p><hr><h1 id="后续行为-后续动作-自定义行为"><a href="#后续行为-后续动作-自定义行为" class="headerlink" title="后续行为/后续动作/自定义行为"></a><strong>后续行为/后续动作/自定义行为</strong></h1><h2 id="预置在-app-内的处理"><a href="#预置在-app-内的处理" class="headerlink" title="预置在 app 内的处理"></a><strong>预置在 app 内的处理</strong></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dealWithCustomAction</span><span class="params">(Context context, UMessage msg)</span> </span>&#123;</div><div class="line">    Toast.makeText(context, msg.custom, Toast.LENGTH_LONG).show();</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="消息详情-8"><a href="#消息详情-8" class="headerlink" title="消息详情"></a><strong>消息详情</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9530.png" alt=""></p><h2 id="效果-8"><a href="#效果-8" class="headerlink" title="效果"></a><strong>效果</strong></h2><p>显示效果和默认相同，但是点击后触发回调。</p><hr><h1 id="后续行为-后续动作-自定义参数"><a href="#后续行为-后续动作-自定义参数" class="headerlink" title="后续行为/后续动作/自定义参数"></a><strong>后续行为/后续动作/自定义参数</strong></h1><h2 id="消息详情-9"><a href="#消息详情-9" class="headerlink" title="消息详情"></a><strong>消息详情</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9531.png" alt=""></p><h2 id="效果-9"><a href="#效果-9" class="headerlink" title="效果"></a><strong>效果</strong></h2><p>显示效果和默认相同，但是点击后在触发 4 个可选【后续动作】中对应的回调的同时，会传递参数。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9532.png" alt=""></p><hr><h1 id="后续行为-系统通道-MIUI、EMUI、Flyme系统设备离线转为系统下发"><a href="#后续行为-系统通道-MIUI、EMUI、Flyme系统设备离线转为系统下发" class="headerlink" title="后续行为/系统通道/MIUI、EMUI、Flyme系统设备离线转为系统下发"></a><strong>后续行为/系统通道/MIUI、EMUI、Flyme系统设备离线转为系统下发</strong></h1><p><em>TODO 暂不清楚是干啥的。</em></p><hr><h1 id="后续行为-提醒方式"><a href="#后续行为-提醒方式" class="headerlink" title="后续行为/提醒方式"></a><strong>后续行为/提醒方式</strong></h1><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9533.png" alt=""></p><hr><h1 id="后续行为-高级设置-限制发送速度"><a href="#后续行为-高级设置-限制发送速度" class="headerlink" title="后续行为/高级设置/限制发送速度"></a><strong>后续行为/高级设置/限制发送速度</strong></h1><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9534.png" alt=""></p><hr><h1 id="后续行为-高级设置-消息触发器"><a href="#后续行为-高级设置-消息触发器" class="headerlink" title="后续行为/高级设置/消息触发器"></a><strong>后续行为/高级设置/消息触发器</strong></h1><p>为用户加上标签，方便推送时按照标签来筛选。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/U-Push-%E6%8E%A7%E5%88%B6%E5%8F%B0%E5%8F%AF%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E5%8F%8A%E5%85%B6%E5%AF%B9%E5%BA%94%E6%95%88%E6%9E%9C%E7%9A%84%E6%B5%8B%E8%AF%9535.png" alt=""></p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://gi
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>华为开发者联盟 MDM 和 ROM 定制</title>
    <link href="http://www.weichao.io/2018/08/16/%E5%8D%8E%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85%E8%81%94%E7%9B%9F-MDM-%E5%92%8C-ROM-%E5%AE%9A%E5%88%B6/"/>
    <id>http://www.weichao.io/2018/08/16/华为开发者联盟-MDM-和-ROM-定制/</id>
    <published>2018-08-16T15:12:11.000Z</published>
    <updated>2018-12-07T11:03:52.380Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://developer.huawei.com/consumer/cn/devservice/doc/10101" title="https://developer.huawei.com/consumer/cn/devservice/doc/10101" target="_blank" rel="external">安全类授权开放SDK</a></li></ul><hr><h1 id="MDM"><a href="#MDM" class="headerlink" title="MDM"></a><strong>MDM</strong></h1><h2 id="在官网下载资料"><a href="#在官网下载资料" class="headerlink" title="在官网下载资料"></a><strong>在官网下载资料</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E5%8D%8E%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85%E8%81%94%E7%9B%9F-MDM-%E5%92%8C-ROM-%E5%AE%9A%E5%88%B61.png" alt=""></p><p>下载的 SecurityAuthorizationOpenSDK-2.0.rar 包里面提供了部分资料，但是《目录结构说明.txt》中提到的【华为证书HUAWEI.cer】和【MDMSample.apk】均没有提供。</p><h3 id="coding-前"><a href="#coding-前" class="headerlink" title="coding 前"></a><strong>coding 前</strong></h3><p>1、开发指导书：<br>docs/HW安全类授权开放SDK开发指导书V2.0.pdf</p><p>2、功能概述：<br>docs/功能简介V2.0.pdf<br>docs/HW安全类授权开放SDK功能介绍及展示文档V2.0.pdf</p><p>3、demo（该项目直接导入 IDE 后不能正常使用，修改后的版本可<a href="https://github.com/weichao66666/MDMSample" title="https://github.com/weichao66666/MDMSample" target="_blank" rel="external">下载</a>）：<br>samples/MDMSample</p><h3 id="coding-中"><a href="#coding-中" class="headerlink" title="coding 中"></a><strong>coding 中</strong></h3><p>1、调用华为接口所需的 jar 包：<br>libs/hwsdk-mdm-openapi-2.0.0.jar</p><p>2、API：<br>docs/HW安全类授权开放SDK API接口(EMUI4.1-8.0)V2.0.pdf</p><h3 id="coding-后"><a href="#coding-后" class="headerlink" title="coding 后"></a><strong>coding 后</strong></h3><p>1、APK 签名与华为证书签名要求：<br>docs/关于签名.pdf</p><p>2、华为证书签名工具和使用说明：<br>tools/DevPack.exe<br>tools/Devpack使用说明.pdf</p><h2 id="SDK-集成步骤"><a href="#SDK-集成步骤" class="headerlink" title="SDK 集成步骤"></a><strong>SDK 集成步骤</strong></h2><h3 id="添加基本权限"><a href="#添加基本权限" class="headerlink" title="添加基本权限"></a><strong>添加基本权限</strong></h3><p>在 AndroidManifest.xml 中添加：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"com.huawei.permission.sec.MDM"</span> /&gt;</span></div></pre></td></tr></table></figure><h3 id="引入-jar-包"><a href="#引入-jar-包" class="headerlink" title="引入 jar 包"></a><strong>引入 jar 包</strong></h3><p>1、将 hwsdk-mdm-openapi-2.0.0.jar 放入 libs 目录。</p><p>2、确保 build.gradle 中有：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">implementation <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</div></pre></td></tr></table></figure><p>或：</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">implementation files(<span class="string">'libs/hwsdk-mdm-openapi-2.0.0.jar'</span>)</div></pre></td></tr></table></figure><h3 id="调用接口（比如：最基本的静默激活管控）"><a href="#调用接口（比如：最基本的静默激活管控）" class="headerlink" title="调用接口（比如：最基本的静默激活管控）"></a><strong>调用接口（比如：最基本的静默激活管控）</strong></h3><p>1、创建 ComponentName 时可以添加回调：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SampleDeviceReceiver</span> <span class="keyword">extends</span> <span class="title">DeviceAdminReceiver</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"SampleDeviceReceiver"</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onEnabled</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</div><div class="line">        Log.v(TAG, <span class="string">"onEnabled()"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDisabled</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</div><div class="line">        Log.v(TAG, <span class="string">"onDisabled()"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> CharSequence <span class="title">onDisableRequested</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</div><div class="line">        Log.v(TAG, <span class="string">"onDisableRequested()"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="string">"onDisableRequested()"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>2、创建 ComponentName，调用接口静默激活管控：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    <span class="keyword">final</span> ComponentName componentName = <span class="keyword">new</span> ComponentName(<span class="keyword">this</span>, SampleDeviceReceiver.class);</div><div class="line">    DevicePolicyManager devicePolicyManager = (DevicePolicyManager) getSystemService(Context.DEVICE_POLICY_SERVICE);</div><div class="line">    <span class="keyword">if</span> (devicePolicyManager != <span class="keyword">null</span> &amp;&amp; !devicePolicyManager.isAdminActive(componentName)) &#123;</div><div class="line">        DeviceControlManager deviceControlManager = <span class="keyword">new</span> DeviceControlManager();</div><div class="line">        deviceControlManager.setSilentActiveAdmin(componentName);</div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="避免混淆"><a href="#避免混淆" class="headerlink" title="避免混淆"></a><strong>避免混淆</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-keep class com.huawei.android.app.**&#123;*;&#125;</div></pre></td></tr></table></figure><h2 id="跳转到华为桌面"><a href="#跳转到华为桌面" class="headerlink" title="跳转到华为桌面"></a><strong>跳转到华为桌面</strong></h2><p>直接使用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Intent intent = getPackageManager().getLaunchIntentForPackage(<span class="string">"com.huawei.android.launcher"</span>);</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure><p>返回的 intent 为 null。</p><p>需要直接指定包名和类名：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Intent intent = <span class="keyword">new</span> Intent();</div><div class="line">intent.setClassName(<span class="string">"com.huawei.android.launcher"</span>, <span class="string">"com.huawei.android.launcher.unihome.UniHomeLauncher"</span>);</div><div class="line">startActivity(intent);</div></pre></td></tr></table></figure><h2 id="打包时签名"><a href="#打包时签名" class="headerlink" title="打包时签名"></a><strong>打包时签名</strong></h2><p>打包时签名只使用 V1 签名，不使用 V2 签名：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E5%8D%8E%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85%E8%81%94%E7%9B%9F-MDM-%E5%92%8C-ROM-%E5%AE%9A%E5%88%B62.png" alt=""></p><h2 id="华为证书签名"><a href="#华为证书签名" class="headerlink" title="华为证书签名"></a><strong>华为证书签名</strong></h2><p>首先需要一个华为开发者账号，这个账号和应用在华为应用市场上架是同一个。</p><h3 id="证书申请"><a href="#证书申请" class="headerlink" title="证书申请"></a><strong>证书申请</strong></h3><p>1、在官网找到【权签】：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E5%8D%8E%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85%E8%81%94%E7%9B%9F-MDM-%E5%92%8C-ROM-%E5%AE%9A%E5%88%B63.png" alt=""></p><p>2、申请权签服务（第一次申请的是开发证书）：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E5%8D%8E%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85%E8%81%94%E7%9B%9F-MDM-%E5%92%8C-ROM-%E5%AE%9A%E5%88%B64.png" alt=""></p><p>3、与代理商签订《API授权证书申请承诺函》并将电子扫描件发送。</p><p>该文件需要盖公章、骑缝章，法人授权代码签名。</p><h4 id="开发证书申请"><a href="#开发证书申请" class="headerlink" title="开发证书申请"></a><strong>开发证书申请</strong></h4><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E5%8D%8E%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85%E8%81%94%E7%9B%9F-MDM-%E5%92%8C-ROM-%E5%AE%9A%E5%88%B65.png" alt=""></p><p>证书和设备绑定，在同一设备上可以正常使用开发证书签名后的任意版本的同一包名的 app，也就是实现了修改 app 后签名有效。<br>证书有效期最长半年。<br>审批时间大概 1 天。</p><h4 id="商用证书申请"><a href="#商用证书申请" class="headerlink" title="商用证书申请"></a><strong>商用证书申请</strong></h4><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E5%8D%8E%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85%E8%81%94%E7%9B%9F-MDM-%E5%92%8C-ROM-%E5%AE%9A%E5%88%B66.png" alt=""></p><p>证书和 app 绑定，在任意设备上可以正常使用商用证书签名后的唯一 app，也就是实现了更换设备后签名有效。<br>证书有效期无限。<br>审批时间大概 3 天。</p><h3 id="证书签名"><a href="#证书签名" class="headerlink" title="证书签名"></a><strong>证书签名</strong></h3><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E5%8D%8E%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85%E8%81%94%E7%9B%9F-MDM-%E5%92%8C-ROM-%E5%AE%9A%E5%88%B67.png" alt=""></p><hr><h1 id="ROM-定制"><a href="#ROM-定制" class="headerlink" title="ROM 定制"></a><strong>ROM 定制</strong></h1><h2 id="开机动画前的-Logo"><a href="#开机动画前的-Logo" class="headerlink" title="开机动画前的 Logo"></a><strong>开机动画前的 Logo</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E5%8D%8E%E4%B8%BA%E5%BC%80%E5%8F%91%E8%80%85%E8%81%94%E7%9B%9F-MDM-%E5%92%8C-ROM-%E5%AE%9A%E5%88%B68.jpeg" alt=""></p><p>仅支持修改黑色背景图。</p><h2 id="开机动画"><a href="#开机动画" class="headerlink" title="开机动画"></a><strong>开机动画</strong></h2><p>需要提供 30~50 张 JPG 或 PNG 格式的图片，形成帧动画。<br>支持单次/循环播放。</p><h2 id="开机向导界面裁剪"><a href="#开机向导界面裁剪" class="headerlink" title="开机向导界面裁剪"></a><strong>开机向导界面裁剪</strong></h2><p>最少保留：选择语言、协议与条款、应用权限开关说明。</p><h2 id="预置-app-到-Pad-中"><a href="#预置-app-到-Pad-中" class="headerlink" title="预置 app 到 Pad 中"></a><strong>预置 app 到 Pad 中</strong></h2><p>1、填写《【开发者联盟专用】第三方应用安全自检checklist V2.1》并发送。</p><p>2、与代理商签订《预置软件免责协议》并将电子扫描件发送。</p><p>该文件需要盖公章、骑缝章，法人授权代码签名。</p><h2 id="app-开机自启"><a href="#app-开机自启" class="headerlink" title="app 开机自启"></a><strong>app 开机自启</strong></h2><h2 id="硬件定制-Logo"><a href="#硬件定制-Logo" class="headerlink" title="硬件定制 Logo"></a><strong>硬件定制 Logo</strong></h2><p>需要找第三方厂商，需要单独收费，如果订货量在 3000 台以上厂商可以做。</p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://de
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>腾讯浏览服务（TBS）bug 反馈流程</title>
    <link href="http://www.weichao.io/2018/08/16/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B/"/>
    <id>http://www.weichao.io/2018/08/16/腾讯浏览服务（TBS）bug-反馈流程/</id>
    <published>2018-08-16T15:03:09.000Z</published>
    <updated>2018-12-07T11:03:52.487Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li><a href="https://x5.tencent.com/" title="https://x5.tencent.com/" target="_blank" rel="external">腾讯浏览服务</a></li><li><a href="http://bbs.mb.qq.com/forum-110-1.html" title="http://bbs.mb.qq.com/forum-110-1.html" target="_blank" rel="external">QQ 浏览器移动产品论坛-X5专区</a></li></ul><hr><h1 id="bug-示例"><a href="#bug-示例" class="headerlink" title="bug 示例"></a><strong>bug 示例</strong></h1><p>快速点击按钮，两次加载同一 url，部分时候会出现：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B1.png" alt=""></p><hr><h1 id="确认-bug-是否由-TBS-导致"><a href="#确认-bug-是否由-TBS-导致" class="headerlink" title="确认 bug 是否由 TBS 导致"></a><strong>确认 bug 是否由 TBS 导致</strong></h1><h2 id="确认-bug-是否属于原生"><a href="#确认-bug-是否属于原生" class="headerlink" title="确认 bug 是否属于原生"></a><strong>确认 bug 是否属于原生</strong></h2><p>打开【开发者选项】中的【显示布局边界】。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B2.png" alt=""></p><h2 id="复现-bug"><a href="#复现-bug" class="headerlink" title="复现 bug"></a><strong>复现 bug</strong></h2><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8Bdemo480p.gif" alt=""></p><p>如果可以看见布局边框，说明 bug 属于原生，否则可能是原生自定义控件或前端页面。</p><h2 id="确认-bug-在系统-WebView-中是否存在"><a href="#确认-bug-在系统-WebView-中是否存在" class="headerlink" title="确认 bug 在系统 WebView 中是否存在"></a><strong>确认 bug 在系统 WebView 中是否存在</strong></h2><p>1、长按 WebView 中的文字部分，如果未出现【选择复制】说明是系统 WebView（第一次启动app肯定是系统 WebView，如果第一次使用时间足够长，会将 TBS 下载到本地，从第二次开始 app 使用的就是 TBS）。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B3.png" alt=""></p><p>在该场景下尝试复现 bug。</p><p>2、长按 WebView 中的文字部分，如果出现【选择复制】说明是 TBS。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B4.png" alt=""></p><p>在该场景下尝试复现 bug。</p><hr><h1 id="通过论坛反馈-bug"><a href="#通过论坛反馈-bug" class="headerlink" title="通过论坛反馈 bug"></a><strong>通过论坛反馈 bug</strong></h1><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B5.png" alt=""></p><h2 id="生成网络日志"><a href="#生成网络日志" class="headerlink" title="生成网络日志"></a><strong>生成网络日志</strong></h2><p>参考官方文档<a href="http://bbs.mb.qq.com/thread-1945241-1-1.html" title="http://bbs.mb.qq.com/thread-1945241-1-1.html" target="_blank" rel="external">《合作方网络日志抓取方法（反馈时附带抓取的日志，可优先处理）》</a>。</p><p>1、可以在 Log 层添加加载 <a href="http://debugx5.qq.com" target="_blank" rel="external">http://debugx5.qq.com</a> 的开关。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B6.png" alt=""></p><p>2、如果本地没有 TBS，加载 <a href="http://debugx5.qq.com" target="_blank" rel="external">http://debugx5.qq.com</a> 时会有相关提示：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B7.png" alt=""></p><p>3、点击【进入DebugTbs安装或打开X5内核】，安装线上内核。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B8.png" alt=""></p><p>4、重启 app，再次加载 <a href="http://debugx5.qq.com。" target="_blank" rel="external">http://debugx5.qq.com。</a></p><p>5、点击【日志功能开启】。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B9.png" alt=""></p><p>6、点击 Log 层的 WebView 返回，再复现 bug。</p><p>7、点击【日志功能关闭并上传】。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B10.png" alt=""></p><p>8、记录 GUID，将 GUID 输入反馈页面的【操作步骤】中。</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/%E8%85%BE%E8%AE%AF%E6%B5%8F%E8%A7%88%E6%9C%8D%E5%8A%A1%EF%BC%88TBS%EF%BC%89bug-%E5%8F%8D%E9%A6%88%E6%B5%81%E7%A8%8B11.png" alt=""></p><hr><h1 id="等待客服人员联系"><a href="#等待客服人员联系" class="headerlink" title="等待客服人员联系"></a><strong>等待客服人员联系</strong></h1><p>联系我的时间在晚上 10 点左右。</p><hr><h1 id="bug-修复结果"><a href="#bug-修复结果" class="headerlink" title="bug 修复结果"></a><strong>bug 修复结果</strong></h1><p>bug 解决后在对应贴子下回复修复结果。</p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://x5
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>FFmpeg 录制 HTTP 流</title>
    <link href="http://www.weichao.io/2018/07/29/FFmpeg-%E5%BD%95%E5%88%B6-HTTP-%E6%B5%81/"/>
    <id>http://www.weichao.io/2018/07/29/FFmpeg-录制-HTTP-流/</id>
    <published>2018-07-29T07:41:15.000Z</published>
    <updated>2018-12-07T11:03:51.867Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li>《FFmpeg 从入门到精通》</li></ul><hr><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a><strong>简介</strong></h1><p>使用 HTTP 可以传输 FLV 直播流、TS 直播流、M3U8 及 TS 文件。</p><hr><h1 id="HTTP-参数说明"><a href="#HTTP-参数说明" class="headerlink" title="HTTP 参数说明"></a><strong>HTTP 参数说明</strong></h1><table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>seekable</td><td>布尔</td><td>设置 HTTP 链接为可以 seek 操作</td></tr><tr><td>chunked_post</td><td>布尔</td><td>使用 Chunked 模式 post 数据</td></tr><tr><td>http_proxy</td><td>字符串</td><td>设置 HTTP 代理传输数据</td></tr><tr><td>headers</td><td>字符串</td><td>自定义 HTTP Header 数据</td></tr><tr><td>content_type</td><td>字符串</td><td>设置 POST 的内容类型</td></tr><tr><td>user_agent</td><td>字符串</td><td>设置 HTTP 请求客户端信息</td></tr><tr><td>multiple_requests</td><td>布尔</td><td>HTTP 长连接开启</td></tr><tr><td>post_data</td><td>二进制数据</td><td>设置将要 POST 的数据</td></tr><tr><td>cookies</td><td>字符串</td><td>设置 HTTP 请求时写代码的 Cookies</td></tr><tr><td>icy</td><td>布尔</td><td>请求 ICY 元数据：默认打开</td></tr><tr><td>auth_type</td><td>整数</td><td>HTTP 验证类型设置</td></tr><tr><td>offset</td><td>整数</td><td>初始化 HTTP 请求时的偏移位置</td></tr><tr><td>method</td><td>字符串</td><td>发起 HTTP 请求时使用的 HTTP 的方法</td></tr><tr><td>reconnect</td><td>布尔</td><td>在 EOF 之前断开发起重连</td></tr><tr><td>reconnect_at_eof</td><td>布尔</td><td>在得到 EOF 时发起重连</td></tr><tr><td>reply_code</td><td>整数</td><td>作为 HTTP 服务时向客户端反馈状态码</td></tr></tbody></table><hr><h1 id="参数使用示例"><a href="#参数使用示例" class="headerlink" title="参数使用示例"></a><strong>参数使用示例</strong></h1><h2 id="seekable"><a href="#seekable" class="headerlink" title="seekable"></a><strong>seekable</strong></h2><h3 id="阻塞"><a href="#阻塞" class="headerlink" title="阻塞"></a><strong>阻塞</strong></h3><p>1、输入命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ffmpeg -ss 300 -seekable 0 -i http://live.hkstv.hk.lxdns.com/live/hks/playlist.m3u8 -c copy output.mp4</div></pre></td></tr></table></figure><p>2、输出结果（实际没播放成功）：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/FFmpeg-%E5%BD%95%E5%88%B6-HTTP-%E6%B5%811.png" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/FFmpeg-%E5%BD%95%E5%88%B6-HTTP-%E6%B5%812.png" alt=""></p><h3 id="非阻塞"><a href="#非阻塞" class="headerlink" title="非阻塞"></a><strong>非阻塞</strong></h3><p>1、输入命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ffmpeg -ss 300 -seekable 1 -i http://live.hkstv.hk.lxdns.com/live/hks/playlist.m3u8 -c copy -y output.mp4</div></pre></td></tr></table></figure><p>2、输出结果（实际没播放成功）：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/FFmpeg-%E5%BD%95%E5%88%B6-HTTP-%E6%B5%813.png" alt=""><br><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/FFmpeg-%E5%BD%95%E5%88%B6-HTTP-%E6%B5%814.png" alt=""></p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;《FFmpeg 从入门到精通》&lt;/li
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>FFmpeg 录制 RTSP 流</title>
    <link href="http://www.weichao.io/2018/07/29/FFmpeg-%E5%BD%95%E5%88%B6-RTSP-%E6%B5%81/"/>
    <id>http://www.weichao.io/2018/07/29/FFmpeg-录制-RTSP-流/</id>
    <published>2018-07-29T07:38:50.000Z</published>
    <updated>2018-12-07T11:03:51.871Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a><strong>Reference</strong></h1><ul><li>《FFmpeg 从入门到精通》</li></ul><hr><h1 id="FFmpeg-操作-RTSP-的参数"><a href="#FFmpeg-操作-RTSP-的参数" class="headerlink" title="FFmpeg 操作 RTSP 的参数"></a><strong>FFmpeg 操作 RTSP 的参数</strong></h1><table><thead><tr><th>参数</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>initial_pause</td><td>布尔</td><td>建立连接后暂停播放</td></tr><tr><td>rtsp_transport</td><td>标记</td><td>设置 RTSP 传输协议，具体如下：<br>udp：UDP<br>tcp：TCP<br>udp_multicast：UDP 多播协议<br>http：HTTP 隧道</td></tr><tr><td>rtsp_flags</td><td>标记</td><td>RTSP 使用标记，具体如下：<br>filter_src：只接收指定 IP 的流<br>listen：设置为被动接收模式<br>prefer_tcp：TCP 亲和模式，如果 TCP 可用则首选 TCP 传输</td></tr><tr><td>allowed_media_types</td><td>标记</td><td>设置允许接收的数据模式（默认为全部开启）：<br>video：只接收视频<br>audio：只接收音频<br>data：只接收数据<br>subtitle：只接收字幕</td></tr><tr><td>min_port</td><td>整数</td><td>设置最小本地 UDP 端口，默认为 5000</td></tr><tr><td>max_port</td><td>整数</td><td>设置最大本地 UDP 端口，默认为 65000</td></tr><tr><td>timeout</td><td>整数</td><td>设置监听端口超时时间</td></tr><tr><td>reorder_queue_size</td><td>整数</td><td>设置录制数据 Buffer 的大小</td></tr><tr><td>buffer_size</td><td>整数</td><td>设置底层传输包 Buffer 的大小</td></tr><tr><td>user-agent</td><td>字符串</td><td>用户客户端标识</td></tr></tbody></table><hr><h1 id="参数使用示例"><a href="#参数使用示例" class="headerlink" title="参数使用示例"></a><strong>参数使用示例</strong></h1><h2 id="rtsp-transport"><a href="#rtsp-transport" class="headerlink" title="rtsp_transport"></a><strong>rtsp_transport</strong></h2><p>FFmpeg 默认使用的 RTSP 拉流的方式是 UDP 传输。</p><p>1、输入命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ffmpeg -rtsp_transport tcp -i rtsp://184.72.239.149/vod/mp4://BigBuckBunny_175k.mov -c copy -f mp4 output.mp4</div></pre></td></tr></table></figure><p>2、输出结果：</p><p><img src="https://weichao-io-1257283924.cos.ap-beijing.myqcloud.com/qldownload/FFmpeg-%E5%BD%95%E5%88%B6-RTSP-%E6%B5%811.png" alt=""></p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Reference&quot;&gt;&lt;a href=&quot;#Reference&quot; class=&quot;headerlink&quot; title=&quot;Reference&quot;&gt;&lt;/a&gt;&lt;strong&gt;Reference&lt;/strong&gt;&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;《FFmpeg 从入门到精通》&lt;/li
      
    
    </summary>
    
    
  </entry>
  
</feed>
